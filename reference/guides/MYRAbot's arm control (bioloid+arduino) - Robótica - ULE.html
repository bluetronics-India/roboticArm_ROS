<!DOCTYPE html>
<html dir="ltr" class="client-js" lang="en"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta charset="UTF-8"><title>MYRAbot's arm control (bioloid+arduino) - Robótica - ULE</title>
<meta name="generator" content="MediaWiki 1.22.5">
<link rel="shortcut icon" href="http://robotica.unileon.es/mediawiki/skins/common/images/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="http://robotica.unileon.es/mediawiki/opensearch_desc.php" title="Robótica - ULE (en)">
<link rel="EditURI" type="application/rsd+xml" href="http://robotica.unileon.es/mediawiki/api.php?action=rsd">
<link rel="alternate" type="application/atom+xml" title="Robótica - ULE Atom feed" href="http://robotica.unileon.es/mediawiki/index.php?title=Special:RecentChanges&amp;feed=atom">
<link rel="stylesheet" href="MYRAbot%27s%20arm%20control%20%28bioloid+arduino%29%20-%20Rob%C3%B3tica%20-%20ULE_files/load.css">
<style>
.mw-collapsible-toggle{float:right} li .mw-collapsible-toggle{float:none} .mw-collapsible-toggle-li{list-style:none}
/* cache key: wikidb:resourceloader:filter:minify-css:7:4250852ed2349a0d4d0fc6509a3e7d4c */
.suggestions{overflow:hidden;position:absolute;top:0;left:0;width:0;border:none;z-index:1099;padding:0;margin:-1px -1px 0 0} html > body .suggestions{margin:-1px 0 0 0}.suggestions-special{position:relative;background-color:white;cursor:pointer;border:solid 1px #aaaaaa;padding:0;margin:0;margin-top:-2px;display:none;padding:0.25em 0.25em;line-height:1.25em}.suggestions-results{background-color:white;cursor:pointer;border:solid 1px #aaaaaa;padding:0;margin:0}.suggestions-result{color:black;margin:0;line-height:1.5em;padding:0.01em 0.25em;text-align:left}.suggestions-result-current{background-color:#4C59A6;color:white}.suggestions-special .special-label{color:gray;text-align:left}.suggestions-special .special-query{color:black;font-style:italic;text-align:left}.suggestions-special .special-hover{background-color:silver}.suggestions-result-current .special-label,.suggestions-result-current .special-query{color:white}.autoellipsis-matched,.highlight{font-weight:bold}
/* cache key: wikidb:resourceloader:filter:minify-css:7:9780324491b653a3780e2d029bdc140c */
.postedit-container{margin:0 auto;position:fixed;top:0;height:0;left:50%;z-index:1000;font-size:13px}.postedit-container:hover{cursor:pointer}.postedit{position:relative;top:0.6em;left:-50%;padding:.6em 3.6em .6em 1.1em;line-height:1.5625em;color:#626465;background-color:#f4f4f4;border:1px solid #dcd9d9;text-shadow:0 0.0625em 0 rgba(255,255,255,0.5);border-radius:5px;-webkit-box-shadow:0 2px 5px 0 #ccc;box-shadow:0 2px 5px 0 #ccc;-webkit-transition:all 0.25s ease-in-out;-moz-transition:all 0.25s ease-in-out;-ms-transition:all 0.25s ease-in-out;-o-transition:all 0.25s ease-in-out;transition:all 0.25s ease-in-out}.skin-monobook .postedit{top:6em !important}.postedit-faded{opacity:0}.postedit-icon{padding-left:41px;  line-height:25px;background-repeat:no-repeat;background-position:8px 50%}.postedit-icon-checkmark{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAABblBMVEUAAAD///////9PfTf///80aRdTgjn///9Feij///////////9Rfzf///////////9PfjZRgDh1o1xOfTb///////+bwYqLtnj///////9PfTa82K////9WhT6YxIL///9QgDdTgzr////////j7uDl7eLq8efi693k7OH///////9UhjuBr2rp9uRUhjr///9YljVKgir///9WiTlYjT3////9/v57vFlbkT5PjC9dlD/5/fhuq09stUTs9uhxuElctCpfnT1huDFloEZloUZmpENmvDZpvDxpvTxqvjxrvT5rvT9rwTxsqktswD5uwkBvuUdxw0NztFBztU9ztVBzwkp0tlJ1xkd2t1R3uVR4w1F4xk54x014yE15uVZ5v1R5xVB6v1R7yFJ8wVh9xVl9yFR9yVd9ylN+xVh+yFd/x1l/yFeAylmEx1+Ny2uY0Hqe04Wj1Ymv3Ze33qLD47TJ5L3O6cPU7Mrq9eb2+/Q4j37OAAAAQHRSTlMAAQIEBAUFBQwPFB4fJCUoKiosQEhJS01RUlZZXmdydXaChYuSlJSWmJmoq6uur8LExcvM19fg5ejt8fX2+Pr7SljgewAAAKpJREFUGBkFwQNCAwAAAMDLtl3LtrG4rWXbtvX77gAgZ6grFwC0bhwNVgKgdPZx8b0dgLi+s7Wn0VoAqpfOI9+BNADZI7fLrz2pSEwGHZuH+78lSK8ZLkLezF3ooyUG3VPXq2USei9WngeyoG195yBYWDF3E/2pAhl1e9Gr8bGT+bfOFCC2fnvh4X7rcqIAQNNu+HT6sxkAjceTL/2ZAIhv+PorBwBJxfkA//dFHSCBy/UTAAAAAElFTkSuQmCC);background-image:url(http://robotica.unileon.es/mediawiki/resources/mediawiki.action/images/green-checkmark.png?2014-04-10T08:01:40Z)!ie;background-position:left}.postedit-close{position:absolute;padding:0 .8em;right:0;top:0;font-size:1.25em;font-weight:bold;line-height:2.3em;color:black;text-shadow:0 0.0625em 0 white;text-decoration:none;opacity:0.2;filter:alpha(opacity=20)}.postedit-close:hover{color:black;text-decoration:none;opacity:0.4;filter:alpha(opacity=40)}
/* cache key: wikidb:resourceloader:filter:minify-css:7:9b39df22efb31003b8c266f2194113b0 */</style><style>
.suggestions a.mw-searchSuggest-link,.suggestions a.mw-searchSuggest-link:hover,.suggestions a.mw-searchSuggest-link:active,.suggestions a.mw-searchSuggest-link:focus{text-decoration:none;color:black}.suggestions-result-current a.mw-searchSuggest-link,.suggestions-result-current a.mw-searchSuggest-link:hover,.suggestions-result-current a.mw-searchSuggest-link:active,.suggestions-result-current a.mw-searchSuggest-link:focus{color:white}
/* cache key: wikidb:resourceloader:filter:minify-css:7:52b1797f70c7e4094dfa4191101944e8 */</style><meta name="ResourceLoaderDynamicStyles" content="">
<style>a:lang(ar),a:lang(ckb),a:lang(kk-arab),a:lang(mzn),a:lang(ps),a:lang(ur){text-decoration:none}
/* cache key: wikidb:resourceloader:filter:minify-css:7:c2f15db357ed1b34653e004540bd5f70 */</style>

<script src="MYRAbot%27s%20arm%20control%20%28bioloid+arduino%29%20-%20Rob%C3%B3tica%20-%20ULE_files/load_004.php"></script><script src="MYRAbot%27s%20arm%20control%20%28bioloid+arduino%29%20-%20Rob%C3%B3tica%20-%20ULE_files/load_002.php"></script>
<script>if(window.mw){
mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"MYRAbot's_arm_control_(bioloid+arduino)","wgTitle":"MYRAbot's arm control (bioloid+arduino)","wgCurRevisionId":4214,"wgRevisionId":4214,"wgArticleId":280,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":[],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"MYRAbot's_arm_control_(bioloid+arduino)","wgIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[]});
}</script><script>if(window.mw){
mw.loader.implement("user.options",function(){mw.user.options.set({"ccmeonemails":0,"cols":80,"date":"default","diffonly":0,"disablemail":0,"disablesuggest":0,"editfont":"default","editondblclick":0,"editsection":1,"editsectiononrightclick":0,"enotifminoredits":0,"enotifrevealaddr":0,"enotifusertalkpages":1,"enotifwatchlistpages":0,"extendwatchlist":0,"fancysig":0,"forceeditsummary":0,"gender":"unknown","hideminor":0,"hidepatrolled":0,"imagesize":2,"justify":0,"math":1,"minordefault":0,"newpageshidepatrolled":0,"nocache":0,"noconvertlink":0,"norollbackdiff":0,"numberheadings":0,"previewonfirst":0,"previewontop":1,"rcdays":7,"rclimit":50,"rememberpassword":0,"rows":25,"searchlimit":20,"showhiddencats":0,"shownumberswatching":1,"showtoc":1,"showtoolbar":1,"skin":"vector","stubthreshold":0,"thumbsize":2,"underline":2,"uselivepreview":0,"usenewrc":0,"vector-simplesearch":1,"watchcreations":0,"watchdefault":0,"watchdeletion":0,"watchlistdays":3,"watchlisthideanons":0,"watchlisthidebots":0,
"watchlisthideliu":0,"watchlisthideminor":0,"watchlisthideown":0,"watchlisthidepatrolled":0,"watchmoves":0,"wllimit":250,"useeditwarning":1,"prefershttps":1,"language":"en","variant-gan":"gan","variant-iu":"iu","variant-kk":"kk","variant-ku":"ku","variant-shi":"shi","variant-sr":"sr","variant-tg":"tg","variant-uz":"uz","variant-zh":"zh","searchNs0":true,"searchNs1":false,"searchNs2":false,"searchNs3":false,"searchNs4":false,"searchNs5":false,"searchNs6":false,"searchNs7":false,"searchNs8":false,"searchNs9":false,"searchNs10":false,"searchNs11":false,"searchNs12":false,"searchNs13":false,"searchNs14":false,"searchNs15":false,"variant":"en"});},{},{});mw.loader.implement("user.tokens",function(){mw.user.tokens.set({"editToken":"+\\","patrolToken":false,"watchToken":false});},{},{});
/* cache key: wikidb:resourceloader:filter:minify-js:7:5a69c7e0fa6557851b6dea8a62efaffb */
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.page.startup","mediawiki.legacy.wikibits","mediawiki.legacy.ajax","skins.vector.js"]);
}</script><script src="MYRAbot%27s%20arm%20control%20%28bioloid+arduino%29%20-%20Rob%C3%B3tica%20-%20ULE_files/load.php"></script>
<style type="text/css">/*<![CDATA[*/
.source-bash {line-height: normal;}
.source-bash li, .source-bash pre {
	line-height: normal; border: 0px none white;
}
/**
 * GeSHi Dynamically Generated Stylesheet
 * --------------------------------------
 * Dynamically generated stylesheet for bash
 * CSS class: source-bash, CSS id: 
 * GeSHi (C) 2004 - 2007 Nigel McNie, 2007 - 2008 Benny Baumann
 * (http://qbnz.com/highlighter/ and http://geshi.org/)
 * --------------------------------------
 */
.bash.source-bash .de1, .bash.source-bash .de2 {font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;}
.bash.source-bash  {font-family:monospace;}
.bash.source-bash .imp {font-weight: bold; color: red;}
.bash.source-bash li, .bash.source-bash .li1 {font-weight: normal; vertical-align:top;}
.bash.source-bash .ln {width:1px;text-align:right;margin:0;padding:0 2px;vertical-align:top;}
.bash.source-bash .li2 {font-weight: bold; vertical-align:top;}
.bash.source-bash .kw1 {color: #000000; font-weight: bold;}
.bash.source-bash .kw2 {color: #c20cb9; font-weight: bold;}
.bash.source-bash .kw3 {color: #7a0874; font-weight: bold;}
.bash.source-bash .co0 {color: #666666; font-style: italic;}
.bash.source-bash .co1 {color: #800000;}
.bash.source-bash .co2 {color: #cc0000; font-style: italic;}
.bash.source-bash .co3 {color: #000000; font-weight: bold;}
.bash.source-bash .es1 {color: #000099; font-weight: bold;}
.bash.source-bash .es2 {color: #007800;}
.bash.source-bash .es3 {color: #007800;}
.bash.source-bash .es4 {color: #007800;}
.bash.source-bash .es5 {color: #780078;}
.bash.source-bash .es_h {color: #000099; font-weight: bold;}
.bash.source-bash .br0 {color: #7a0874; font-weight: bold;}
.bash.source-bash .sy0 {color: #000000; font-weight: bold;}
.bash.source-bash .st0 {color: #ff0000;}
.bash.source-bash .st_h {color: #ff0000;}
.bash.source-bash .nu0 {color: #000000;}
.bash.source-bash .re0 {color: #007800;}
.bash.source-bash .re1 {color: #007800;}
.bash.source-bash .re2 {color: #007800;}
.bash.source-bash .re4 {color: #007800;}
.bash.source-bash .re5 {color: #660033;}
.bash.source-bash .ln-xtra, .bash.source-bash li.ln-xtra, .bash.source-bash div.ln-xtra {background-color: #ffc;}
.bash.source-bash span.xtra { display:block; }

/*]]>*/
</style><style type="text/css">/*<![CDATA[*/
.source-cmake {line-height: normal;}
.source-cmake li, .source-cmake pre {
	line-height: normal; border: 0px none white;
}
/**
 * GeSHi Dynamically Generated Stylesheet
 * --------------------------------------
 * Dynamically generated stylesheet for cmake
 * CSS class: source-cmake, CSS id: 
 * GeSHi (C) 2004 - 2007 Nigel McNie, 2007 - 2008 Benny Baumann
 * (http://qbnz.com/highlighter/ and http://geshi.org/)
 * --------------------------------------
 */
.cmake.source-cmake .de1, .cmake.source-cmake .de2 {font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;}
.cmake.source-cmake  {font-family:monospace;}
.cmake.source-cmake .imp {font-weight: bold; color: red;}
.cmake.source-cmake li, .cmake.source-cmake .li1 {font-weight: normal; vertical-align:top;}
.cmake.source-cmake .ln {width:1px;text-align:right;margin:0;padding:0 2px;vertical-align:top;}
.cmake.source-cmake .li2 {font-weight: bold; vertical-align:top;}
.cmake.source-cmake .kw1 {color: #1f3f81; font-style: bold;}
.cmake.source-cmake .kw2 {color: #1f3f81;}
.cmake.source-cmake .kw3 {color: #077807; font-sytle: italic;}
.cmake.source-cmake .co1 {color: #666666; font-style: italic;}
.cmake.source-cmake .es0 {color: #000099; font-weight: bold;}
.cmake.source-cmake .es1 {color: #b08000;}
.cmake.source-cmake .es2 {color: #0000cd;}
.cmake.source-cmake .sy0 {color: #197d8b;}
.cmake.source-cmake .st0 {color: #912f11;}
.cmake.source-cmake .re0 {color: #b08000;}
.cmake.source-cmake .re1 {color: #0000cd;}
.cmake.source-cmake .ln-xtra, .cmake.source-cmake li.ln-xtra, .cmake.source-cmake div.ln-xtra {background-color: #ffc;}
.cmake.source-cmake span.xtra { display:block; }

/*]]>*/
</style><style type="text/css">/*<![CDATA[*/
.source-cpp {line-height: normal;}
.source-cpp li, .source-cpp pre {
	line-height: normal; border: 0px none white;
}
/**
 * GeSHi Dynamically Generated Stylesheet
 * --------------------------------------
 * Dynamically generated stylesheet for cpp
 * CSS class: source-cpp, CSS id: 
 * GeSHi (C) 2004 - 2007 Nigel McNie, 2007 - 2008 Benny Baumann
 * (http://qbnz.com/highlighter/ and http://geshi.org/)
 * --------------------------------------
 */
.cpp.source-cpp .de1, .cpp.source-cpp .de2 {font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;}
.cpp.source-cpp  {font-family:monospace;}
.cpp.source-cpp .imp {font-weight: bold; color: red;}
.cpp.source-cpp li, .cpp.source-cpp .li1 {font-weight: normal; vertical-align:top;}
.cpp.source-cpp .ln {width:1px;text-align:right;margin:0;padding:0 2px;vertical-align:top;}
.cpp.source-cpp .li2 {font-weight: bold; vertical-align:top;}
.cpp.source-cpp .kw1 {color: #0000ff;}
.cpp.source-cpp .kw2 {color: #0000ff;}
.cpp.source-cpp .kw3 {color: #0000dd;}
.cpp.source-cpp .kw4 {color: #0000ff;}
.cpp.source-cpp .co1 {color: #666666;}
.cpp.source-cpp .co2 {color: #339900;}
.cpp.source-cpp .coMULTI {color: #ff0000; font-style: italic;}
.cpp.source-cpp .es0 {color: #000099; font-weight: bold;}
.cpp.source-cpp .es1 {color: #000099; font-weight: bold;}
.cpp.source-cpp .es2 {color: #660099; font-weight: bold;}
.cpp.source-cpp .es3 {color: #660099; font-weight: bold;}
.cpp.source-cpp .es4 {color: #660099; font-weight: bold;}
.cpp.source-cpp .es5 {color: #006699; font-weight: bold;}
.cpp.source-cpp .br0 {color: #008000;}
.cpp.source-cpp .sy0 {color: #008000;}
.cpp.source-cpp .sy1 {color: #000080;}
.cpp.source-cpp .sy2 {color: #000040;}
.cpp.source-cpp .sy3 {color: #000040;}
.cpp.source-cpp .sy4 {color: #008080;}
.cpp.source-cpp .st0 {color: #FF0000;}
.cpp.source-cpp .nu0 {color: #0000dd;}
.cpp.source-cpp .nu6 {color: #208080;}
.cpp.source-cpp .nu8 {color: #208080;}
.cpp.source-cpp .nu12 {color: #208080;}
.cpp.source-cpp .nu16 {color:#800080;}
.cpp.source-cpp .nu17 {color:#800080;}
.cpp.source-cpp .nu18 {color:#800080;}
.cpp.source-cpp .nu19 {color:#800080;}
.cpp.source-cpp .me1 {color: #007788;}
.cpp.source-cpp .me2 {color: #007788;}
.cpp.source-cpp .ln-xtra, .cpp.source-cpp li.ln-xtra, .cpp.source-cpp div.ln-xtra {background-color: #ffc;}
.cpp.source-cpp span.xtra { display:block; }

/*]]>*/
</style><!--[if lt IE 7]><style type="text/css">body{behavior:url("/mediawiki/skins/vector/csshover.min.htc")}</style><![endif]--><script src="MYRAbot%27s%20arm%20control%20%28bioloid+arduino%29%20-%20Rob%C3%B3tica%20-%20ULE_files/load_003.php" async=""></script></head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-MYRAbot_s_arm_control_bioloid_arduino skin-vector action-view vector-animateLayout">
		<div id="mw-page-base" class="noprint"></div>
		<div id="mw-head-base" class="noprint"></div>
		<div id="content" class="mw-body" role="main">
			<a id="top"></a>
			<div id="mw-js-message" style="display:none;"></div>
						<h1 id="firstHeading" class="firstHeading" lang="en"><span dir="auto">MYRAbot's arm control (bioloid+arduino)</span></h1>
			<div id="bodyContent">
								<div id="siteSub">From Robótica - ULE</div>
								<div id="contentSub"></div>
												<div id="jump-to-nav" class="mw-jump">
					Jump to:					<a href="#mw-navigation">navigation</a>, 					<a href="#p-search">search</a>
				</div>
				<div id="mw-content-text" dir="ltr" class="mw-content-ltr" lang="en"><p><a href="http://robotica.unileon.es/mediawiki/index.php/Mobile_manipulation" title="Mobile manipulation"> &lt; go back to main</a>
</p><p><br>
</p>
<hr>
<table style="border: solid 0px white; width: 100%">
<tbody><tr>
<th>Related articles
<hr>
</th>
<th>Other articles
<hr>
</th></tr>
<tr>
<td valign="top" width="50%">
<p><a href="http://robotica.unileon.es/mediawiki/index.php/Objects_recognition_and_position_calculation_%28webcam%29" title="Objects recognition and position calculation (webcam)">Objects recognition and position calculation (webcam)</a><br>
<a href="http://robotica.unileon.es/mediawiki/index.php/MYRAbot%27s_arm_model_for_simulation_%28urdf%2Bgazebo%29" title="MYRAbot's arm model for simulation (urdf+gazebo)">MYRAbot's arm model for simulation (urdf+gazebo)</a><br>
<a href="http://robotica.unileon.es/mediawiki/index.php/MYRAbot_model_for_simulation_%28urdf%2Bgazebo%29" title="MYRAbot model for simulation (urdf+gazebo)">MYRAbot model for simulation (urdf+gazebo)</a><br>
<a href="http://robotica.unileon.es/mediawiki/index.php/Integration_of_MYRAbot_in_moveIt%21_%28gazebo%2BmoveIt%21%29" title="Integration of MYRAbot in moveIt! (gazebo+moveIt!)">Integration of MYRAbot in moveIt! (gazebo+moveIt!)</a><br>
<a href="http://robotica.unileon.es/mediawiki/index.php/Voice_control_%28sphinx%2Bfestival%29" title="Voice control (sphinx+festival)">Voice control (sphinx+festival)</a><br>
<a href="http://robotica.unileon.es/mediawiki/index.php/MYRAbot%27s_Teleoperation_with_xbox360_wireless_controller_%28xbox360_controller%2Bjoy%29" title="MYRAbot's Teleoperation with xbox360 wireless controller (xbox360 controller+joy)">MYRAbot's Teleoperation with xbox360 wireless controller (xbox360 controller+joy)</a>
</p>
</td>
<td valign="top">
<p><a href="http://robotica.unileon.es/mediawiki/index.php/CeRVaNTeS%27_arm_and_base_control_%28maxon%2Bepos2%29" title="CeRVaNTeS' arm and base control (maxon+epos2)">CeRVaNTeS' arm and base control (maxon+epos2)</a><br>
<a href="http://robotica.unileon.es/mediawiki/index.php/CeRVaNTeS%27_arm_model_for_simulation_%28urdf%2Bgazebo%29" title="CeRVaNTeS' arm model for simulation (urdf+gazebo)">CeRVaNTeS' arm model for simulation (urdf+gazebo)</a><br>
<a href="http://robotica.unileon.es/mediawiki/index.php/CeRVaNTeS_model_for_simulation_%28urdf%2Bgazebo%29" title="CeRVaNTeS model for simulation (urdf+gazebo)">CeRVaNTeS model for simulation (urdf+gazebo)</a><br>
<a href="http://robotica.unileon.es/mediawiki/index.php/Integration_of_CeRVaNTeS_in_moveIt%21_%28gazebo%2BmoveIt%21%29" title="Integration of CeRVaNTeS in moveIt! (gazebo+moveIt!)">Integration of CeRVaNTeS in moveIt! (gazebo+moveIt!)</a><br>
<a href="http://robotica.unileon.es/mediawiki/index.php/CeRVaNTeS%27_Teleoperation_with_xbox360_wireless_controller_%28xbox360_controller%2Bjoy%29" title="CeRVaNTeS' Teleoperation with xbox360 wireless controller (xbox360 controller+joy)">CeRVaNTeS' Teleoperation with xbox360 wireless controller (xbox360 controller+joy)</a>
</p>
</td></tr></tbody></table>
<hr>
<p><br>
</p>
<div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2><span class="toctoggle">&nbsp;[<a href="#" class="internal" id="togglelink">hide</a>]&nbsp;</span></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Bioloid_arm"><span class="tocnumber">1</span> <span class="toctext">Bioloid arm</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Arduino_IDE_and_rosserial"><span class="tocnumber">2</span> <span class="toctext">Arduino IDE and rosserial</span></a>
<ul>
<li class="toclevel-2 tocsection-3"><a href="#Creating_a_package_for_our_programs"><span class="tocnumber">2.1</span> <span class="toctext">Creating a package for our programs</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="#First_program_.28To_whole_power.29"><span class="tocnumber">2.2</span> <span class="toctext">First program (To whole power)</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-5"><a href="#Arduino_and_servo_motors_Dinamixel"><span class="tocnumber">3</span> <span class="toctext">Arduino and servo motors Dinamixel</span></a>
<ul>
<li class="toclevel-2 tocsection-6"><a href="#Second_program_.28Move.29"><span class="tocnumber">3.1</span> <span class="toctext">Second program (Move)</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-7"><a href="#Arm.27s_kinematics_model"><span class="tocnumber">4</span> <span class="toctext">Arm's kinematics model</span></a>
<ul>
<li class="toclevel-2 tocsection-8"><a href="#Inverse_kinematic"><span class="tocnumber">4.1</span> <span class="toctext">Inverse kinematic</span></a></li>
<li class="toclevel-2 tocsection-9"><a href="#Direct_kinematics"><span class="tocnumber">4.2</span> <span class="toctext">Direct kinematics</span></a></li>
<li class="toclevel-2 tocsection-10"><a href="#Arm_workspace_and_boundaries"><span class="tocnumber">4.3</span> <span class="toctext">Arm workspace and boundaries</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-11"><a href="#Control_programs"><span class="tocnumber">5</span> <span class="toctext">Control programs</span></a>
<ul>
<li class="toclevel-2 tocsection-12"><a href="#Third_program_.28Come_here.29"><span class="tocnumber">5.1</span> <span class="toctext">Third program (Come here)</span></a>
<ul>
<li class="toclevel-3 tocsection-13"><a href="#Creating_custom_messages_in_ROS"><span class="tocnumber">5.1.1</span> <span class="toctext">Creating custom messages in ROS</span></a></li>
<li class="toclevel-3 tocsection-14"><a href="#Arduino_program"><span class="tocnumber">5.1.2</span> <span class="toctext">Arduino program</span></a></li>
<li class="toclevel-3 tocsection-15"><a href="#ROS_program"><span class="tocnumber">5.1.3</span> <span class="toctext">ROS program</span></a></li>
<li class="toclevel-3 tocsection-16"><a href="#Running_the_program"><span class="tocnumber">5.1.4</span> <span class="toctext">Running the program</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-17"><a href="#Fourth_program_.28Grasp_the_bottle.29"><span class="tocnumber">5.2</span> <span class="toctext">Fourth program (Grasp the bottle)</span></a>
<ul>
<li class="toclevel-3 tocsection-18"><a href="#Include_file_with_functions"><span class="tocnumber">5.2.1</span> <span class="toctext">Include file with functions</span></a></li>
<li class="toclevel-3 tocsection-19"><a href="#Program"><span class="tocnumber">5.2.2</span> <span class="toctext">Program</span></a></li>
<li class="toclevel-3 tocsection-20"><a href="#Running_the_program_2"><span class="tocnumber">5.2.3</span> <span class="toctext">Running the program</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-21"><a href="#Fifth_program_.28Place_the_bottle.29"><span class="tocnumber">5.3</span> <span class="toctext">Fifth program (Place the bottle)</span></a>
<ul>
<li class="toclevel-3 tocsection-22"><a href="#Running_the_program_3"><span class="tocnumber">5.3.1</span> <span class="toctext">Running the program</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-23"><a href="#Sixth_program_.28Follow_the_straight_way.29"><span class="tocnumber">5.4</span> <span class="toctext">Sixth program (Follow the straight way)</span></a>
<ul>
<li class="toclevel-3 tocsection-24"><a href="#Running_the_program_4"><span class="tocnumber">5.4.1</span> <span class="toctext">Running the program</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-25"><a href="#Seventh_program_.28Teleoperator.29"><span class="tocnumber">5.5</span> <span class="toctext">Seventh program (Teleoperator)</span></a>
<ul>
<li class="toclevel-3 tocsection-26"><a href="#Running_the_program_5"><span class="tocnumber">5.5.1</span> <span class="toctext">Running the program</span></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>

<h1><span class="mw-headline" id="Bioloid_arm">Bioloid arm</span></h1>
<p>The arm that we will use is that Carlos Rodríguez Hernández developed in the project <a href="http://robotica.unileon.es/mediawiki/index.php/Carlos-TFM-MYRABot01" title="Carlos-TFM-MYRABot01"> MYRA Robot: Hardware Update </a>. The main components are:
</p>
<div class="thumb tright"><div class="thumbinner" style="width:202px;"><a href="http://robotica.unileon.es/mediawiki/index.php/File:IMG_4871_b.JPG" class="image"><img alt="" src="MYRAbot%27s%20arm%20control%20%28bioloid+arduino%29%20-%20Rob%C3%B3tica%20-%20ULE_files/IMG_4871_b.JPG" class="thumbimage" height="134" width="200"></a>  <div class="thumbcaption"><div class="magnify"><a href="http://robotica.unileon.es/mediawiki/index.php/File:IMG_4871_b.JPG" class="internal" title="Enlarge"><img src="MYRAbot%27s%20arm%20control%20%28bioloid+arduino%29%20-%20Rob%C3%B3tica%20-%20ULE_files/magnify-clip.png" alt="" height="11" width="15"></a></div>Photograph of <a rel="nofollow" class="external text" href="http://www.robotis.com/xe/BIOLOID_main_en">Bioloid</a> arm.</div></div></div>
<ul>
<li> <a rel="nofollow" class="external text" href="http://arduino.cc/en/Main/ArduinoBoardMega2560">Arduino mega 2560</a> board.
</li>
<li> <a rel="nofollow" class="external text" href="http://www.futurlec.com/74LS/74LS241.shtml">74LS241</a> chip (tree-state Buffer).
</li>
<li> Voltage regulator circuit.
</li>
<li> 5 serial servo motors <a rel="nofollow" class="external text" href="http://support.robotis.com/en/product/dynamixel/ax_series/dxl_ax_actuator.htm">Dynamixel AX-12A</a>.
</li>
<li> Mounting components of Bioloid kit.
</li>
<li> Parts made for the gripper and to fix to MYRAbot.
</li>
</ul>
<h1><span class="mw-headline" id="Arduino_IDE_and_rosserial">Arduino IDE and rosserial</span></h1>
<p>For the communication among  <a rel="nofollow" class="external text" href="http://www.arduino.cc/">arduino</a> and <a rel="nofollow" class="external text" href="http://www.ros.org/">ROS</a>, we install <a rel="nofollow" class="external text" href="http://www.arduino.cc/">arduino</a> IDE and rosserial (<i>package</i> de <a rel="nofollow" class="external text" href="http://www.ros.org/">ROS</a> which include the <i>package</i> rosserial_arduino with the libraries for <a rel="nofollow" class="external text" href="http://www.arduino.cc/">arduino</a>. We will start to installing <a rel="nofollow" class="external text" href="http://www.arduino.cc/">arduino</a> IDE, for this, we will execute the next commands in a terminal:
</p>
<div dir="ltr" class="mw-geshi mw-content-ltr"><div class="bash source-bash" style="font-family:monospace;"><pre class="de1"><span class="kw2">sudo</span> <span class="kw2">apt-get</span> update
<span class="kw2">sudo</span> <span class="kw2">apt-get</span> <span class="kw2">install</span> arduino arduino-core</pre></div></div> 
<p>When the installation of <a rel="nofollow" class="external text" href="http://www.arduino.cc/">arduino</a> software ends, we will install the <a rel="nofollow" class="external text" href="http://www.ros.org/">ROS</a> <i>package</i>. For this, we will execute the next command in a terminal:
</p>
<div dir="ltr" class="mw-geshi mw-content-ltr"><div class="bash source-bash" style="font-family:monospace;"><pre class="de1"><span class="kw2">sudo</span> <span class="kw2">apt-get</span> <span class="kw2">install</span> ros-ROS_DISTRO-rosserial</pre></div></div>
<p>When we will have installed <a rel="nofollow" class="external text" href="http://www.arduino.cc/">arduino</a> IDE and the <i>stack</i> rosserial, we must copy the libraries for the <i>package</i> rosserial_arduino to the sketchbook of <a rel="nofollow" class="external text" href="http://www.arduino.cc/">arduino</a>. For this, we will execute the next commands in a terminal:
</p>
<div dir="ltr" class="mw-geshi mw-content-ltr"><div class="bash source-bash" style="font-family:monospace;"><pre class="de1">roscd rosserial_arduino<span class="sy0">/</span>libraries
<span class="kw2">cp</span> <span class="re5">-r</span> ros_lib <span class="sy0">/</span>home<span class="sy0">/</span>”SESSION_NAME”<span class="sy0">/</span>sketchbook<span class="sy0">/</span>libraries<span class="sy0">/</span>ros_lib</pre></div></div>
<h2><span class="mw-headline" id="Creating_a_package_for_our_programs">Creating a package for our programs</span></h2>
<p>Previously, we must have created a <a href="http://robotica.unileon.es/mediawiki/index.php/Fernando-TFM-ROS02#Creando_un_espacio_de_trabajo" title="Fernando-TFM-ROS02">workspace</a> for our <a rel="nofollow" class="external text" href="http://www.ros.org/">ROS</a> distribution. We will create a <i>package</i> in order to compile and send our programs to <a rel="nofollow" class="external text" href="http://www.arduino.cc/">arduino</a> board. We will make a <i>package</i>
 named "arduino_fer" with the the necessary dependences for our 
programs, for this, we will execute the next commands in a terminal:
</p>
<div dir="ltr" class="mw-geshi mw-content-ltr"><div class="bash source-bash" style="font-family:monospace;"><pre class="de1"><span class="kw3">cd</span> ~<span class="sy0">/</span>ros_workspace
roscreate-pkg arduino_fer rosserial_arduino std_msgs</pre></div></div>
<p>We must change the content of the file "CMakeLists.txt" of our <i>package</i> for the next lines:
</p>
<div dir="ltr" class="mw-geshi mw-content-ltr"><div class="cmake source-cmake" style="font-family:monospace;"><pre class="de1"><span class="kw1">cmake_minimum_required</span><span class="sy0">(</span><span class="kw3">VERSION</span> 2.4.6<span class="sy0">)</span>
<span class="kw1">include</span><span class="sy0">(</span><span class="re0">$ENV{ROS_ROOT}</span>/core/rosbuild/rosbuild.cmake<span class="sy0">)</span>
&nbsp;
rosbuild_find_ros_package<span class="sy0">(</span>rosserial_arduino<span class="sy0">)</span>
<span class="kw1">include</span><span class="sy0">(</span><span class="re0">${rosserial_arduino_PACKAGE_PATH}</span>/cmake_scripts/rosserial.cmake<span class="sy0">)</span></pre></div></div>
<p>We will execute the next commands in a terminal in order to finalize the creation of the package:
</p>
<div dir="ltr" class="mw-geshi mw-content-ltr"><div class="bash source-bash" style="font-family:monospace;"><pre class="de1">roscd arduino_fer
cmake .</pre></div></div>
<h2><span class="mw-headline" id="First_program_.28To_whole_power.29">First program (To whole power)</span></h2>
<p>We will make the first program that publishes a <i>topic</i> named "cifra" and subscribe a <i>topic</i> named "resultado". When we publish a number in the <i>topic</i> "cifra" the program multiplies the number by itself and publishes the result in the <i>topic</i> "resultado". The code of the program is shown below:
</p>
<div dir="ltr" class="mw-geshi mw-content-ltr"><div class="cpp source-cpp" style="font-family:monospace;"><pre class="de1"><span class="co2">#include &lt;ros.h&gt; </span>
<span class="co2">#include &lt;std_msgs/Int16.h&gt; </span>
&nbsp;
ros<span class="sy4">::</span><span class="me2">NodeHandle</span> nh<span class="sy4">;</span> 
<span class="kw4">int</span> pot<span class="sy4">;</span> 
&nbsp;
<span class="kw4">void</span> potencia<span class="br0">(</span> <span class="kw4">const</span> std_msgs<span class="sy4">::</span><span class="me2">Int16</span><span class="sy3">&amp;</span> cifra<span class="br0">)</span><span class="br0">{</span> 
&nbsp;
<span class="sy4">::</span><span class="me2">pot</span> <span class="sy1">=</span> cifra.<span class="me1">data</span><span class="sy2">*</span>cifra.<span class="me1">data</span><span class="sy4">;</span> 
<span class="br0">}</span> 
&nbsp;
ros<span class="sy4">::</span><span class="me2">Subscriber</span><span class="sy1">&lt;</span>std_msgs<span class="sy4">::</span><span class="me2">Int16</span><span class="sy1">&gt;</span> sub<span class="br0">(</span><span class="st0">"cifra"</span>, <span class="sy3">&amp;</span>potencia <span class="br0">)</span><span class="sy4">;</span> 
std_msgs<span class="sy4">::</span><span class="me2">Int16</span> res<span class="sy4">;</span> 
&nbsp;
ros<span class="sy4">::</span><span class="me2">Publisher</span> pub<span class="br0">(</span><span class="st0">"resultado"</span>, <span class="sy3">&amp;</span>res<span class="br0">)</span><span class="sy4">;</span> 
&nbsp;
<span class="kw4">void</span> setup<span class="br0">(</span><span class="br0">)</span> 
<span class="br0">{</span> 
  nh.<span class="me1">initNode</span><span class="br0">(</span><span class="br0">)</span><span class="sy4">;</span> 
  nh.<span class="me1">subscribe</span><span class="br0">(</span>sub<span class="br0">)</span><span class="sy4">;</span>  
  nh.<span class="me1">advertise</span><span class="br0">(</span>pub<span class="br0">)</span><span class="sy4">;</span> 
<span class="br0">}</span> 
&nbsp;
<span class="kw4">void</span> loop<span class="br0">(</span><span class="br0">)</span> 
<span class="br0">{</span> 
  res.<span class="me1">data</span> <span class="sy1">=</span> <span class="sy4">::</span><span class="me2">pot</span><span class="sy4">;</span> 
  pub.<span class="me1">publish</span><span class="br0">(</span> <span class="sy3">&amp;</span>res <span class="br0">)</span><span class="sy4">;</span> 
  nh.<span class="me1">spinOnce</span><span class="br0">(</span><span class="br0">)</span><span class="sy4">;</span> 
  delay<span class="br0">(</span>1000<span class="br0">)</span><span class="sy4">;</span> 
<span class="br0">}</span></pre></div></div>
<p>We must add to the file "CMakeLists.txt" the lines indicated below in order in order to compile the program and send to <a rel="nofollow" class="external text" href="http://www.arduino.cc/">arduino</a> board:
</p>
<div dir="ltr" class="mw-geshi mw-content-ltr"><div class="cmake source-cmake" style="font-family:monospace;"><pre class="de1"><span class="kw1">set</span><span class="sy0">(</span>FIRMWARE_NAME potencia<span class="sy0">)</span>
&nbsp;
<span class="kw1">set</span><span class="sy0">(</span><span class="re0">${FIRMWARE_NAME}</span>_BOARD MODELO_NUESTRA_PLACA<span class="sy0">)</span>   <span class="co1"># Model of arduino board</span>
<span class="kw1">set</span><span class="sy0">(</span><span class="re0">${FIRMWARE_NAME}</span>_SRCS src/potencia.cpp <span class="sy0">)</span>
<span class="kw1">set</span><span class="sy0">(</span><span class="re0">${FIRMWARE_NAME}</span>_PORT /dev/ttyACM0<span class="sy0">)</span>            <span class="co1"># Serial port to upload</span>
generate_ros_firmware<span class="sy0">(</span><span class="re0">${FIRMWARE_NAME}</span><span class="sy0">)</span></pre></div></div>
<p>Here is set the name for the program, type of <a rel="nofollow" class="external text" href="http://www.arduino.cc/">arduino</a>
 board (uno, atmega328 o mega2560), name and address of the file, and 
serial port of the PC used to communicate with the board. We have to 
execute the next commands in a terminal:
</p>
<div dir="ltr" class="mw-geshi mw-content-ltr"><div class="bash source-bash" style="font-family:monospace;"><pre class="de1">roscd arduino_fer
<span class="kw2">make</span> potencia-upload</pre></div></div>
<p>We must launch the <a rel="nofollow" class="external text" href="http://www.ros.org/">ROS</a>
 core in a terminal in order to allow the execution of the program, if 
it is not already launched. We will execute the next command in a 
terminal:
</p>
<div dir="ltr" class="mw-geshi mw-content-ltr"><div class="bash source-bash" style="font-family:monospace;"><pre class="de1">roscore</pre></div></div>
<p>In other terminal, we will execute the node that communicates <a rel="nofollow" class="external text" href="http://www.ros.org/">ROS</a> with the <a rel="nofollow" class="external text" href="http://www.arduino.cc/">arduino</a>
 board, we set the port that is used to communication. In order to know 
the port that is used, we can see the port used in the menu 
"Tools"&gt;"Serial port" of the software <a rel="nofollow" class="external text" href="http://www.arduino.cc/">arduino</a> IDE, the board must be plugged. In this case the port is "ttyACM0".
</p>
<div dir="ltr" class="mw-geshi mw-content-ltr"><div class="bash source-bash" style="font-family:monospace;"><pre class="de1">rosrun rosserial_python serial_node.py <span class="sy0">/</span>dev<span class="sy0">/</span>ttyACM0</pre></div></div>
<p>We will execute in other terminal the next command in order to publish a number in the <i>topic</i> "cifra":
</p>
<div dir="ltr" class="mw-geshi mw-content-ltr"><div class="bash source-bash" style="font-family:monospace;"><pre class="de1">rostopic pub cifra std_msgs<span class="sy0">/</span>Int16 NUMBER <span class="re5">--once</span></pre></div></div>
<p>We will execute in other terminal the next command in order to test 
that the program calculates the square of the published number in the <i>topic</i> "cifra" and publishes the result in the <i>topic</i> "resultado":
</p>
<div dir="ltr" class="mw-geshi mw-content-ltr"><div class="bash source-bash" style="font-family:monospace;"><pre class="de1">rostopic <span class="kw3">echo</span> resultado</pre></div></div>
<h1><span class="mw-headline" id="Arduino_and_servo_motors_Dinamixel">Arduino and servo motors Dinamixel</span></h1>
<p>In <a rel="nofollow" class="external text" href="http://savageelectronics.blogspot.com.es/2011/01/arduino-y-dynamixel-ax-12.html">Savage Electronics</a> we can find the hardware adaptations to communicate the <a rel="nofollow" class="external text" href="http://arduino.cc/en/Main/ArduinoBoardMega2560">arduino mega 2560</a> board with the servo motors <a rel="nofollow" class="external text" href="http://support.robotis.com/en/product/dynamixel/ax_series/dxl_ax_actuator.htm">Dynamixel AX-12A</a> of <a rel="nofollow" class="external text" href="http://www.robotis.com/xe/">ROBOTICS</a>. Here also we can find the libraries for programming (<a rel="nofollow" class="external text" href="http://savageelectronics.blogspot.com.es/2011/08/actualizacion-biblioteca-dynamixel.html">DynamixelSerial</a>).
</p>
<h2><span class="mw-headline" id="Second_program_.28Move.29">Second program (Move)</span></h2>
<p>This program is a test of the communications between <a rel="nofollow" class="external text" href="http://arduino.cc/en/Main/ArduinoBoardMega2560">arduino mega 2560</a> board and servo motor <a rel="nofollow" class="external text" href="http://support.robotis.com/en/product/dynamixel/ax_series/dxl_ax_actuator.htm">Dynamixel AX-12A</a>. The program publishes the <i>topic</i> "angulo" which contains the position of the servo motor (between 0 and 1023) and subscribes the <i>topic</i>
 "giro" which receives the goal position (between 0 and 1023). The servo
 motor will move with a constant velocity of 128 (Integer between 0 and 
1023). The code of the program is shown below:
</p>
<div dir="ltr" class="mw-geshi mw-content-ltr"><div class="cpp source-cpp" style="font-family:monospace;"><pre class="de1"><span class="co2">#include &lt;ros.h&gt;</span>
<span class="co2">#include &lt;std_msgs/Int16.h&gt;</span>
<span class="co2">#include &lt;DynamixelSerial1.h&gt;</span>
&nbsp;
ros<span class="sy4">::</span><span class="me2">NodeHandle</span> nh<span class="sy4">;</span>
&nbsp;
&nbsp;
<span class="kw4">void</span> mover<span class="br0">(</span> <span class="kw4">const</span> std_msgs<span class="sy4">::</span><span class="me2">Int16</span><span class="sy3">&amp;</span> giro<span class="br0">)</span><span class="br0">{</span>
&nbsp;
  Dynamixel.<span class="me1">moveSpeed</span><span class="br0">(</span>1,giro.<span class="me1">data</span>,128<span class="br0">)</span><span class="sy4">;</span>
&nbsp;
<span class="br0">}</span>
&nbsp;
ros<span class="sy4">::</span><span class="me2">Subscriber</span><span class="sy1">&lt;</span>std_msgs<span class="sy4">::</span><span class="me2">Int16</span><span class="sy1">&gt;</span> sub<span class="br0">(</span><span class="st0">"giro"</span>, <span class="sy3">&amp;</span>mover <span class="br0">)</span><span class="sy4">;</span>
&nbsp;
std_msgs<span class="sy4">::</span><span class="me2">Int16</span> ang<span class="sy4">;</span>
ros<span class="sy4">::</span><span class="me2">Publisher</span> pub<span class="br0">(</span><span class="st0">"angulo"</span>, <span class="sy3">&amp;</span>ang<span class="br0">)</span><span class="sy4">;</span>
&nbsp;
<span class="kw4">void</span> setup<span class="br0">(</span><span class="br0">)</span>
<span class="br0">{</span>
  nh.<span class="me1">initNode</span><span class="br0">(</span><span class="br0">)</span><span class="sy4">;</span>
  nh.<span class="me1">subscribe</span><span class="br0">(</span>sub<span class="br0">)</span><span class="sy4">;</span>  
  nh.<span class="me1">advertise</span><span class="br0">(</span>pub<span class="br0">)</span><span class="sy4">;</span>
  Dynamixel.<span class="me1">begin</span><span class="br0">(</span>1000000,2<span class="br0">)</span><span class="sy4">;</span>
  delay<span class="br0">(</span>1000<span class="br0">)</span><span class="sy4">;</span>
<span class="br0">}</span>
&nbsp;
<span class="kw4">void</span> loop<span class="br0">(</span><span class="br0">)</span>
<span class="br0">{</span>
  <span class="kw4">int</span> posicion <span class="sy1">=</span> Dynamixel.<span class="me1">readPosition</span><span class="br0">(</span>1<span class="br0">)</span><span class="sy4">;</span>
  ang.<span class="me1">data</span> <span class="sy1">=</span> posicion<span class="sy4">;</span>
  pub.<span class="me1">publish</span><span class="br0">(</span> <span class="sy3">&amp;</span>ang <span class="br0">)</span><span class="sy4">;</span>
  nh.<span class="me1">spinOnce</span><span class="br0">(</span><span class="br0">)</span><span class="sy4">;</span>
  delay<span class="br0">(</span>10<span class="br0">)</span><span class="sy4">;</span>
<span class="br0">}</span></pre></div></div>
<p>We can't use the <a href="#Creating_a_package_for_our_programs">previously made <i>package</i></a> in order to compile and send the program to the <a rel="nofollow" class="external text" href="http://www.arduino.cc/">arduino</a> board. We must use the <a rel="nofollow" class="external text" href="http://www.arduino.cc/">arduino</a> IDE software due to that we use a external library to <a rel="nofollow" class="external text" href="http://www.ros.org/">ROS</a> system. When the program was uploaded we will execute the next command in a terminal, to launch the core system:
</p>
<div dir="ltr" class="mw-geshi mw-content-ltr"><div class="bash source-bash" style="font-family:monospace;"><pre class="de1">roscore</pre></div></div>
<p>We will execute the next command in other terminal in order to launch the communication node <a rel="nofollow" class="external text" href="http://www.ros.org/">ROS</a>-<a rel="nofollow" class="external text" href="http://www.arduino.cc/">arduino</a>:
</p>
<div dir="ltr" class="mw-geshi mw-content-ltr"><div class="bash source-bash" style="font-family:monospace;"><pre class="de1">rosrun rosserial_python serial_node.py <span class="sy0">/</span>dev<span class="sy0">/</span>ttyACM0</pre></div></div>
<p>We will execute the next command in other terminal in order to publish the goal position of the servo motor in the <i>topic</i> "giro":
</p>
<div dir="ltr" class="mw-geshi mw-content-ltr"><div class="bash source-bash" style="font-family:monospace;"><pre class="de1">rostopic pub giro std_msgs<span class="sy0">/</span>Int16 GOAL_POSITION <span class="re5">--once</span></pre></div></div>
<p>The servo motor will immediately move to the goal position. We can 
execute the next command in other terminal in order to see the position 
value of the servo motor at any time:
</p>
<div dir="ltr" class="mw-geshi mw-content-ltr"><div class="bash source-bash" style="font-family:monospace;"><pre class="de1">rostopic <span class="kw3">echo</span> angulo</pre></div></div>
<h1><span class="mw-headline" id="Arm.27s_kinematics_model">Arm's kinematics model</span></h1>
<p>We need to know the spatial position of the arm for the correct 
placement of the gripper. The position depends on the position angle of 
the servo motors (direct kinematics). We know the goal point and we must
 obtain the position angle of the servo motors to achieve it (inverse 
kinematics). The arm have 5 joints (1 to open-close gripper) and all 
work in the same plane, for this reason we don't need use the <a rel="nofollow" class="external text" href="http://en.wikipedia.org/wiki/Denavit%E2%80%93Hartenberg_parameters">Denavit-Hartenberg parameters</a>.
</p>
<div class="center"><div class="thumb tnone"><div class="thumbinner" style="width:502px;"><a href="http://robotica.unileon.es/mediawiki/index.php/File:Brazo_cinematica.jpg" class="image"><img alt="" src="MYRAbot%27s%20arm%20control%20%28bioloid+arduino%29%20-%20Rob%C3%B3tica%20-%20ULE_files/Brazo_cinematica.jpg" class="thumbimage" height="395" width="500"></a>  <div class="thumbcaption"><div class="magnify"><a href="http://robotica.unileon.es/mediawiki/index.php/File:Brazo_cinematica.jpg" class="internal" title="Enlarge"><img src="MYRAbot%27s%20arm%20control%20%28bioloid+arduino%29%20-%20Rob%C3%B3tica%20-%20ULE_files/magnify-clip.png" alt="" height="11" width="15"></a></div>Diagrams for kinematics study</div></div></div></div>
<h2><span class="mw-headline" id="Inverse_kinematic">Inverse kinematic</span></h2>
<p>We use the diagram shown above to obtain the inverse kinematics. Where <i>x</i>, <i>y</i> and <i>z</i>
 are the goal point coordinates, and ε is the angle that the gripper 
forms with x-z plane. The obtained equations are shown below:
</p><p><a href="http://robotica.unileon.es/mediawiki/index.php/File:Brazo_ecuaciones.jpg" class="image"><img alt="Brazo ecuaciones.jpg" src="MYRAbot%27s%20arm%20control%20%28bioloid+arduino%29%20-%20Rob%C3%B3tica%20-%20ULE_files/Brazo_ecuaciones.jpg" height="746" width="358"></a>
</p><p>We have to calculate the value of position angle for the servo motors <a rel="nofollow" class="external text" href="http://support.robotis.com/en/product/dynamixel/ax_series/dxl_ax_actuator.htm">Dynamixel AX-12A</a> according its turn limits (1023 positions throughout 300º):
</p>
<div class="thumb tright"><div class="thumbinner" style="width:252px;"><a href="http://robotica.unileon.es/mediawiki/index.php/File:Brazo_dynamixel_AX-12.jpg" class="image"><img alt="" src="MYRAbot%27s%20arm%20control%20%28bioloid+arduino%29%20-%20Rob%C3%B3tica%20-%20ULE_files/Brazo_dynamixel_AX-12.jpg" class="thumbimage" height="192" width="250"></a>  <div class="thumbcaption"><div class="magnify"><a href="http://robotica.unileon.es/mediawiki/index.php/File:Brazo_dynamixel_AX-12.jpg" class="internal" title="Enlarge"><img src="MYRAbot%27s%20arm%20control%20%28bioloid+arduino%29%20-%20Rob%C3%B3tica%20-%20ULE_files/magnify-clip.png" alt="" height="11" width="15"></a></div>Diagrama de ángulos servomotor <a rel="nofollow" class="external text" href="http://support.robotis.com/en/product/dynamixel/ax_series/dxl_ax_actuator.htm">Dynamixel AX-12A</a></div></div></div>
<p><a href="http://robotica.unileon.es/mediawiki/index.php/File:Brazo_ecuacion_base.jpg" class="image"><img alt="Brazo ecuacion base.jpg" src="MYRAbot%27s%20arm%20control%20%28bioloid+arduino%29%20-%20Rob%C3%B3tica%20-%20ULE_files/Brazo_ecuacion_base.jpg" height="64" width="213"></a> We add 150º from the position angle in order to set the 0º coincident with z axis.
</p><p><a href="http://robotica.unileon.es/mediawiki/index.php/File:Brazo_ecuacion_arti1.jpg" class="image"><img alt="Brazo ecuacion arti1.jpg" src="MYRAbot%27s%20arm%20control%20%28bioloid+arduino%29%20-%20Rob%C3%B3tica%20-%20ULE_files/Brazo_ecuacion_arti1.jpg" height="64" width="213"></a> We add 60º from the position angle in order to set the 0º coincident with z axis.
</p><p><a href="http://robotica.unileon.es/mediawiki/index.php/File:Brazo_ecuacion_arti2.jpg" class="image"><img alt="Brazo ecuacion arti2.jpg" src="MYRAbot%27s%20arm%20control%20%28bioloid+arduino%29%20-%20Rob%C3%B3tica%20-%20ULE_files/Brazo_ecuacion_arti2.jpg" height="64" width="213"></a> We subtract 30º from the position angle in order to set the 0º coincident with the longitudinal axis of servo motor.
</p><p><a href="http://robotica.unileon.es/mediawiki/index.php/File:Brazo_ecuacion_arti3.jpg" class="image"><img alt="Brazo ecuacion arti3.jpg" src="MYRAbot%27s%20arm%20control%20%28bioloid+arduino%29%20-%20Rob%C3%B3tica%20-%20ULE_files/Brazo_ecuacion_arti3.jpg" height="64" width="213"></a> We subtract 30º from the position angle in order to set the 0º coincident with the longitudinal axis of servo motor.
</p>
<h2><span class="mw-headline" id="Direct_kinematics">Direct kinematics</span></h2>
<p>We can use the previous equations to obtain the placement point 
through the position angle of the servo motors. The equations are shown 
below:
</p><p><a href="http://robotica.unileon.es/mediawiki/index.php/File:Brazo_ecuaciones_directa.jpg" class="image"><img alt="Brazo ecuaciones directa.jpg" src="MYRAbot%27s%20arm%20control%20%28bioloid+arduino%29%20-%20Rob%C3%B3tica%20-%20ULE_files/Brazo_ecuaciones_directa.jpg" height="824" width="335"></a>
</p>
<h2><span class="mw-headline" id="Arm_workspace_and_boundaries">Arm workspace and boundaries</span></h2>
<p>We need to set the boundaries of the position angles of the servo 
motors to avoid self collisions and collision with other parts of 
MYRAbot. We have made a spreadsheet using the equations for inverse and 
direct kinematics. The spreadsheet shows the spacial placement of the 
arm in two dispersion graphs.
</p>
<div class="center"><div class="thumb tnone"><div class="thumbinner" style="width:752px;"><a href="http://robotica.unileon.es/mediawiki/index.php/File:Brazo_cinematica_excel.jpg" class="image"><img alt="" src="MYRAbot%27s%20arm%20control%20%28bioloid+arduino%29%20-%20Rob%C3%B3tica%20-%20ULE_files/Brazo_cinematica_excel.jpg" class="thumbimage" height="345" width="750"></a>  <div class="thumbcaption"><div class="magnify"><a href="http://robotica.unileon.es/mediawiki/index.php/File:Brazo_cinematica_excel.jpg" class="internal" title="Enlarge"><img src="MYRAbot%27s%20arm%20control%20%28bioloid+arduino%29%20-%20Rob%C3%B3tica%20-%20ULE_files/magnify-clip.png" alt="" height="11" width="15"></a></div>Spreadsheet of inverse and direct kinematics, <a rel="nofollow" class="external text" href="http://www.fernando.casadogarcia.es/files/cinematica_brazo_MYRAbot.xlsx">download</a></div></div></div></div>
<h1><span class="mw-headline" id="Control_programs">Control programs</span></h1>
<h2><span class="mw-headline" id="Third_program_.28Come_here.29">Third program (Come here)</span></h2>
<p>We place a interface program in <a rel="nofollow" class="external text" href="http://www.arduino.cc/">arduino</a> board that communicates the servo motor with the control programs in <a rel="nofollow" class="external text" href="http://www.ros.org/">ROS</a>. We need publish and subscribe the data of 5 servo motors so we will create own messages.
</p>
<h3><span class="mw-headline" id="Creating_custom_messages_in_ROS">Creating custom messages in ROS</span></h3>
<p>First, we will create a new <i>package</i> with the necessary 
dependences for our programs (std_msgs geometry_msgs roscpp). We will 
execute the next commands in a terminal:
</p>
<div dir="ltr" class="mw-geshi mw-content-ltr"><div class="bash source-bash" style="font-family:monospace;"><pre class="de1"><span class="kw3">cd</span> ~<span class="sy0">/</span>ros_workspace
roscreate-pkg brazo_fer std_msgs geometry_msgs roscpp</pre></div></div>
<p>We will create a folder named "msg" within the created <i>package</i>, here we place the next description files for our messages (data type and field name).
</p><p>We will create the basis message that contains the data for each 
servo motor. We will create a file named "Servos.msg" with the content 
that is shown below:
</p>
<div dir="ltr" class="mw-geshi mw-content-ltr"><div class="bash source-bash" style="font-family:monospace;"><pre class="de1">int16 base
int16 arti1
int16 arti2
int16 arti3
int16 pinza</pre></div></div>
<p>We will use the previous message in order to define the data type. We
 will create a file named "WriteServos.msg" to send data to the servo 
motors (position, velocity and torque) with the content that is shown 
below:
</p>
<div dir="ltr" class="mw-geshi mw-content-ltr"><div class="bash source-bash" style="font-family:monospace;"><pre class="de1">Servos posicion
Servos velocidad
Servos par</pre></div></div>
<p>We will create a file named "ReadServos.msg" in order to receive data
 to the servo motors (position, status and current) with the content 
that is shown below:
</p>
<div dir="ltr" class="mw-geshi mw-content-ltr"><div class="bash source-bash" style="font-family:monospace;"><pre class="de1">Servos posicion
Servos estado
Servos corriente</pre></div></div>
<p>We have to edit the file "CMakeLists.tx" in our <i>package</i> in order to allow the creation the <a rel="nofollow" class="external text" href="http://www.ros.org/">ROS</a> messages. We will delete the symbol "#" in the line that is shown below:
</p>
<div dir="ltr" class="mw-geshi mw-content-ltr"><div class="bash source-bash" style="font-family:monospace;"><pre class="de1"><span class="co0"># rosbuild_gensrv()</span></pre></div></div>
<p>We will execute the next commands in a terminal in order to compile 
and create the messages, where "brazo_fer" is the name of the created <i>package</i>:
</p>
<div dir="ltr" class="mw-geshi mw-content-ltr"><div class="bash source-bash" style="font-family:monospace;"><pre class="de1">roscd brazo_fer
<span class="kw2">make</span></pre></div></div>
<p>We will execute the next command in a terminal in order to add this messages to the <a rel="nofollow" class="external text" href="http://www.arduino.cc/">arduino</a> libraries in "rosserial": 
</p>
<div dir="ltr" class="mw-geshi mw-content-ltr"><div class="bash source-bash" style="font-family:monospace;"><pre class="de1">rosrun rosserial_client make_library.py ~<span class="sy0">/</span>sketchbook<span class="sy0">/</span>libraries brazo_fer</pre></div></div>
<h3><span class="mw-headline" id="Arduino_program">Arduino program</span></h3>
<p>The program for <a rel="nofollow" class="external text" href="http://www.arduino.cc/">arduino</a> board subscribes the <i>topic</i>
 "move_arm" which receives the orders for the servo motors and publishes
 the "topic" "pose_arm" which sends the servo motors information. The 
code of the program is shown below:
</p>
<div dir="ltr" class="mw-geshi mw-content-ltr"><div class="cpp source-cpp" style="font-family:monospace;"><pre class="de1"><span class="co2">#include &lt;ros.h&gt;</span>
<span class="co2">#include &lt;brazo_fer/Servos.h&gt;</span>
<span class="co2">#include &lt;brazo_fer/WriteServos.h&gt;</span>
<span class="co2">#include &lt;brazo_fer/ReadServos.h&gt;</span>
<span class="co2">#include &lt;std_msgs/Bool.h&gt;</span>
<span class="co2">#include &lt;math.h&gt;</span>
&nbsp;
<span class="co2">#include &lt;DynamixelSerial1.h&gt;</span>
&nbsp;
ros<span class="sy4">::</span><span class="me2">NodeHandle</span> nh<span class="sy4">;</span>
&nbsp;
<span class="kw4">void</span> mover<span class="br0">(</span><span class="kw4">const</span> brazo_fer<span class="sy4">::</span><span class="me2">WriteServos</span><span class="sy3">&amp;</span> brazo<span class="br0">)</span><span class="br0">{</span>
&nbsp;
  brazo_fer<span class="sy4">::</span><span class="me2">Servos</span> par <span class="sy1">=</span> brazo.<span class="me1">par</span><span class="sy4">;</span>
&nbsp;
  brazo_fer<span class="sy4">::</span><span class="me2">Servos</span> vel <span class="sy1">=</span> brazo.<span class="me1">velocidad</span><span class="sy4">;</span>
&nbsp;
  brazo_fer<span class="sy4">::</span><span class="me2">Servos</span> move <span class="sy1">=</span> brazo.<span class="me1">posicion</span><span class="sy4">;</span>
&nbsp;
  <span class="kw4">int</span> posicion<span class="br0">[</span>4<span class="br0">]</span><span class="sy4">;</span>
&nbsp;
  <span class="kw1">if</span> <span class="br0">(</span>par.<span class="me1">base</span> <span class="sy1">==</span> 0<span class="br0">)</span><span class="br0">{</span>
    Dynamixel.<span class="me1">torqueStatus</span><span class="br0">(</span>1,OFF<span class="br0">)</span><span class="sy4">;</span>
  <span class="br0">}</span>
  <span class="kw1">else</span> <span class="br0">{</span>
    Dynamixel.<span class="me1">torqueStatus</span><span class="br0">(</span>1,ON<span class="br0">)</span><span class="sy4">;</span>
&nbsp;
    Dynamixel.<span class="me1">moveSpeed</span><span class="br0">(</span>1,move.<span class="me1">base</span>,vel.<span class="me1">base</span><span class="br0">)</span><span class="sy4">;</span>  
  <span class="br0">}</span>
&nbsp;
  <span class="kw1">if</span> <span class="br0">(</span>par.<span class="me1">arti1</span> <span class="sy1">==</span> 0<span class="br0">)</span><span class="br0">{</span>
    Dynamixel.<span class="me1">torqueStatus</span><span class="br0">(</span>2,OFF<span class="br0">)</span><span class="sy4">;</span>
  <span class="br0">}</span>
  <span class="kw1">else</span> <span class="br0">{</span>
    Dynamixel.<span class="me1">torqueStatus</span><span class="br0">(</span>2,ON<span class="br0">)</span><span class="sy4">;</span>
&nbsp;
    Dynamixel.<span class="me1">moveSpeed</span><span class="br0">(</span>2,move.<span class="me1">arti1</span>,vel.<span class="me1">arti1</span><span class="br0">)</span><span class="sy4">;</span>  
  <span class="br0">}</span>
&nbsp;
  <span class="kw1">if</span> <span class="br0">(</span>par.<span class="me1">arti2</span> <span class="sy1">==</span> 0<span class="br0">)</span><span class="br0">{</span>
    Dynamixel.<span class="me1">torqueStatus</span><span class="br0">(</span>3,OFF<span class="br0">)</span><span class="sy4">;</span>
  <span class="br0">}</span>
  <span class="kw1">else</span> <span class="br0">{</span>
    Dynamixel.<span class="me1">torqueStatus</span><span class="br0">(</span>3,ON<span class="br0">)</span><span class="sy4">;</span>
&nbsp;
    Dynamixel.<span class="me1">moveSpeed</span><span class="br0">(</span>3,move.<span class="me1">arti2</span>,vel.<span class="me1">arti2</span><span class="br0">)</span><span class="sy4">;</span>  
  <span class="br0">}</span>
&nbsp;
  <span class="kw1">if</span> <span class="br0">(</span>par.<span class="me1">arti3</span> <span class="sy1">==</span> 0<span class="br0">)</span><span class="br0">{</span>
    Dynamixel.<span class="me1">torqueStatus</span><span class="br0">(</span>4,OFF<span class="br0">)</span><span class="sy4">;</span>
  <span class="br0">}</span>
  <span class="kw1">else</span> <span class="br0">{</span>
    Dynamixel.<span class="me1">torqueStatus</span><span class="br0">(</span>4,ON<span class="br0">)</span><span class="sy4">;</span>    
&nbsp;
    Dynamixel.<span class="me1">moveSpeed</span><span class="br0">(</span>4,move.<span class="me1">arti3</span>,vel.<span class="me1">arti3</span><span class="br0">)</span><span class="sy4">;</span>  
  <span class="br0">}</span>
&nbsp;
<span class="br0">}</span>
&nbsp;
<span class="kw4">void</span> pinza<span class="br0">(</span><span class="kw4">const</span> brazo_fer<span class="sy4">::</span><span class="me2">WriteServos</span><span class="sy3">&amp;</span> pinza<span class="br0">)</span><span class="br0">{</span>
&nbsp;
  brazo_fer<span class="sy4">::</span><span class="me2">Servos</span> par <span class="sy1">=</span> pinza.<span class="me1">par</span><span class="sy4">;</span>
&nbsp;
  brazo_fer<span class="sy4">::</span><span class="me2">Servos</span> vel <span class="sy1">=</span> pinza.<span class="me1">velocidad</span><span class="sy4">;</span>
&nbsp;
  brazo_fer<span class="sy4">::</span><span class="me2">Servos</span> move <span class="sy1">=</span> pinza.<span class="me1">posicion</span><span class="sy4">;</span>
&nbsp;
  <span class="kw4">int</span> posicion<span class="sy4">;</span>
&nbsp;
  <span class="kw1">if</span> <span class="br0">(</span>par.<span class="me1">pinza</span> <span class="sy1">==</span> 0<span class="br0">)</span><span class="br0">{</span>
    Dynamixel.<span class="me1">torqueStatus</span><span class="br0">(</span>5,OFF<span class="br0">)</span><span class="sy4">;</span>
  <span class="br0">}</span>
  <span class="kw1">else</span> <span class="br0">{</span>
    Dynamixel.<span class="me1">torqueStatus</span><span class="br0">(</span>5,ON<span class="br0">)</span><span class="sy4">;</span>    
&nbsp;
    Dynamixel.<span class="me1">moveSpeed</span><span class="br0">(</span>5,move.<span class="me1">pinza</span>,vel.<span class="me1">pinza</span><span class="br0">)</span><span class="sy4">;</span>  
  <span class="br0">}</span>
&nbsp;
<span class="br0">}</span>
&nbsp;
ros<span class="sy4">::</span><span class="me2">Subscriber</span><span class="sy1">&lt;</span>brazo_fer<span class="sy4">::</span><span class="me2">WriteServos</span><span class="sy1">&gt;</span> move_sub<span class="br0">(</span><span class="st0">"move_arm"</span>, <span class="sy3">&amp;</span>mover <span class="br0">)</span><span class="sy4">;</span>
ros<span class="sy4">::</span><span class="me2">Subscriber</span><span class="sy1">&lt;</span>brazo_fer<span class="sy4">::</span><span class="me2">WriteServos</span><span class="sy1">&gt;</span> hand_sub<span class="br0">(</span><span class="st0">"hand_arm"</span>, <span class="sy3">&amp;</span>pinza <span class="br0">)</span><span class="sy4">;</span>
&nbsp;
brazo_fer<span class="sy4">::</span><span class="me2">ReadServos</span> pec<span class="sy4">;</span>
std_msgs<span class="sy4">::</span><span class="me2">Bool</span> pulsador<span class="sy4">;</span>
&nbsp;
ros<span class="sy4">::</span><span class="me2">Publisher</span> pose_pub<span class="br0">(</span><span class="st0">"pose_arm"</span>, <span class="sy3">&amp;</span>pec<span class="br0">)</span><span class="sy4">;</span>
&nbsp;
&nbsp;
<span class="kw4">void</span> setup<span class="br0">(</span><span class="br0">)</span>
<span class="br0">{</span>
  nh.<span class="me1">initNode</span><span class="br0">(</span><span class="br0">)</span><span class="sy4">;</span>
  nh.<span class="me1">subscribe</span><span class="br0">(</span>move_sub<span class="br0">)</span><span class="sy4">;</span>
  nh.<span class="me1">subscribe</span><span class="br0">(</span>hand_sub<span class="br0">)</span><span class="sy4">;</span>  
  nh.<span class="me1">advertise</span><span class="br0">(</span>pose_pub<span class="br0">)</span><span class="sy4">;</span>
&nbsp;
  Dynamixel.<span class="me1">begin</span><span class="br0">(</span>1000000,2<span class="br0">)</span><span class="sy4">;</span>
&nbsp;
<span class="br0">}</span>
&nbsp;
<span class="kw4">void</span> loop<span class="br0">(</span><span class="br0">)</span>
<span class="br0">{</span>
  brazo_fer<span class="sy4">::</span><span class="me2">Servos</span> pos<span class="sy4">;</span>
  brazo_fer<span class="sy4">::</span><span class="me2">Servos</span> est<span class="sy4">;</span>
  brazo_fer<span class="sy4">::</span><span class="me2">Servos</span> cor<span class="sy4">;</span> 
&nbsp;
  pos.<span class="me1">base</span> <span class="sy1">=</span> Dynamixel.<span class="me1">readPosition</span><span class="br0">(</span>1<span class="br0">)</span><span class="sy4">;</span>
  pos.<span class="me1">arti1</span> <span class="sy1">=</span> Dynamixel.<span class="me1">readPosition</span><span class="br0">(</span>2<span class="br0">)</span><span class="sy4">;</span>
  pos.<span class="me1">arti2</span> <span class="sy1">=</span> Dynamixel.<span class="me1">readPosition</span><span class="br0">(</span>3<span class="br0">)</span><span class="sy4">;</span>
  pos.<span class="me1">arti3</span> <span class="sy1">=</span> Dynamixel.<span class="me1">readPosition</span><span class="br0">(</span>4<span class="br0">)</span><span class="sy4">;</span>
  pos.<span class="me1">pinza</span> <span class="sy1">=</span> Dynamixel.<span class="me1">readPosition</span><span class="br0">(</span>5<span class="br0">)</span><span class="sy4">;</span>
&nbsp;
  est.<span class="me1">base</span> <span class="sy1">=</span> Dynamixel.<span class="me1">moving</span><span class="br0">(</span>1<span class="br0">)</span><span class="sy4">;</span>
  est.<span class="me1">arti1</span> <span class="sy1">=</span> Dynamixel.<span class="me1">moving</span><span class="br0">(</span>2<span class="br0">)</span><span class="sy4">;</span>
  est.<span class="me1">arti2</span> <span class="sy1">=</span> Dynamixel.<span class="me1">moving</span><span class="br0">(</span>3<span class="br0">)</span><span class="sy4">;</span>
  est.<span class="me1">arti3</span> <span class="sy1">=</span> Dynamixel.<span class="me1">moving</span><span class="br0">(</span>4<span class="br0">)</span><span class="sy4">;</span>
  est.<span class="me1">pinza</span> <span class="sy1">=</span> Dynamixel.<span class="me1">moving</span><span class="br0">(</span>5<span class="br0">)</span><span class="sy4">;</span>      
&nbsp;
  cor.<span class="me1">base</span> <span class="sy1">=</span> Dynamixel.<span class="me1">readLoad</span><span class="br0">(</span>1<span class="br0">)</span><span class="sy4">;</span>
  cor.<span class="me1">arti1</span> <span class="sy1">=</span> Dynamixel.<span class="me1">readLoad</span><span class="br0">(</span>2<span class="br0">)</span><span class="sy4">;</span>
  cor.<span class="me1">arti2</span> <span class="sy1">=</span> Dynamixel.<span class="me1">readLoad</span><span class="br0">(</span>3<span class="br0">)</span><span class="sy4">;</span>
  cor.<span class="me1">arti3</span> <span class="sy1">=</span> Dynamixel.<span class="me1">readLoad</span><span class="br0">(</span>4<span class="br0">)</span><span class="sy4">;</span>
  cor.<span class="me1">pinza</span> <span class="sy1">=</span> Dynamixel.<span class="me1">readLoad</span><span class="br0">(</span>5<span class="br0">)</span><span class="sy4">;</span>    
&nbsp;
  pec.<span class="me1">posicion</span> <span class="sy1">=</span> pos<span class="sy4">;</span>
  pec.<span class="me1">estado</span> <span class="sy1">=</span> est<span class="sy4">;</span>
  pec.<span class="me1">corriente</span> <span class="sy1">=</span> cor<span class="sy4">;</span>  
&nbsp;
  pose_pub.<span class="me1">publish</span><span class="br0">(</span> <span class="sy3">&amp;</span>pec <span class="br0">)</span><span class="sy4">;</span>
&nbsp;
  nh.<span class="me1">spinOnce</span><span class="br0">(</span><span class="br0">)</span><span class="sy4">;</span>
&nbsp;
<span class="br0">}</span></pre></div></div>
<p>We will use <a rel="nofollow" class="external text" href="http://www.arduino.cc/">arduino</a>
 IDE software to compile and send the program to the board. We will use 
this program for the next control programs since it is a interface 
between the servo motors and <a rel="nofollow" class="external text" href="http://www.ros.org/">ROS</a> system.
</p>
<h3><span class="mw-headline" id="ROS_program">ROS program</span></h3>
<p>This program uses the equations of the inverse kinematics to set the 
position angle of the servo motors in order to reach the goal point that
 is within the workspace. The program subscribe the <i>topic</i> "point" which receives the goal point, also it subscribes the <i>topic</i> "pose_arm" which receives the information of servo motors, and publish the <i>topic' "move_arm" which indicates to the <a rel="nofollow" class="external text" href="http://www.arduino.cc/">arduino</a>
 program the position, velocity and torque of for the servo motors. We 
will create a file named "control_v01.cpp" with the content that is 
shown below within the folder "src" of our </i>package<i>:</i>
</p>
<div dir="ltr" class="mw-geshi mw-content-ltr"><div class="cpp source-cpp" style="font-family:monospace;">&nbsp; <span class="co2">#include "ros/ros.h"</span><br>&nbsp; <span class="co2">#include "brazo_fer/Servos.h"</span><br>&nbsp; <span class="co2">#include "brazo_fer/WriteServos.h" &nbsp;</span><br>&nbsp; <span class="co2">#include "brazo_fer/ReadServos.h"</span><br>&nbsp; <span class="co2">#include "geometry_msgs/Point.h"</span><br>&nbsp; <span class="co2">#include "math.h"</span><br>&nbsp;<br>&nbsp; <span class="co2">#define PI 3.14159265</span><br>&nbsp; <span class="co2">#define L1 104</span><br>&nbsp; <span class="co2">#define L2 104</span><br>&nbsp; <span class="co2">#define Lp 60</span><br>&nbsp;<br>&nbsp;<br>&nbsp; brazo_fer<span class="sy4">::</span><span class="me2">Servos</span> move, vel, p, e, c<span class="sy4">;</span><br>&nbsp;<br>&nbsp; <span class="kw4">void</span> posicion<span class="br0">(</span><span class="kw4">const</span> brazo_fer<span class="sy4">::</span><span class="me2">ReadServos</span><span class="sy3">&amp;</span> pose<span class="br0">)</span><br>&nbsp; <span class="br0">{</span><br>&nbsp;<br>&nbsp; &nbsp; <span class="sy4">::</span><span class="me2">p</span> <span class="sy1">=</span> pose.<span class="me1">posicion</span><span class="sy4">;</span><br>&nbsp; &nbsp; <span class="sy4">::</span><span class="me2">e</span> <span class="sy1">=</span> pose.<span class="me1">estado</span><span class="sy4">;</span><br>&nbsp; &nbsp; <span class="sy4">::</span><span class="me2">c</span> <span class="sy1">=</span> pose.<span class="me1">corriente</span><span class="sy4">;</span><br>&nbsp;<br>&nbsp; <span class="br0">}</span><br>&nbsp;<br>&nbsp; <span class="kw4">void</span> punto<span class="br0">(</span><span class="kw4">const</span> geometry_msgs<span class="sy4">::</span><span class="me2">Point</span><span class="sy3">&amp;</span> point<span class="br0">)</span><br>&nbsp; <span class="br0">{</span> &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; ros<span class="sy4">::</span><span class="me2">NodeHandle</span> n<span class="sy4">;</span><br>&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; ros<span class="sy4">::</span><span class="me2">Publisher</span> move_pub_<span class="sy1">=</span>n.<span class="me1">advertise</span><span class="sy1">&lt;</span>brazo_fer<span class="sy4">::</span><span class="me2">WriteServos</span><span class="sy1">&gt;</span><span class="br0">(</span><span class="st0">"move_arm"</span>, 1<span class="br0">)</span><span class="sy4">;</span> &nbsp; <br>&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw4">double</span> x <span class="sy1">=</span> point.<span class="me1">x</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw4">double</span> y <span class="sy1">=</span> point.<span class="me1">y</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw4">double</span> z <span class="sy1">=</span> point.<span class="me1">z</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; y <span class="sy1">=</span> y <span class="sy2">+</span> z<span class="sy2">*</span><span class="kw3">tan</span><span class="br0">(</span><span class="kw3">atan2</span><span class="br0">(</span>45,250<span class="br0">)</span><span class="br0">)</span><span class="sy4">;</span><br>&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw4">int</span> coordenadas_correctas <span class="sy1">=</span> <span class="nu0">1</span><span class="sy4">;</span><br>&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw4">double</span> alfa, beta, beta_a, beta_p, beta_pp, gamma, delta, delta_a, delta_p, epsilon<span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw4">double</span> z_p<span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw4">double</span> L_a, L<span class="sy4">;</span><br>&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; epsilon <span class="sy1">=</span> <span class="nu0">0</span><span class="sy4">;</span> <br>&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; alfa <span class="sy1">=</span> <span class="br0">(</span><span class="kw3">atan2</span><span class="br0">(</span>x,z<span class="br0">)</span><span class="sy2">*</span>180<span class="br0">)</span><span class="sy2">/</span>PI<span class="sy4">;</span><br>&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; z_p <span class="sy1">=</span> <span class="kw3">sqrt</span><span class="br0">(</span><span class="kw3">pow</span><span class="br0">(</span>z,2<span class="br0">)</span><span class="sy2">+</span><span class="kw3">pow</span><span class="br0">(</span>x,2<span class="br0">)</span><span class="br0">)</span><span class="sy4">;</span><br>&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; L <span class="sy1">=</span> <span class="kw3">sqrt</span><span class="br0">(</span><span class="kw3">pow</span><span class="br0">(</span>z_p,2<span class="br0">)</span><span class="sy2">+</span><span class="kw3">pow</span><span class="br0">(</span>y,2<span class="br0">)</span><span class="br0">)</span><span class="sy4">;</span><br>&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; L_a <span class="sy1">=</span> <span class="kw3">sqrt</span><span class="br0">(</span><span class="kw3">pow</span><span class="br0">(</span>y<span class="sy2">+</span><span class="br0">(</span>Lp<span class="sy2">*</span><span class="kw3">sin</span><span class="br0">(</span>epsilon<span class="br0">)</span><span class="br0">)</span>,2<span class="br0">)</span><span class="sy2">+</span><span class="kw3">pow</span><span class="br0">(</span>z_p<span class="sy2">-</span><span class="br0">(</span>Lp<span class="sy2">*</span><span class="kw3">cos</span><span class="br0">(</span>epsilon<span class="br0">)</span><span class="br0">)</span>,2<span class="br0">)</span><span class="br0">)</span><span class="sy4">;</span><br>&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; beta_p <span class="sy1">=</span> <span class="kw3">atan2</span><span class="br0">(</span>y<span class="sy2">+</span><span class="br0">(</span>Lp<span class="sy2">*</span><span class="kw3">sin</span><span class="br0">(</span>epsilon<span class="br0">)</span><span class="br0">)</span>,z_p<span class="sy2">-</span><span class="br0">(</span>Lp<span class="sy2">*</span><span class="kw3">cos</span><span class="br0">(</span>epsilon<span class="br0">)</span><span class="br0">)</span><span class="br0">)</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; beta_pp <span class="sy1">=</span> <span class="kw3">atan2</span><span class="br0">(</span>y,z_p<span class="br0">)</span><span class="sy4">;</span><br>&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; beta_a <span class="sy1">=</span> <span class="kw3">acos</span><span class="br0">(</span><span class="br0">(</span><span class="kw3">pow</span><span class="br0">(</span>L1,2<span class="br0">)</span><span class="sy2">+</span><span class="kw3">pow</span><span class="br0">(</span>L_a,2<span class="br0">)</span><span class="sy2">-</span><span class="kw3">pow</span><span class="br0">(</span>L2,2<span class="br0">)</span><span class="br0">)</span><span class="sy2">/</span><span class="br0">(</span>2<span class="sy2">*</span>L1<span class="sy2">*</span>L_a<span class="br0">)</span><span class="br0">)</span><span class="sy4">;</span><br>&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; beta <span class="sy1">=</span> <span class="br0">(</span><span class="br0">(</span>beta_p<span class="sy2">+</span>beta_a<span class="br0">)</span><span class="sy2">*</span>180<span class="br0">)</span><span class="sy2">/</span>PI<span class="sy4">;</span><br>&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; gamma <span class="sy1">=</span> <span class="kw3">acos</span><span class="br0">(</span><span class="br0">(</span><span class="kw3">pow</span><span class="br0">(</span>L1,2<span class="br0">)</span><span class="sy2">+</span><span class="kw3">pow</span><span class="br0">(</span>L2,2<span class="br0">)</span><span class="sy2">-</span><span class="kw3">pow</span><span class="br0">(</span>L_a,2<span class="br0">)</span><span class="br0">)</span><span class="sy2">/</span><span class="br0">(</span>2<span class="sy2">*</span>L1<span class="sy2">*</span>L2<span class="br0">)</span><span class="br0">)</span><span class="sy4">;</span><br>&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; delta_a <span class="sy1">=</span> PI<span class="sy2">-</span><span class="br0">(</span>beta_a<span class="sy2">+</span>gamma<span class="br0">)</span><span class="sy4">;</span><br>&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; gamma <span class="sy1">=</span> <span class="br0">(</span>gamma<span class="sy2">*</span>180<span class="br0">)</span><span class="sy2">/</span>PI<span class="sy4">;</span><br>&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; delta_p <span class="sy1">=</span> <span class="kw3">acos</span><span class="br0">(</span><span class="br0">(</span><span class="kw3">pow</span><span class="br0">(</span>L_a,2<span class="br0">)</span><span class="sy2">+</span><span class="kw3">pow</span><span class="br0">(</span>Lp,2<span class="br0">)</span><span class="sy2">-</span><span class="kw3">pow</span><span class="br0">(</span>L,2<span class="br0">)</span><span class="br0">)</span><span class="sy2">/</span><span class="br0">(</span>2<span class="sy2">*</span>L_a<span class="sy2">*</span>Lp<span class="br0">)</span><span class="br0">)</span><span class="sy4">;</span> &nbsp; &nbsp; &nbsp; <br>&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">(</span>beta_pp <span class="sy1">&gt;</span> beta_p<span class="br0">)</span> <span class="br0">{</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; delta <span class="sy1">=</span> <span class="br0">(</span><span class="br0">(</span>2<span class="sy2">*</span>PI<span class="sy2">-</span><span class="br0">(</span>delta_p<span class="sy2">-</span>delta_a<span class="br0">)</span><span class="br0">)</span><span class="sy2">*</span>180<span class="br0">)</span><span class="sy2">/</span>PI<span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">}</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">else</span> <span class="br0">{</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; delta <span class="sy1">=</span> <span class="br0">(</span><span class="br0">(</span>delta_p<span class="sy2">+</span>delta_a<span class="br0">)</span><span class="sy2">*</span>180<span class="br0">)</span><span class="sy2">/</span>PI<span class="sy4">;</span><br>&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">(</span>isnan<span class="br0">(</span>delta<span class="br0">)</span><span class="br0">)</span> <span class="br0">{</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; delta <span class="sy1">=</span> <span class="br0">(</span><span class="br0">(</span>PI<span class="sy2">+</span>delta_a<span class="br0">)</span><span class="sy2">*</span>180<span class="br0">)</span><span class="sy2">/</span>PI<span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">}</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">}</span><br>&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">(</span>isnan<span class="br0">(</span>gamma<span class="br0">)</span><span class="br0">)</span> <span class="co1">// si no hay solución</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">{</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; coordenadas_correctas <span class="sy1">=</span> <span class="nu0">0</span><span class="sy4">;</span> <br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">}</span><br>&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="sy4">::</span><span class="me2">move</span>.<span class="me1">base</span> <span class="sy1">=</span> <span class="br0">(</span><span class="br0">(</span>alfa<span class="sy2">+</span>150<span class="br0">)</span><span class="sy2">*</span>1023<span class="br0">)</span><span class="sy2">/</span><span class="nu0">300</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="sy4">::</span><span class="me2">move</span>.<span class="me1">arti1</span> <span class="sy1">=</span> <span class="br0">(</span><span class="br0">(</span>beta<span class="sy2">+</span>60<span class="br0">)</span><span class="sy2">*</span>1023<span class="br0">)</span><span class="sy2">/</span><span class="nu0">300</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="sy4">::</span><span class="me2">move</span>.<span class="me1">arti2</span> <span class="sy1">=</span> <span class="br0">(</span><span class="br0">(</span>gamma<span class="sy2">-</span>30<span class="br0">)</span><span class="sy2">*</span>1023<span class="br0">)</span><span class="sy2">/</span><span class="nu0">300</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="sy4">::</span><span class="me2">move</span>.<span class="me1">arti3</span> <span class="sy1">=</span> <span class="br0">(</span><span class="br0">(</span>delta<span class="sy2">-</span>30<span class="br0">)</span><span class="sy2">*</span>1023<span class="br0">)</span><span class="sy2">/</span><span class="nu0">300</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="sy4">::</span><span class="me2">move</span>.<span class="me1">pinza</span> <span class="sy1">=</span> <span class="nu0">511</span><span class="sy4">;</span><br><br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="sy4">::</span><span class="me2">vel</span>.<span class="me1">base</span> <span class="sy1">=</span> <span class="kw3">abs</span><span class="br0">(</span><span class="sy4">::</span><span class="me2">move</span>.<span class="me1">base</span> <span class="sy2">-</span> <span class="sy4">::</span><span class="me2">p</span>.<span class="me1">base</span><span class="br0">)</span><span class="sy2">/</span><span class="nu0">5</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="sy4">::</span><span class="me2">vel</span>.<span class="me1">arti1</span> <span class="sy1">=</span> <span class="kw3">abs</span><span class="br0">(</span><span class="sy4">::</span><span class="me2">move</span>.<span class="me1">arti1</span> <span class="sy2">-</span> <span class="sy4">::</span><span class="me2">p</span>.<span class="me1">arti1</span><span class="br0">)</span><span class="sy2">/</span><span class="nu0">5</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="sy4">::</span><span class="me2">vel</span>.<span class="me1">arti2</span> <span class="sy1">=</span> <span class="kw3">abs</span><span class="br0">(</span><span class="sy4">::</span><span class="me2">move</span>.<span class="me1">arti2</span> <span class="sy2">-</span> <span class="sy4">::</span><span class="me2">p</span>.<span class="me1">arti2</span><span class="br0">)</span><span class="sy2">/</span><span class="nu0">5</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="sy4">::</span><span class="me2">vel</span>.<span class="me1">arti3</span> <span class="sy1">=</span> <span class="kw3">abs</span><span class="br0">(</span><span class="sy4">::</span><span class="me2">move</span>.<span class="me1">arti3</span> <span class="sy2">-</span> <span class="sy4">::</span><span class="me2">p</span>.<span class="me1">arti3</span><span class="br0">)</span><span class="sy2">/</span><span class="nu0">5</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="sy4">::</span><span class="me2">vel</span>.<span class="me1">pinza</span> <span class="sy1">=</span> <span class="kw3">abs</span><span class="br0">(</span><span class="sy4">::</span><span class="me2">move</span>.<span class="me1">pinza</span> <span class="sy2">-</span> <span class="sy4">::</span><span class="me2">p</span>.<span class="me1">pinza</span><span class="br0">)</span><span class="sy4">;</span><br>&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">(</span>coordenadas_correctas <span class="sy1">==</span> 1 <span class="sy3">&amp;&amp;</span> <span class="br0">(</span>205 <span class="sy1">&lt;=</span> <span class="sy4">::</span><span class="me2">move</span>.<span class="me1">base</span> <span class="sy3">&amp;&amp;</span> <span class="sy4">::</span><span class="me2">move</span>.<span class="me1">base</span> <span class="sy1">&lt;=</span> 818<span class="br0">)</span> <span class="sy3">&amp;&amp;</span> <span class="br0">(</span>120 <span class="sy1">&lt;=</span> <span class="sy4">::</span><span class="me2">move</span>.<span class="me1">arti1</span> <span class="sy3">&amp;&amp;</span> <span class="sy4">::</span><span class="me2">move</span>.<span class="me1">arti1</span> <span class="sy1">&lt;=</span> 920<span class="br0">)</span> <span class="sy3">&amp;&amp;</span> <span class="sy4">::</span><span class="me2">move</span>.<span class="me1">arti2</span> <span class="sy1">&gt;=</span> 50 &nbsp;<span class="sy3">&amp;&amp;</span> <span class="sy4">::</span><span class="me2">move</span>.<span class="me1">arti3</span> <span class="sy1">&lt;=</span> 828<span class="br0">)</span> <span class="br0">{</span><br>&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; brazo_fer<span class="sy4">::</span><span class="me2">WriteServos</span> mover<span class="sy4">;</span><br>&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mover.<span class="me1">posicion</span> <span class="sy1">=</span> <span class="sy4">::</span><span class="me2">move</span><span class="sy4">;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mover.<span class="me1">velocidad</span> <span class="sy1">=</span> <span class="sy4">::</span><span class="me2">vel</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mover.<span class="me1">par</span>.<span class="me1">base</span> <span class="sy1">=</span> <span class="nu0">1</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mover.<span class="me1">par</span>.<span class="me1">arti1</span> <span class="sy1">=</span> <span class="nu0">1</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mover.<span class="me1">par</span>.<span class="me1">arti2</span> <span class="sy1">=</span> <span class="nu0">1</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mover.<span class="me1">par</span>.<span class="me1">arti3</span> <span class="sy1">=</span> <span class="nu0">1</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mover.<span class="me1">par</span>.<span class="me1">pinza</span> <span class="sy1">=</span> <span class="nu0">1</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; move_pub_.<span class="me1">publish</span><span class="br0">(</span>mover<span class="br0">)</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">}</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">else</span> <span class="br0">{</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; std<span class="sy4">::</span><span class="kw3">cout</span><span class="sy1">&lt;&lt;</span><span class="st0">"Error, invalid coordinates or unattainable point"</span><span class="sy1">&lt;&lt;</span>std<span class="sy4">::</span><span class="me2">endl</span><span class="sy4">;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">}</span><br>&nbsp;<br>&nbsp; <span class="br0">}</span> <br>&nbsp;<br>&nbsp;<br>&nbsp; <span class="kw4">int</span> main<span class="br0">(</span><span class="kw4">int</span> argc, <span class="kw4">char</span> <span class="sy2">**</span>argv<span class="br0">)</span><br>&nbsp; <span class="br0">{</span><br>&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; ros<span class="sy4">::</span><span class="me2">init</span><span class="br0">(</span>argc, argv, <span class="st0">"control_brazo"</span><span class="br0">)</span><span class="sy4">;</span> &nbsp; <br>&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; ros<span class="sy4">::</span><span class="me2">NodeHandle</span> n<span class="sy4">;</span><br>&nbsp;<br>&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; ros<span class="sy4">::</span><span class="me2">Subscriber</span> pose_sub_<span class="sy1">=</span> n.<span class="me1">subscribe</span><span class="br0">(</span><span class="st0">"pose_arm"</span>, 1, posicion<span class="br0">)</span><span class="sy4">;</span> <br>&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; ros<span class="sy4">::</span><span class="me2">Subscriber</span> point_sub_<span class="sy1">=</span> n.<span class="me1">subscribe</span><span class="br0">(</span><span class="st0">"point"</span>, 1, punto<span class="br0">)</span><span class="sy4">;</span> <br>&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; ros<span class="sy4">::</span><span class="me2">Publisher</span> move_pub_<span class="sy1">=</span>n.<span class="me1">advertise</span><span class="sy1">&lt;</span>brazo_fer<span class="sy4">::</span><span class="me2">WriteServos</span><span class="sy1">&gt;</span><span class="br0">(</span><span class="st0">"move_arm"</span>, 1<span class="br0">)</span><span class="sy4">;</span> &nbsp; <br>&nbsp;<br>&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; ros<span class="sy4">::</span><span class="me2">spin</span><span class="br0">(</span><span class="br0">)</span><span class="sy4">;</span> &nbsp;<br>&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">return</span> <span class="nu0">0</span><span class="sy4">;</span><br>&nbsp; <span class="br0">}</span></div></div>
<p>We have to add the next line to the file "CMakeLists.txt" of our <i>package</i> in order to compile and create the executable file:
</p>
<div dir="ltr" class="mw-geshi mw-content-ltr"><div class="cmake source-cmake" style="font-family:monospace;"><pre class="de1">rosbuild_add_executable<span class="sy0">(</span>contro_v01 src/control_v01.cpp<span class="sy0">)</span></pre></div></div>
<p>We will execute the next commands in a terminal in order to compile and create the executable file:
</p>
<div dir="ltr" class="mw-geshi mw-content-ltr"><div class="bash source-bash" style="font-family:monospace;"><pre class="de1">roscd brazo_fer
<span class="kw2">make</span></pre></div></div>
<h3><span class="mw-headline" id="Running_the_program">Running the program</span></h3>
<p>First we will execute the next command in a terminal in order to launch the <a rel="nofollow" class="external text" href="http://www.ros.org/">ROS</a> core, if it has not launched previously.
</p>
<div dir="ltr" class="mw-geshi mw-content-ltr"><div class="bash source-bash" style="font-family:monospace;"><pre class="de1">roscore</pre></div></div>
<p>We will execute the next command in other terminal in order to launch the communication node <a rel="nofollow" class="external text" href="http://www.ros.org/">ROS</a>-<a rel="nofollow" class="external text" href="http://www.arduino.cc/">arduino</a>:
</p>
<div dir="ltr" class="mw-geshi mw-content-ltr"><div class="bash source-bash" style="font-family:monospace;"><pre class="de1">rosrun rosserial_python serial_node.py <span class="sy0">/</span>dev<span class="sy0">/</span>ttyACM0</pre></div></div>
<p>We will execute the next command in a terminal in order to launch the control program:
</p>
<div dir="ltr" class="mw-geshi mw-content-ltr"><div class="bash source-bash" style="font-family:monospace;"><pre class="de1">rosrun brazo_fer control_v01</pre></div></div>
<p>We will execute the next command in a terminal in order to publish in the <i>topic</i> "point" the goal point:
</p>
<div dir="ltr" class="mw-geshi mw-content-ltr"><div class="bash source-bash" style="font-family:monospace;"><pre class="de1">rostopic pub point geometry_msgs<span class="sy0">/</span>Point <span class="st_h">'{x: 50, y: 100, z: 150}'</span> <span class="re5">--once</span></pre></div></div>
<p>The arm will move to the goal point. We can see the arm moving from the start point to the goal point in the next video:
</p>
<center><object height="350" width="425"> <param name="movie" value="http://www.youtube.com/v/iwAcutO3C8g?fs=1"> <param name="allowFullScreen" value="true"> <param name="wmode" value="transparent"> <embed src="MYRAbot%27s%20arm%20control%20%28bioloid+arduino%29%20-%20Rob%C3%B3tica%20-%20ULE_files/iwAcutO3C8g.swf" type="application/x-shockwave-flash" wmode="transparent" allowfullscreen="true" flashvars="" height="350" width="425"></object></center>
<center><a rel="nofollow" class="external text" href="http://www.youtube.com/watch?v=iwAcutO3C8g">Watch in YouTube</a></center>
<h2><span class="mw-headline" id="Fourth_program_.28Grasp_the_bottle.29">Fourth program (Grasp the bottle)</span></h2>
<h3><span class="mw-headline" id="Include_file_with_functions">Include file with functions</span></h3>
<p>We have created a file with the control fuctions for the arm in 
orther to simplify and make more legible the programs. We will create a 
file named "brazo_fer.h" within the folder "include/brazo_fer" of the 
created <i>package</i> with the content that is shown below:
</p>
<div dir="ltr" class="mw-geshi mw-content-ltr"><div class="cpp source-cpp" style="font-family:monospace;"><span class="co2">#ifndef brazo_fer_H</span><br><span class="co2">#define brazo_fer_H</span><br><br>&nbsp; <span class="co2">#include "ros/ros.h"</span><br>&nbsp; <span class="co2">#include "brazo_fer/Servos.h"</span><br>&nbsp; <span class="co2">#include "brazo_fer/WriteServos.h" &nbsp;</span><br>&nbsp; <span class="co2">#include "brazo_fer/ReadServos.h" &nbsp;</span><br>&nbsp; <span class="co2">#include "std_msgs/Int16.h"</span><br>&nbsp; <span class="co2">#include "geometry_msgs/Point.h"</span><br>&nbsp; <span class="co2">#include "math.h" </span><br>&nbsp; <br>&nbsp; <span class="co2">#define PI 3.14159265</span><br>&nbsp; <span class="co2">#define L1 104</span><br>&nbsp; <span class="co2">#define L2 104</span><br>&nbsp; <span class="co2">#define Lp 60 &nbsp;</span><br><br>geometry_msgs<span class="sy4">::</span><span class="me2">Point</span> directa<span class="br0">(</span>brazo_fer<span class="sy4">::</span><span class="me2">Servos</span> posicion_servos_0, <span class="kw4">int</span> inclinacion_pinza<span class="br0">)</span><br>&nbsp; <span class="br0">{</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw4">double</span> alfa, beta, beta_a, beta_p, beta_pp, gamma, delta, delta_a, delta_p1, delta_p2, epsilon<span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw4">double</span> z_p<span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw4">double</span> L_a, L<span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw4">double</span> a, b<span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw4">double</span> x, y, z<span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; alfa <span class="sy1">=</span> <span class="br0">(</span><span class="br0">(</span><span class="br0">(</span>posicion_servos_0.<span class="me1">base</span><span class="sy2">*</span>300<span class="br0">)</span><span class="sy2">/</span>1023<span class="br0">)</span><span class="sy2">-</span>150<span class="br0">)</span><span class="sy2">*</span>PI<span class="sy2">/</span><span class="nu0">180</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; beta <span class="sy1">=</span> <span class="br0">(</span><span class="br0">(</span><span class="br0">(</span>posicion_servos_0.<span class="me1">arti1</span><span class="sy2">*</span>300<span class="br0">)</span><span class="sy2">/</span>1023<span class="br0">)</span><span class="sy2">-</span>60<span class="br0">)</span><span class="sy2">*</span>PI<span class="sy2">/</span><span class="nu0">180</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; gamma <span class="sy1">=</span> <span class="br0">(</span><span class="br0">(</span><span class="br0">(</span>posicion_servos_0.<span class="me1">arti2</span><span class="sy2">*</span>300<span class="br0">)</span><span class="sy2">/</span>1023<span class="br0">)</span><span class="sy2">+</span>30<span class="br0">)</span><span class="sy2">*</span>PI<span class="sy2">/</span><span class="nu0">180</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; delta <span class="sy1">=</span> <span class="br0">(</span><span class="br0">(</span><span class="br0">(</span>posicion_servos_0.<span class="me1">arti3</span><span class="sy2">*</span>300<span class="br0">)</span><span class="sy2">/</span>1023<span class="br0">)</span><span class="sy2">+</span>30<span class="br0">)</span><span class="sy2">*</span>PI<span class="sy2">/</span><span class="nu0">180</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; epsilon <span class="sy1">=</span> <span class="br0">(</span>inclinacion_pinza<span class="sy2">*</span>PI<span class="br0">)</span><span class="sy2">/</span><span class="nu0">180</span><span class="sy4">;</span> &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; L_a <span class="sy1">=</span> <span class="kw3">sqrt</span><span class="br0">(</span><span class="kw3">pow</span><span class="br0">(</span>L1,2<span class="br0">)</span><span class="sy2">+</span><span class="kw3">pow</span><span class="br0">(</span>L2,2<span class="br0">)</span><span class="sy2">-</span>2<span class="sy2">*</span>L1<span class="sy2">*</span>L2<span class="sy2">*</span><span class="kw3">cos</span><span class="br0">(</span>gamma<span class="br0">)</span><span class="br0">)</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; beta_a <span class="sy1">=</span> <span class="kw3">acos</span><span class="br0">(</span><span class="br0">(</span><span class="kw3">pow</span><span class="br0">(</span>L1,2<span class="br0">)</span><span class="sy2">+</span><span class="kw3">pow</span><span class="br0">(</span>L_a,2<span class="br0">)</span><span class="sy2">-</span><span class="kw3">pow</span><span class="br0">(</span>L2,2<span class="br0">)</span><span class="br0">)</span><span class="sy2">/</span><span class="br0">(</span>2<span class="sy2">*</span>L1<span class="sy2">*</span>L_a<span class="br0">)</span><span class="br0">)</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; beta_p <span class="sy1">=</span> beta <span class="sy2">-</span> beta_a<span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; delta_a <span class="sy1">=</span> PI <span class="sy2">-</span> <span class="br0">(</span>beta_a <span class="sy2">+</span> gamma<span class="br0">)</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; delta_p1 <span class="sy1">=</span> delta <span class="sy2">-</span> delta_a<span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; delta_p2 <span class="sy1">=</span> 2<span class="sy2">*</span>PI <span class="sy2">-</span> <span class="br0">(</span>delta <span class="sy2">-</span> delta_a<span class="br0">)</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">(</span>delta_p1 <span class="sy1">&lt;</span> delta_p2<span class="br0">)</span> <br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">{</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; L <span class="sy1">=</span> <span class="kw3">sqrt</span><span class="br0">(</span><span class="kw3">pow</span><span class="br0">(</span>L_a,2<span class="br0">)</span><span class="sy2">+</span><span class="kw3">pow</span><span class="br0">(</span>Lp,2<span class="br0">)</span><span class="sy2">-</span>2<span class="sy2">*</span>L_a<span class="sy2">*</span>Lp<span class="sy2">*</span><span class="kw3">cos</span><span class="br0">(</span>delta_p1<span class="br0">)</span><span class="br0">)</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">}</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">else</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">{</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; L <span class="sy1">=</span> <span class="kw3">sqrt</span><span class="br0">(</span><span class="kw3">pow</span><span class="br0">(</span>L_a,2<span class="br0">)</span><span class="sy2">+</span><span class="kw3">pow</span><span class="br0">(</span>Lp,2<span class="br0">)</span><span class="sy2">-</span>2<span class="sy2">*</span>L_a<span class="sy2">*</span>Lp<span class="sy2">*</span><span class="kw3">cos</span><span class="br0">(</span>delta_p2<span class="br0">)</span><span class="br0">)</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">}</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; z_p <span class="sy1">=</span> L_a<span class="sy2">*</span><span class="kw3">cos</span><span class="br0">(</span>beta_p<span class="br0">)</span> <span class="sy2">+</span> Lp<span class="sy2">*</span><span class="kw3">cos</span><span class="br0">(</span>epsilon<span class="br0">)</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; beta_pp <span class="sy1">=</span> <span class="kw3">acos</span><span class="br0">(</span>z_p<span class="sy2">/</span>L<span class="br0">)</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; a <span class="sy1">=</span> L1<span class="sy2">*</span><span class="kw3">sin</span><span class="br0">(</span>beta<span class="br0">)</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; b <span class="sy1">=</span> L2<span class="sy2">*</span><span class="kw3">sin</span><span class="br0">(</span>beta<span class="sy2">+</span>gamma<span class="br0">)</span><span class="sy2">+</span>Lp<span class="sy2">*</span><span class="kw3">sin</span><span class="br0">(</span>epsilon<span class="br0">)</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">(</span>a <span class="sy1">&gt;=</span> b<span class="br0">)</span> <br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">{</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; y <span class="sy1">=</span> L<span class="sy2">*</span><span class="kw3">sin</span><span class="br0">(</span>beta_pp<span class="br0">)</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">}</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">else</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">{</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; y <span class="sy1">=</span> <span class="sy2">-</span>L<span class="sy2">*</span><span class="kw3">sin</span><span class="br0">(</span>beta_pp<span class="br0">)</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">}</span> &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; z <span class="sy1">=</span> z_p<span class="sy2">*</span><span class="kw3">cos</span><span class="br0">(</span>alfa<span class="br0">)</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; x <span class="sy1">=</span> z_p<span class="sy2">*</span><span class="kw3">sin</span><span class="br0">(</span>alfa<span class="br0">)</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; geometry_msgs<span class="sy4">::</span><span class="me2">Point</span> punto<span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; punto.<span class="me1">x</span> <span class="sy1">=</span> x<span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; punto.<span class="me1">y</span> <span class="sy1">=</span> y<span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; punto.<span class="me1">z</span> <span class="sy1">=</span> z<span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">return</span> punto<span class="sy4">;</span> <br>&nbsp; <span class="br0">}</span> <br>&nbsp; <br>brazo_fer<span class="sy4">::</span><span class="me2">WriteServos</span> inversa<span class="br0">(</span>geometry_msgs<span class="sy4">::</span><span class="me2">Point</span> destino, <span class="kw4">int</span> inclinacion_pinza, brazo_fer<span class="sy4">::</span><span class="me2">Servos</span> posicion_servos_0, <span class="kw4">int</span> velocidad<span class="br0">)</span> <br>&nbsp; <span class="br0">{</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw4">double</span> x <span class="sy1">=</span> destino.<span class="me1">x</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw4">double</span> y <span class="sy1">=</span> destino.<span class="me1">y</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw4">double</span> z <span class="sy1">=</span> destino.<span class="me1">z</span><span class="sy4">;</span><br><br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw4">int</span> coordenadas_correctas <span class="sy1">=</span> <span class="nu0">1</span><span class="sy4">;</span><br><br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw4">double</span> alfa, beta, beta_a, beta_p, beta_pp, gamma, delta, delta_a, delta_p, epsilon<span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw4">double</span> z_p<span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw4">double</span> L_a, L<span class="sy4">;</span><br>&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; epsilon <span class="sy1">=</span> <span class="br0">(</span>inclinacion_pinza<span class="sy2">*</span>PI<span class="br0">)</span><span class="sy2">/</span><span class="nu0">180</span><span class="sy4">;</span><br>&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; alfa <span class="sy1">=</span> <span class="br0">(</span><span class="kw3">atan2</span><span class="br0">(</span>x,z<span class="br0">)</span><span class="sy2">*</span>180<span class="br0">)</span><span class="sy2">/</span>PI<span class="sy4">;</span><br>&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; z_p <span class="sy1">=</span> <span class="kw3">sqrt</span><span class="br0">(</span><span class="kw3">pow</span><span class="br0">(</span>z,2<span class="br0">)</span><span class="sy2">+</span><span class="kw3">pow</span><span class="br0">(</span>x,2<span class="br0">)</span><span class="br0">)</span><span class="sy4">;</span><br>&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; L <span class="sy1">=</span> <span class="kw3">sqrt</span><span class="br0">(</span><span class="kw3">pow</span><span class="br0">(</span>z_p,2<span class="br0">)</span><span class="sy2">+</span><span class="kw3">pow</span><span class="br0">(</span>y,2<span class="br0">)</span><span class="br0">)</span><span class="sy4">;</span><br>&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; L_a <span class="sy1">=</span> <span class="kw3">sqrt</span><span class="br0">(</span><span class="kw3">pow</span><span class="br0">(</span>y<span class="sy2">+</span><span class="br0">(</span>Lp<span class="sy2">*</span><span class="kw3">sin</span><span class="br0">(</span>epsilon<span class="br0">)</span><span class="br0">)</span>,2<span class="br0">)</span><span class="sy2">+</span><span class="kw3">pow</span><span class="br0">(</span>z_p<span class="sy2">-</span><span class="br0">(</span>Lp<span class="sy2">*</span><span class="kw3">cos</span><span class="br0">(</span>epsilon<span class="br0">)</span><span class="br0">)</span>,2<span class="br0">)</span><span class="br0">)</span><span class="sy4">;</span><br>&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; beta_p <span class="sy1">=</span> <span class="kw3">atan2</span><span class="br0">(</span>y<span class="sy2">+</span><span class="br0">(</span>Lp<span class="sy2">*</span><span class="kw3">sin</span><span class="br0">(</span>epsilon<span class="br0">)</span><span class="br0">)</span>,z_p<span class="sy2">-</span><span class="br0">(</span>Lp<span class="sy2">*</span><span class="kw3">cos</span><span class="br0">(</span>epsilon<span class="br0">)</span><span class="br0">)</span><span class="br0">)</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; beta_pp <span class="sy1">=</span> <span class="kw3">atan2</span><span class="br0">(</span>y,z_p<span class="br0">)</span><span class="sy4">;</span><br>&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; beta_a <span class="sy1">=</span> <span class="kw3">acos</span><span class="br0">(</span><span class="br0">(</span><span class="kw3">pow</span><span class="br0">(</span>L1,2<span class="br0">)</span><span class="sy2">+</span><span class="kw3">pow</span><span class="br0">(</span>L_a,2<span class="br0">)</span><span class="sy2">-</span><span class="kw3">pow</span><span class="br0">(</span>L2,2<span class="br0">)</span><span class="br0">)</span><span class="sy2">/</span><span class="br0">(</span>2<span class="sy2">*</span>L1<span class="sy2">*</span>L_a<span class="br0">)</span><span class="br0">)</span><span class="sy4">;</span><br>&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; beta <span class="sy1">=</span> <span class="br0">(</span><span class="br0">(</span>beta_p<span class="sy2">+</span>beta_a<span class="br0">)</span><span class="sy2">*</span>180<span class="br0">)</span><span class="sy2">/</span>PI<span class="sy4">;</span><br>&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; gamma <span class="sy1">=</span> <span class="kw3">acos</span><span class="br0">(</span><span class="br0">(</span><span class="kw3">pow</span><span class="br0">(</span>L1,2<span class="br0">)</span><span class="sy2">+</span><span class="kw3">pow</span><span class="br0">(</span>L2,2<span class="br0">)</span><span class="sy2">-</span><span class="kw3">pow</span><span class="br0">(</span>L_a,2<span class="br0">)</span><span class="br0">)</span><span class="sy2">/</span><span class="br0">(</span>2<span class="sy2">*</span>L1<span class="sy2">*</span>L2<span class="br0">)</span><span class="br0">)</span><span class="sy4">;</span><br>&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; delta_a <span class="sy1">=</span> PI<span class="sy2">-</span><span class="br0">(</span>beta_a<span class="sy2">+</span>gamma<span class="br0">)</span><span class="sy4">;</span><br>&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; gamma <span class="sy1">=</span> <span class="br0">(</span>gamma<span class="sy2">*</span>180<span class="br0">)</span><span class="sy2">/</span>PI<span class="sy4">;</span><br>&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; delta_p <span class="sy1">=</span> <span class="kw3">acos</span><span class="br0">(</span><span class="br0">(</span><span class="kw3">pow</span><span class="br0">(</span>L_a,2<span class="br0">)</span><span class="sy2">+</span><span class="kw3">pow</span><span class="br0">(</span>Lp,2<span class="br0">)</span><span class="sy2">-</span><span class="kw3">pow</span><span class="br0">(</span>L,2<span class="br0">)</span><span class="br0">)</span><span class="sy2">/</span><span class="br0">(</span>2<span class="sy2">*</span>L_a<span class="sy2">*</span>Lp<span class="br0">)</span><span class="br0">)</span><span class="sy4">;</span> &nbsp; &nbsp; &nbsp; <br>&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">(</span>beta_pp <span class="sy1">&gt;</span> beta_p<span class="br0">)</span> <span class="br0">{</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; delta <span class="sy1">=</span> <span class="br0">(</span><span class="br0">(</span>2<span class="sy2">*</span>PI<span class="sy2">-</span><span class="br0">(</span>delta_p<span class="sy2">-</span>delta_a<span class="br0">)</span><span class="br0">)</span><span class="sy2">*</span>180<span class="br0">)</span><span class="sy2">/</span>PI<span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">}</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">else</span> <span class="br0">{</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; delta <span class="sy1">=</span> <span class="br0">(</span><span class="br0">(</span>delta_p<span class="sy2">+</span>delta_a<span class="br0">)</span><span class="sy2">*</span>180<span class="br0">)</span><span class="sy2">/</span>PI<span class="sy4">;</span><br>&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">(</span>isnan<span class="br0">(</span>delta<span class="br0">)</span><span class="br0">)</span> <span class="br0">{</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; delta <span class="sy1">=</span> <span class="br0">(</span><span class="br0">(</span>PI<span class="sy2">+</span>delta_a<span class="br0">)</span><span class="sy2">*</span>180<span class="br0">)</span><span class="sy2">/</span>PI<span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">}</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">}</span><br>&nbsp;<br>&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">(</span>isnan<span class="br0">(</span>gamma<span class="br0">)</span><span class="br0">)</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">{</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; coordenadas_correctas <span class="sy1">=</span> <span class="nu0">0</span><span class="sy4">;</span> <br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">}</span><br><br>&nbsp; &nbsp; &nbsp; &nbsp; brazo_fer<span class="sy4">::</span><span class="me2">Servos</span> posicion_servos_1<span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; brazo_fer<span class="sy4">::</span><span class="me2">Servos</span> velocidad_servos<span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; brazo_fer<span class="sy4">::</span><span class="me2">Servos</span> par_servos<span class="sy4">;</span> &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; posicion_servos_1.<span class="me1">base</span> <span class="sy1">=</span> <span class="br0">(</span><span class="br0">(</span>alfa<span class="sy2">+</span>150<span class="br0">)</span><span class="sy2">*</span>1023<span class="br0">)</span><span class="sy2">/</span><span class="nu0">300</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; posicion_servos_1.<span class="me1">arti1</span> <span class="sy1">=</span> <span class="br0">(</span><span class="br0">(</span>beta<span class="sy2">+</span>60<span class="br0">)</span><span class="sy2">*</span>1023<span class="br0">)</span><span class="sy2">/</span><span class="nu0">300</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; posicion_servos_1.<span class="me1">arti2</span> <span class="sy1">=</span> <span class="br0">(</span><span class="br0">(</span>gamma<span class="sy2">-</span>30<span class="br0">)</span><span class="sy2">*</span>1023<span class="br0">)</span><span class="sy2">/</span><span class="nu0">300</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; posicion_servos_1.<span class="me1">arti3</span> <span class="sy1">=</span> <span class="br0">(</span><span class="br0">(</span>delta<span class="sy2">-</span>30<span class="br0">)</span><span class="sy2">*</span>1023<span class="br0">)</span><span class="sy2">/</span><span class="nu0">300</span><span class="sy4">;</span>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">(</span>velocidad <span class="sy1">==</span> 0<span class="br0">)</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">{</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; velocidad_servos.<span class="me1">base</span> <span class="sy1">=</span> <span class="kw3">abs</span><span class="br0">(</span>posicion_servos_1.<span class="me1">base</span> <span class="sy2">-</span> posicion_servos_0.<span class="me1">base</span><span class="br0">)</span><span class="sy2">/</span><span class="nu0">5</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">(</span>velocidad_servos.<span class="me1">base</span> <span class="sy1">&gt;</span> 1023<span class="br0">)</span><span class="br0">{</span>velocidad_servos.<span class="me1">base</span> <span class="sy1">=</span> <span class="nu0">1023</span><span class="sy4">;</span><span class="br0">}</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">else</span> <span class="kw1">if</span> <span class="br0">(</span>velocidad_servos.<span class="me1">base</span> <span class="sy1">&lt;</span> 10<span class="br0">)</span><span class="br0">{</span>velocidad_servos.<span class="me1">base</span> <span class="sy1">=</span> <span class="nu0">10</span><span class="sy4">;</span><span class="br0">}</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; velocidad_servos.<span class="me1">arti1</span> <span class="sy1">=</span> <span class="kw3">abs</span><span class="br0">(</span>posicion_servos_1.<span class="me1">arti1</span> <span class="sy2">-</span> posicion_servos_0.<span class="me1">arti1</span><span class="br0">)</span><span class="sy2">/</span><span class="nu0">5</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">(</span>velocidad_servos.<span class="me1">arti1</span> <span class="sy1">&gt;</span> 1023<span class="br0">)</span><span class="br0">{</span>velocidad_servos.<span class="me1">arti1</span> <span class="sy1">=</span> <span class="nu0">1023</span><span class="sy4">;</span><span class="br0">}</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">else</span> <span class="kw1">if</span> <span class="br0">(</span>velocidad_servos.<span class="me1">arti1</span> <span class="sy1">&lt;</span> 10<span class="br0">)</span><span class="br0">{</span>velocidad_servos.<span class="me1">arti1</span> <span class="sy1">=</span> <span class="nu0">10</span><span class="sy4">;</span><span class="br0">}</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; velocidad_servos.<span class="me1">arti2</span> <span class="sy1">=</span> <span class="kw3">abs</span><span class="br0">(</span>posicion_servos_1.<span class="me1">arti2</span> <span class="sy2">-</span> posicion_servos_0.<span class="me1">arti2</span><span class="br0">)</span><span class="sy2">/</span><span class="nu0">5</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">(</span>velocidad_servos.<span class="me1">arti2</span> <span class="sy1">&gt;</span> 1023<span class="br0">)</span><span class="br0">{</span>velocidad_servos.<span class="me1">arti2</span> <span class="sy1">=</span> <span class="nu0">1023</span><span class="sy4">;</span><span class="br0">}</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">else</span> <span class="kw1">if</span> <span class="br0">(</span>velocidad_servos.<span class="me1">arti2</span> <span class="sy1">&lt;</span> 10<span class="br0">)</span><span class="br0">{</span>velocidad_servos.<span class="me1">arti2</span> <span class="sy1">=</span> <span class="nu0">10</span><span class="sy4">;</span><span class="br0">}</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; velocidad_servos.<span class="me1">arti3</span> <span class="sy1">=</span> <span class="kw3">abs</span><span class="br0">(</span>posicion_servos_1.<span class="me1">arti3</span> <span class="sy2">-</span> posicion_servos_0.<span class="me1">arti3</span><span class="br0">)</span><span class="sy2">/</span><span class="nu0">5</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">(</span>velocidad_servos.<span class="me1">arti3</span> <span class="sy1">&gt;</span> 1023<span class="br0">)</span><span class="br0">{</span>velocidad_servos.<span class="me1">arti3</span> <span class="sy1">=</span> <span class="nu0">1023</span><span class="sy4">;</span><span class="br0">}</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">else</span> <span class="kw1">if</span> <span class="br0">(</span>velocidad_servos.<span class="me1">arti3</span> <span class="sy1">&lt;</span> 10<span class="br0">)</span><span class="br0">{</span>velocidad_servos.<span class="me1">arti3</span> <span class="sy1">=</span> <span class="nu0">10</span><span class="sy4">;</span><span class="br0">}</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">}</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">else</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">{</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; velocidad_servos.<span class="me1">base</span> <span class="sy1">=</span> <span class="kw3">abs</span><span class="br0">(</span>posicion_servos_1.<span class="me1">base</span> <span class="sy2">-</span> posicion_servos_0.<span class="me1">base</span><span class="br0">)</span><span class="sy2">*</span><span class="br0">(</span>velocidad<span class="sy2">/</span>10<span class="br0">)</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">(</span>velocidad_servos.<span class="me1">base</span> <span class="sy1">&gt;</span> 1023<span class="br0">)</span><span class="br0">{</span>velocidad_servos.<span class="me1">base</span> <span class="sy1">=</span> <span class="nu0">1023</span><span class="sy4">;</span><span class="br0">}</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">else</span> <span class="kw1">if</span> <span class="br0">(</span>velocidad_servos.<span class="me1">base</span> <span class="sy1">&lt;</span> 10<span class="br0">)</span><span class="br0">{</span>velocidad_servos.<span class="me1">base</span> <span class="sy1">=</span> <span class="nu0">10</span><span class="sy4">;</span><span class="br0">}</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; velocidad_servos.<span class="me1">arti1</span> <span class="sy1">=</span> <span class="kw3">abs</span><span class="br0">(</span>posicion_servos_1.<span class="me1">arti1</span> <span class="sy2">-</span> posicion_servos_0.<span class="me1">arti1</span><span class="br0">)</span><span class="sy2">*</span><span class="br0">(</span>velocidad<span class="sy2">/</span>10<span class="br0">)</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">(</span>velocidad_servos.<span class="me1">arti1</span> <span class="sy1">&gt;</span> 1023<span class="br0">)</span><span class="br0">{</span>velocidad_servos.<span class="me1">arti1</span> <span class="sy1">=</span> <span class="nu0">1023</span><span class="sy4">;</span><span class="br0">}</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">else</span> <span class="kw1">if</span> <span class="br0">(</span>velocidad_servos.<span class="me1">arti1</span> <span class="sy1">&lt;</span> 10<span class="br0">)</span><span class="br0">{</span>velocidad_servos.<span class="me1">arti1</span> <span class="sy1">=</span> <span class="nu0">10</span><span class="sy4">;</span><span class="br0">}</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; velocidad_servos.<span class="me1">arti2</span> <span class="sy1">=</span> <span class="kw3">abs</span><span class="br0">(</span>posicion_servos_1.<span class="me1">arti2</span> <span class="sy2">-</span> posicion_servos_0.<span class="me1">arti2</span><span class="br0">)</span><span class="sy2">*</span><span class="br0">(</span>velocidad<span class="sy2">/</span>10<span class="br0">)</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">(</span>velocidad_servos.<span class="me1">arti2</span> <span class="sy1">&gt;</span> 1023<span class="br0">)</span><span class="br0">{</span>velocidad_servos.<span class="me1">arti2</span> <span class="sy1">=</span> <span class="nu0">1023</span><span class="sy4">;</span><span class="br0">}</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">else</span> <span class="kw1">if</span> <span class="br0">(</span>velocidad_servos.<span class="me1">arti2</span> <span class="sy1">&lt;</span> 10<span class="br0">)</span><span class="br0">{</span>velocidad_servos.<span class="me1">arti2</span> <span class="sy1">=</span> <span class="nu0">10</span><span class="sy4">;</span><span class="br0">}</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; velocidad_servos.<span class="me1">arti3</span> <span class="sy1">=</span> <span class="kw3">abs</span><span class="br0">(</span>posicion_servos_1.<span class="me1">arti3</span> <span class="sy2">-</span> posicion_servos_0.<span class="me1">arti3</span><span class="br0">)</span><span class="sy2">*</span><span class="br0">(</span>velocidad<span class="sy2">/</span>10<span class="br0">)</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">(</span>velocidad_servos.<span class="me1">arti3</span> <span class="sy1">&gt;</span> 1023<span class="br0">)</span><span class="br0">{</span>velocidad_servos.<span class="me1">arti3</span> <span class="sy1">=</span> <span class="nu0">1023</span><span class="sy4">;</span><span class="br0">}</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">else</span> <span class="kw1">if</span> <span class="br0">(</span>velocidad_servos.<span class="me1">arti3</span> <span class="sy1">&lt;</span> 10<span class="br0">)</span><span class="br0">{</span>velocidad_servos.<span class="me1">arti3</span> <span class="sy1">=</span> <span class="nu0">10</span><span class="sy4">;</span><span class="br0">}</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">}</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; brazo_fer<span class="sy4">::</span><span class="me2">Servos</span> velocidad_servos_0<span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; velocidad_servos_0.<span class="me1">base</span> <span class="sy1">=</span> <span class="nu0">0</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; velocidad_servos_0.<span class="me1">arti1</span> <span class="sy1">=</span> <span class="nu0">0</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; velocidad_servos_0.<span class="me1">arti2</span> <span class="sy1">=</span> <span class="nu0">0</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; velocidad_servos_0.<span class="me1">arti3</span> <span class="sy1">=</span> <span class="nu0">0</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; par_servos.<span class="me1">base</span> <span class="sy1">=</span> <span class="nu0">1</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; par_servos.<span class="me1">arti1</span> <span class="sy1">=</span> <span class="nu0">1</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; par_servos.<span class="me1">arti2</span> <span class="sy1">=</span> <span class="nu0">1</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; par_servos.<span class="me1">arti3</span> <span class="sy1">=</span> <span class="nu0">1</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; brazo_fer<span class="sy4">::</span><span class="me2">WriteServos</span> move_arm<span class="sy4">;</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">(</span>coordenadas_correctas <span class="sy1">==</span> 1 <span class="sy3">&amp;&amp;</span> <span class="br0">(</span>205 <span class="sy1">&lt;=</span> posicion_servos_1.<span class="me1">base</span> <span class="sy3">&amp;&amp;</span> posicion_servos_1.<span class="me1">base</span> <span class="sy1">&lt;=</span> 818<span class="br0">)</span> <span class="sy3">&amp;&amp;</span> <span class="br0">(</span>120 <span class="sy1">&lt;=</span> posicion_servos_1.<span class="me1">arti1</span> <span class="sy3">&amp;&amp;</span> posicion_servos_1.<span class="me1">arti1</span> <span class="sy1">&lt;=</span> 920<span class="br0">)</span> <span class="sy3">&amp;&amp;</span> posicion_servos_1.<span class="me1">arti2</span> <span class="sy1">&gt;=</span> 50 &nbsp;<span class="sy3">&amp;&amp;</span> <span class="br0">(</span>posicion_servos_1.<span class="me1">arti3</span> <span class="sy1">&lt;=</span> 828 <span class="sy3">&amp;&amp;</span> posicion_servos_1.<span class="me1">arti3</span> <span class="sy1">&gt;=</span> 195<span class="br0">)</span><span class="br0">)</span> <span class="br0">{</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; move_arm.<span class="me1">posicion</span> <span class="sy1">=</span> posicion_servos_1<span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; move_arm.<span class="me1">velocidad</span> <span class="sy1">=</span> velocidad_servos<span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; move_arm.<span class="me1">par</span> <span class="sy1">=</span> par_servos<span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">return</span> move_arm<span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">}</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">else</span> <span class="br0">{</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; std<span class="sy4">::</span><span class="kw3">cout</span><span class="sy1">&lt;&lt;</span><span class="st0">"error coordenadas no validas o punto fuera del alcance"</span><span class="sy1">&lt;&lt;</span>std<span class="sy4">::</span><span class="me2">endl</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; move_arm.<span class="me1">posicion</span> <span class="sy1">=</span> posicion_servos_0<span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; move_arm.<span class="me1">velocidad</span> <span class="sy1">=</span> velocidad_servos_0<span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; move_arm.<span class="me1">par</span> <span class="sy1">=</span> par_servos<span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">return</span> move_arm<span class="sy4">;</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">}</span> &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; <span class="br0">}</span><br>&nbsp; <br>brazo_fer<span class="sy4">::</span><span class="me2">WriteServos</span> &nbsp;control_pinza<span class="br0">(</span>brazo_fer<span class="sy4">::</span><span class="me2">Servos</span> posicion_servos_1, brazo_fer<span class="sy4">::</span><span class="me2">Servos</span> posicion_servos_0, brazo_fer<span class="sy4">::</span><span class="me2">Servos</span> corriente_servos<span class="br0">)</span><br>&nbsp; <span class="br0">{</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; brazo_fer<span class="sy4">::</span><span class="me2">Servos</span> velocidad_servos<span class="sy4">;</span> &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; brazo_fer<span class="sy4">::</span><span class="me2">Servos</span> par_servos<span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; velocidad_servos.<span class="me1">pinza</span> <span class="sy1">=</span> <span class="nu0">50</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; par_servos.<span class="me1">pinza</span> <span class="sy1">=</span> <span class="nu0">1</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; brazo_fer<span class="sy4">::</span><span class="me2">WriteServos</span> hand_arm<span class="sy4">;</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">(</span><span class="br0">(</span>posicion_servos_1.<span class="me1">pinza</span> <span class="sy1">&gt;=</span> 480 <span class="sy3">&amp;&amp;</span> posicion_servos_1.<span class="me1">pinza</span> <span class="sy1">&lt;=</span> 680 <span class="sy3">&amp;&amp;</span> corriente_servos.<span class="me1">pinza</span> <span class="sy1">&lt;=</span> 300<span class="br0">)</span> <span class="sy3">||</span> <span class="br0">(</span>posicion_servos_0.<span class="me1">pinza</span> <span class="sy1">&gt;</span> posicion_servos_1.<span class="me1">pinza</span> <span class="sy3">&amp;&amp;</span> posicion_servos_1.<span class="me1">pinza</span> <span class="sy1">&gt;=</span> 480<span class="br0">)</span><span class="br0">)</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">{</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; hand_arm.<span class="me1">posicion</span> <span class="sy1">=</span> posicion_servos_1<span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; hand_arm.<span class="me1">velocidad</span> <span class="sy1">=</span> velocidad_servos<span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; hand_arm.<span class="me1">par</span> <span class="sy1">=</span> par_servos<span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">return</span> hand_arm<span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">}</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">else</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">{</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; std<span class="sy4">::</span><span class="kw3">cout</span><span class="sy1">&lt;&lt;</span><span class="st0">"Alcanzado límite de la pinza"</span><span class="sy1">&lt;&lt;</span>std<span class="sy4">::</span><span class="me2">endl</span><span class="sy4">;</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; hand_arm.<span class="me1">posicion</span> <span class="sy1">=</span> posicion_servos_0<span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; hand_arm.<span class="me1">velocidad</span> <span class="sy1">=</span> velocidad_servos<span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; hand_arm.<span class="me1">par</span> <span class="sy1">=</span> par_servos<span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">return</span> hand_arm<span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">}</span><br>&nbsp; <span class="br0">}</span> &nbsp;<br>&nbsp; <br>geometry_msgs<span class="sy4">::</span><span class="me2">Point</span> home<span class="br0">(</span>brazo_fer<span class="sy4">::</span><span class="me2">Servos</span> posicion_servos_0, brazo_fer<span class="sy4">::</span><span class="me2">Servos</span> corriente_servos<span class="br0">)</span><br>&nbsp; <span class="br0">{</span> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; ros<span class="sy4">::</span><span class="me2">NodeHandle</span> n<span class="sy4">;</span><br>&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; ros<span class="sy4">::</span><span class="me2">Publisher</span> move_pub_<span class="sy1">=</span>n.<span class="me1">advertise</span><span class="sy1">&lt;</span>brazo_fer<span class="sy4">::</span><span class="me2">WriteServos</span><span class="sy1">&gt;</span><span class="br0">(</span><span class="st0">"move_arm"</span>, 1<span class="br0">)</span><span class="sy4">;</span> &nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; ros<span class="sy4">::</span><span class="me2">Publisher</span> hand_pub_<span class="sy1">=</span>n.<span class="me1">advertise</span><span class="sy1">&lt;</span>brazo_fer<span class="sy4">::</span><span class="me2">WriteServos</span><span class="sy1">&gt;</span><span class="br0">(</span><span class="st0">"hand_arm"</span>, 1<span class="br0">)</span><span class="sy4">;</span> &nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; geometry_msgs<span class="sy4">::</span><span class="me2">Point</span> punto_0<span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; punto_0.<span class="me1">x</span> <span class="sy1">=</span> <span class="nu0">0</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; punto_0.<span class="me1">y</span> <span class="sy1">=</span> <span class="nu0">80</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; punto_0.<span class="me1">z</span> <span class="sy1">=</span> <span class="nu0">50</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw4">int</span> inclinacion_pinza <span class="sy1">=</span> <span class="nu0">0</span><span class="sy4">;</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; brazo_fer<span class="sy4">::</span><span class="me2">WriteServos</span> inicio_brazo <span class="sy1">=</span> inversa<span class="br0">(</span>punto_0, inclinacion_pinza, posicion_servos_0, 0<span class="br0">)</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; brazo_fer<span class="sy4">::</span><span class="me2">Servos</span> posicion_servos_1<span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; posicion_servos_1.<span class="me1">pinza</span> <span class="sy1">=</span> <span class="nu0">511</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; brazo_fer<span class="sy4">::</span><span class="me2">WriteServos</span> inicio_pinza <span class="sy1">=</span> control_pinza<span class="br0">(</span>posicion_servos_1, posicion_servos_0, corriente_servos<span class="br0">)</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; move_pub_.<span class="me1">publish</span><span class="br0">(</span>inicio_brazo<span class="br0">)</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; hand_pub_.<span class="me1">publish</span><span class="br0">(</span>inicio_pinza<span class="br0">)</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">return</span> punto_0<span class="sy4">;</span><br><br>&nbsp; <span class="br0">}</span><br>&nbsp; &nbsp; <br><span class="co2">#endif</span></div></div>
<h3><span class="mw-headline" id="Program">Program</span></h3>
<p>This program execute the sequence to grasp a little plastic bottle 
(the bottle is empty since the torque of the servo motors is low, we 
need more servo motors on each joint in order to pick more load). The 
sequence steps are shown below:
</p>
<ol>
<li> Approach (place the gripper at 70 mm of the bottle position).
</li>
<li> Placement in the bottle position.
</li>
<li> To close the gripper (until to hold the bottle).
</li>
<li> Lifting and approach.
</li>
</ol>
<p>We will create a file named "control_v02.cpp" with the content that is shown below within the folder "src" of our <i>package</i>:
</p>
<div dir="ltr" class="mw-geshi mw-content-ltr"><div class="cpp source-cpp" style="font-family:monospace;">&nbsp; <span class="co2">#include "ros/ros.h"</span><br>&nbsp; <span class="co2">#include "brazo_fer/Servos.h"</span><br>&nbsp; <span class="co2">#include "brazo_fer/WriteServos.h" &nbsp;</span><br>&nbsp; <span class="co2">#include "brazo_fer/ReadServos.h"</span><br>&nbsp; <span class="co2">#include "brazo_fer/brazo_fer.h" &nbsp; &nbsp; </span><br>&nbsp; <span class="co2">#include "std_msgs/Int16.h"</span><br>&nbsp; <span class="co2">#include "std_msgs/String.h" &nbsp;</span><br>&nbsp; <span class="co2">#include "geometry_msgs/Point.h"</span><br>&nbsp; <span class="co2">#include "math.h" </span><br>&nbsp; <br>&nbsp; geometry_msgs<span class="sy4">::</span><span class="me2">Point</span> punto_0,punto_1<span class="sy4">;</span><br>&nbsp; <br>&nbsp; <span class="kw4">int</span> cont <span class="sy1">=</span> <span class="nu0">0</span><span class="sy4">;</span><br>&nbsp; <span class="kw4">int</span> cont_1 <span class="sy1">=</span> <span class="nu0">0</span><span class="sy4">;</span><br>&nbsp; <span class="kw4">int</span> cont_2 <span class="sy1">=</span> <span class="nu0">0</span><span class="sy4">;</span><br>&nbsp; <span class="kw4">int</span> inclinacion_pinza <span class="sy1">=</span> <span class="nu0">0</span><span class="sy4">;</span><br>&nbsp; <span class="kw4">int</span> start <span class="sy1">=</span> <span class="nu0">0</span><span class="sy4">;</span><br>&nbsp; &nbsp; <br>&nbsp; brazo_fer<span class="sy4">::</span><span class="me2">Servos</span> pg, cg<span class="sy4">;</span><br>&nbsp; brazo_fer<span class="sy4">::</span><span class="me2">WriteServos</span> move<span class="sy4">;</span><br>&nbsp; brazo_fer<span class="sy4">::</span><span class="me2">Servos</span> pinza<span class="sy4">;</span><br>&nbsp; brazo_fer<span class="sy4">::</span><span class="me2">WriteServos</span> pin<span class="sy4">;</span> &nbsp;<br>&nbsp; brazo_fer<span class="sy4">::</span><span class="me2">WriteServos</span> error_coordenadas<span class="sy4">;</span><br>&nbsp; <br>&nbsp; brazo_fer<span class="sy4">::</span><span class="me2">WriteServos</span> acercar<span class="br0">(</span>geometry_msgs<span class="sy4">::</span><span class="me2">Point</span> cerca<span class="br0">)</span><br>&nbsp; <span class="br0">{</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw4">double</span> x <span class="sy1">=</span> cerca.<span class="me1">x</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw4">double</span> z <span class="sy1">=</span> cerca.<span class="me1">z</span><span class="sy4">;</span> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; cerca.<span class="me1">z</span> <span class="sy1">=</span> cerca.<span class="me1">z</span> <span class="sy2">-</span> 70<span class="sy2">*</span><span class="kw3">cos</span><span class="br0">(</span><span class="kw3">atan2</span><span class="br0">(</span>x,z<span class="br0">)</span><span class="br0">)</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; cerca.<span class="me1">x</span> <span class="sy1">=</span> cerca.<span class="me1">x</span> <span class="sy2">-</span> 70<span class="sy2">*</span><span class="kw3">sin</span><span class="br0">(</span><span class="kw3">atan2</span><span class="br0">(</span>x,z<span class="br0">)</span><span class="br0">)</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; brazo_fer<span class="sy4">::</span><span class="me2">WriteServos</span> move <span class="sy1">=</span> inversa<span class="br0">(</span>cerca, <span class="sy4">::</span><span class="me2">inclinacion_pinza</span>, <span class="sy4">::</span><span class="me2">pg</span>, 0<span class="br0">)</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">return</span> move<span class="sy4">;</span><br><br>&nbsp; <span class="br0">}</span><br>&nbsp; <br>&nbsp; &nbsp; brazo_fer<span class="sy4">::</span><span class="me2">WriteServos</span> levantar_acercar<span class="br0">(</span>geometry_msgs<span class="sy4">::</span><span class="me2">Point</span> la<span class="br0">)</span><br>&nbsp; <span class="br0">{</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; la.<span class="me1">x</span> <span class="sy1">=</span> <span class="nu0">0</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; la.<span class="me1">y</span> <span class="sy1">=</span> la.<span class="me1">y</span> <span class="sy2">+</span> <span class="nu0">50</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; la.<span class="me1">z</span> <span class="sy1">=</span> <span class="nu0">60</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">(</span>la.<span class="me1">y</span> <span class="sy1">&lt;</span> 75<span class="br0">)</span> <span class="br0">{</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; la.<span class="me1">y</span> <span class="sy1">=</span> <span class="nu0">75</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">}</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; brazo_fer<span class="sy4">::</span><span class="me2">WriteServos</span> move <span class="sy1">=</span> inversa<span class="br0">(</span>la, <span class="sy4">::</span><span class="me2">inclinacion_pinza</span>, <span class="sy4">::</span><span class="me2">pg</span>, 0<span class="br0">)</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="sy4">::</span><span class="me2">punto_0</span> <span class="sy1">=</span> la<span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">return</span> move<span class="sy4">;</span><br><br>&nbsp; <span class="br0">}</span><br>&nbsp; <br>&nbsp; <span class="kw4">void</span> posicion_estado_corriente<span class="br0">(</span><span class="kw4">const</span> brazo_fer<span class="sy4">::</span><span class="me2">ReadServos</span><span class="sy3">&amp;</span> pec<span class="br0">)</span> &nbsp; <br>&nbsp; <span class="br0">{</span> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; ros<span class="sy4">::</span><span class="me2">NodeHandle</span> n<span class="sy4">;</span><br>&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; ros<span class="sy4">::</span><span class="me2">Publisher</span> move_pub_<span class="sy1">=</span>n.<span class="me1">advertise</span><span class="sy1">&lt;</span>brazo_fer<span class="sy4">::</span><span class="me2">WriteServos</span><span class="sy1">&gt;</span><span class="br0">(</span><span class="st0">"move_arm"</span>, 1<span class="br0">)</span><span class="sy4">;</span> <br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; ros<span class="sy4">::</span><span class="me2">Publisher</span> hand_pub_<span class="sy1">=</span>n.<span class="me1">advertise</span><span class="sy1">&lt;</span>brazo_fer<span class="sy4">::</span><span class="me2">WriteServos</span><span class="sy1">&gt;</span><span class="br0">(</span><span class="st0">"hand_arm"</span>, 1<span class="br0">)</span><span class="sy4">;</span> &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; brazo_fer<span class="sy4">::</span><span class="me2">Servos</span> p <span class="sy1">=</span> pec.<span class="me1">posicion</span><span class="sy4">;</span> &nbsp;<br><br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="sy4">::</span><span class="me2">pg</span> <span class="sy1">=</span> pec.<span class="me1">posicion</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="sy4">::</span><span class="me2">cg</span> <span class="sy1">=</span> pec.<span class="me1">corriente</span><span class="sy4">;</span> &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; brazo_fer<span class="sy4">::</span><span class="me2">Servos</span> e <span class="sy1">=</span> pec.<span class="me1">estado</span><span class="sy4">;</span> &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; brazo_fer<span class="sy4">::</span><span class="me2">Servos</span> c <span class="sy1">=</span> pec.<span class="me1">corriente</span><span class="sy4">;</span> &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; <br><br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">(</span><span class="sy4">::</span><span class="me2">cont</span> <span class="sy1">==</span> 0<span class="br0">)</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">{</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="sy4">::</span><span class="me2">punto_0</span> <span class="sy1">=</span> home<span class="br0">(</span>p, c<span class="br0">)</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="sy4">::</span><span class="me2">punto_1</span> <span class="sy1">=</span> <span class="sy4">::</span><span class="me2">punto_0</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="sy4">::</span><span class="me2">cont</span> <span class="sy1">=</span> <span class="sy4">::</span><span class="me2">cont</span><span class="sy2">+</span><span class="nu0">1</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">}</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">(</span><span class="sy4">::</span><span class="me2">punto_0</span>.<span class="me1">x</span> <span class="sy3">!</span><span class="sy1">=</span> <span class="sy4">::</span><span class="me2">punto_1</span>.<span class="me1">x</span> <span class="sy3">||</span> <span class="sy4">::</span><span class="me2">punto_0</span>.<span class="me1">y</span> <span class="sy3">!</span><span class="sy1">=</span> <span class="sy4">::</span><span class="me2">punto_1</span>.<span class="me1">y</span> <span class="sy3">||</span> <span class="sy4">::</span><span class="me2">punto_0</span>.<span class="me1">z</span> <span class="sy3">!</span><span class="sy1">=</span> <span class="sy4">::</span><span class="me2">punto_1</span>.<span class="me1">z</span> <span class="br0">)</span> <span class="br0">{</span><br><br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">(</span><span class="sy4">::</span><span class="me2">cont_1</span> <span class="sy1">==</span> 0<span class="br0">)</span> <span class="br0">{</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="sy4">::</span><span class="me2">move</span> <span class="sy1">=</span> acercar<span class="br0">(</span><span class="sy4">::</span><span class="me2">punto_0</span><span class="br0">)</span><span class="sy4">;</span> &nbsp; &nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; move_pub_.<span class="me1">publish</span><span class="br0">(</span><span class="sy4">::</span><span class="me2">move</span><span class="br0">)</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="sy4">::</span><span class="me2">cont_1</span> <span class="sy1">=</span> <span class="sy4">::</span><span class="me2">cont_1</span><span class="sy2">+</span><span class="nu0">1</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">}</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">(</span><span class="br0">(</span><span class="br0">(</span>p.<span class="me1">base</span><span class="sy2">-</span>15<span class="br0">)</span> <span class="sy1">&lt;</span> <span class="sy4">::</span><span class="me2">move</span>.<span class="me1">posicion</span>.<span class="me1">base</span> <span class="sy3">&amp;&amp;</span> <span class="sy4">::</span><span class="me2">move</span>.<span class="me1">posicion</span>.<span class="me1">base</span> <span class="sy1">&lt;</span> <span class="br0">(</span>p.<span class="me1">base</span><span class="sy2">+</span>15<span class="br0">)</span><span class="br0">)</span> <span class="sy3">&amp;&amp;</span> <span class="br0">(</span><span class="br0">(</span>p.<span class="me1">arti1</span><span class="sy2">-</span>15<span class="br0">)</span> <span class="sy1">&lt;</span> <span class="sy4">::</span><span class="me2">move</span>.<span class="me1">posicion</span>.<span class="me1">arti1</span> <span class="sy3">&amp;&amp;</span> <span class="sy4">::</span><span class="me2">move</span>.<span class="me1">posicion</span>.<span class="me1">arti1</span> <span class="sy1">&lt;</span> <span class="br0">(</span>p.<span class="me1">arti1</span><span class="sy2">+</span>15<span class="br0">)</span><span class="br0">)</span> <span class="sy3">&amp;&amp;</span> <span class="br0">(</span><span class="br0">(</span>p.<span class="me1">arti2</span><span class="sy2">-</span>15<span class="br0">)</span> <span class="sy1">&lt;</span> <span class="sy4">::</span><span class="me2">move</span>.<span class="me1">posicion</span>.<span class="me1">arti2</span> <span class="sy3">&amp;&amp;</span> <span class="sy4">::</span><span class="me2">move</span>.<span class="me1">posicion</span>.<span class="me1">arti2</span> <span class="sy1">&lt;</span> <span class="br0">(</span>p.<span class="me1">arti2</span><span class="sy2">+</span>15<span class="br0">)</span><span class="br0">)</span> <span class="sy3">&amp;&amp;</span> <span class="br0">(</span><span class="br0">(</span>p.<span class="me1">arti3</span><span class="sy2">-</span>15<span class="br0">)</span> <span class="sy1">&lt;</span> <span class="sy4">::</span><span class="me2">move</span>.<span class="me1">posicion</span>.<span class="me1">arti3</span> <span class="sy3">&amp;&amp;</span> <span class="sy4">::</span><span class="me2">move</span>.<span class="me1">posicion</span>.<span class="me1">arti3</span> <span class="sy1">&lt;</span> <span class="br0">(</span>p.<span class="me1">arti3</span><span class="sy2">+</span>15<span class="br0">)</span><span class="br0">)</span><span class="br0">)</span> <span class="br0">{</span> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">(</span><span class="sy4">::</span><span class="me2">cont_2</span> <span class="sy1">==</span> 0<span class="br0">)</span> <span class="br0">{</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="sy4">::</span><span class="me2">move</span> <span class="sy1">=</span> inversa<span class="br0">(</span><span class="sy4">::</span><span class="me2">punto_0</span>, <span class="sy4">::</span><span class="me2">inclinacion_pinza</span>, <span class="sy4">::</span><span class="me2">pg</span>, 0<span class="br0">)</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; move_pub_.<span class="me1">publish</span><span class="br0">(</span><span class="sy4">::</span><span class="me2">move</span><span class="br0">)</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="sy4">::</span><span class="me2">cont_2</span> <span class="sy1">=</span> <span class="sy4">::</span><span class="me2">cont_2</span><span class="sy2">+</span><span class="nu0">1</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">}</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">else</span> <span class="br0">{</span>&nbsp; &nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">(</span><span class="br0">(</span><span class="br0">(</span>p.<span class="me1">base</span><span class="sy2">-</span>15<span class="br0">)</span> <span class="sy1">&lt;</span> <span class="sy4">::</span><span class="me2">move</span>.<span class="me1">posicion</span>.<span class="me1">base</span> <span class="sy3">&amp;&amp;</span> <span class="sy4">::</span><span class="me2">move</span>.<span class="me1">posicion</span>.<span class="me1">base</span> <span class="sy1">&lt;</span> <span class="br0">(</span>p.<span class="me1">base</span><span class="sy2">+</span>15<span class="br0">)</span><span class="br0">)</span> <span class="sy3">&amp;&amp;</span> <span class="br0">(</span><span class="br0">(</span>p.<span class="me1">arti1</span><span class="sy2">-</span>15<span class="br0">)</span> <span class="sy1">&lt;</span> <span class="sy4">::</span><span class="me2">move</span>.<span class="me1">posicion</span>.<span class="me1">arti1</span> <span class="sy3">&amp;&amp;</span> <span class="sy4">::</span><span class="me2">move</span>.<span class="me1">posicion</span>.<span class="me1">arti1</span> <span class="sy1">&lt;</span> <span class="br0">(</span>p.<span class="me1">arti1</span><span class="sy2">+</span>15<span class="br0">)</span><span class="br0">)</span> <span class="sy3">&amp;&amp;</span> <span class="br0">(</span><span class="br0">(</span>p.<span class="me1">arti2</span><span class="sy2">-</span>15<span class="br0">)</span> <span class="sy1">&lt;</span> <span class="sy4">::</span><span class="me2">move</span>.<span class="me1">posicion</span>.<span class="me1">arti2</span> <span class="sy3">&amp;&amp;</span> <span class="sy4">::</span><span class="me2">move</span>.<span class="me1">posicion</span>.<span class="me1">arti2</span> <span class="sy1">&lt;</span> <span class="br0">(</span>p.<span class="me1">arti2</span><span class="sy2">+</span>15<span class="br0">)</span><span class="br0">)</span> <span class="sy3">&amp;&amp;</span> <span class="br0">(</span><span class="br0">(</span>p.<span class="me1">arti3</span><span class="sy2">-</span>15<span class="br0">)</span> <span class="sy1">&lt;</span> <span class="sy4">::</span><span class="me2">move</span>.<span class="me1">posicion</span>.<span class="me1">arti3</span> <span class="sy3">&amp;&amp;</span> <span class="sy4">::</span><span class="me2">move</span>.<span class="me1">posicion</span>.<span class="me1">arti3</span> <span class="sy1">&lt;</span> <span class="br0">(</span>p.<span class="me1">arti3</span><span class="sy2">+</span>15<span class="br0">)</span><span class="br0">)</span><span class="br0">)</span> <span class="br0">{</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="sy4">::</span><span class="me2">pinza</span>.<span class="me1">pinza</span> <span class="sy1">=</span> p.<span class="me1">pinza</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp;
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">if</span><span class="br0">(</span><span class="sy4">::</span><span class="me2">pin</span>.<span class="me1">posicion</span>.<span class="me1">pinza</span> <span class="sy3">!</span><span class="sy1">=</span> p.<span class="me1">pinza</span><span class="br0">)</span> <span class="br0">{</span><br>&nbsp;
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp;
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; std<span class="sy4">::</span><span class="kw3">cout</span><span class="sy1">&lt;&lt;</span>c.<span class="me1">pinza</span><span class="sy1">&lt;&lt;</span>std<span class="sy4">::</span><span class="me2">endl</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp;
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; <span class="sy4">::</span><span class="me2">pinza</span>.<span class="me1">pinza</span> <span class="sy1">=</span> <span class="sy4">::</span><span class="me2">pinza</span>.<span class="me1">pinza</span> <span class="sy2">+</span> <span class="nu0">20</span><span class="sy4">;</span><br>&nbsp;
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp;
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; <span class="sy4">::</span><span class="me2">pin</span> <span class="sy1">=</span> control_pinza<span class="br0">(</span><span class="sy4">::</span><span class="me2">pinza</span>, p, c<span class="br0">)</span><span class="sy4">;</span><br>&nbsp;
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp;
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; hand_pub_.<span class="me1">publish</span><span class="br0">(</span><span class="sy4">::</span><span class="me2">pin</span><span class="br0">)</span><span class="sy4">;</span><br>&nbsp;
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">}</span><br>&nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">else</span> <span class="br0">{</span><br>&nbsp;
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp;
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; std<span class="sy4">::</span><span class="kw3">cout</span><span class="sy1">&lt;&lt;</span><span class="st0">"Agarrado"</span><span class="sy1">&lt;&lt;</span>std<span class="sy4">::</span><span class="me2">endl</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp;
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; <span class="sy4">::</span><span class="me2">move</span> <span class="sy1">=</span> levantar_acercar<span class="br0">(</span><span class="sy4">::</span><span class="me2">punto_0</span><span class="br0">)</span><span class="sy4">;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp;
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; move_pub_.<span class="me1">publish</span><span class="br0">(</span><span class="sy4">::</span><span class="me2">move</span><span class="br0">)</span><span class="sy4">;</span><br>&nbsp;
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp;
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; <span class="sy4">::</span><span class="me2">punto_1</span> <span class="sy1">=</span> <span class="sy4">::</span><span class="me2">punto_0</span><span class="sy4">;</span><br>&nbsp;
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp;
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; <span class="sy4">::</span><span class="me2">cont_1</span> <span class="sy1">=</span> <span class="nu0">0</span><span class="sy4">;</span><br>&nbsp;
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; <span class="sy4">::</span><span class="me2">cont_2</span> <span class="sy1">=</span> <span class="nu0">0</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">}</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">}</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">}</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">}</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">else</span> <span class="br0">{</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; std<span class="sy4">::</span><span class="kw3">cout</span><span class="sy1">&lt;&lt;</span><span class="st0">"En movimiento"</span><span class="sy1">&lt;&lt;</span>std<span class="sy4">::</span><span class="me2">endl</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">}</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">}</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; <span class="br0">}</span><br>&nbsp;<br>&nbsp; <span class="kw4">void</span> punto<span class="br0">(</span><span class="kw4">const</span> geometry_msgs<span class="sy4">::</span><span class="me2">Point</span><span class="sy3">&amp;</span> point<span class="br0">)</span> &nbsp; <br>&nbsp; <span class="br0">{</span> &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; ros<span class="sy4">::</span><span class="me2">NodeHandle</span> n<span class="sy4">;</span><br>&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; ros<span class="sy4">::</span><span class="me2">Publisher</span> move_pub_<span class="sy1">=</span>n.<span class="me1">advertise</span><span class="sy1">&lt;</span>brazo_fer<span class="sy4">::</span><span class="me2">WriteServos</span><span class="sy1">&gt;</span><span class="br0">(</span><span class="st0">"move_arm"</span>, 1<span class="br0">)</span><span class="sy4">;</span> &nbsp; <span class="co1">//Publicación del topic "move_arm"</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; ros<span class="sy4">::</span><span class="me2">Publisher</span> hand_pub_<span class="sy1">=</span>n.<span class="me1">advertise</span><span class="sy1">&lt;</span>brazo_fer<span class="sy4">::</span><span class="me2">WriteServos</span><span class="sy1">&gt;</span><span class="br0">(</span><span class="st0">"hand_arm"</span>, 1<span class="br0">)</span><span class="sy4">;</span> &nbsp; <span class="co1">//Publicación del topic "hand_arm"</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="sy4">::</span><span class="me2">punto_0</span> <span class="sy1">=</span> point<span class="sy4">;</span><br><br>&nbsp; <span class="br0">}</span> <br>&nbsp;<br>&nbsp; <span class="kw4">int</span> main<span class="br0">(</span><span class="kw4">int</span> argc, <span class="kw4">char</span> <span class="sy2">**</span>argv<span class="br0">)</span><br>&nbsp; <span class="br0">{</span><br>&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; ros<span class="sy4">::</span><span class="me2">init</span><span class="br0">(</span>argc, argv, <span class="st0">"control_recogida"</span><span class="br0">)</span><span class="sy4">;</span><br>&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; ros<span class="sy4">::</span><span class="me2">NodeHandle</span> n<span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; ros<span class="sy4">::</span><span class="me2">Subscriber</span> pose_sub_<span class="sy1">=</span> n.<span class="me1">subscribe</span><span class="br0">(</span><span class="st0">"pose_arm"</span>, 1, posicion_estado_corriente<span class="br0">)</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; ros<span class="sy4">::</span><span class="me2">Subscriber</span> point_sub_<span class="sy1">=</span> n.<span class="me1">subscribe</span><span class="br0">(</span><span class="st0">"pick_point"</span>, 1, punto<span class="br0">)</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; ros<span class="sy4">::</span><span class="me2">Publisher</span> move_pub_<span class="sy1">=</span>n.<span class="me1">advertise</span><span class="sy1">&lt;</span>brazo_fer<span class="sy4">::</span><span class="me2">WriteServos</span><span class="sy1">&gt;</span><span class="br0">(</span><span class="st0">"move_arm"</span>, 1<span class="br0">)</span><span class="sy4">;</span><br><br>&nbsp; &nbsp; &nbsp; &nbsp; ros<span class="sy4">::</span><span class="me2">Publisher</span> hand_pub_<span class="sy1">=</span>n.<span class="me1">advertise</span><span class="sy1">&lt;</span>brazo_fer<span class="sy4">::</span><span class="me2">WriteServos</span><span class="sy1">&gt;</span><span class="br0">(</span><span class="st0">"hand_arm"</span>, 1<span class="br0">)</span><span class="sy4">;</span>&nbsp; &nbsp; <br><br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; ros<span class="sy4">::</span><span class="me2">spin</span><span class="br0">(</span><span class="br0">)</span><span class="sy4">;</span><br>&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">return</span> <span class="nu0">0</span><span class="sy4">;</span><br>&nbsp; <span class="br0">}</span></div></div>
<p>We have to add the next line to the file "CMakeLists.txt" of our package in order to compile and create the executable file: 
</p>
<div dir="ltr" class="mw-geshi mw-content-ltr"><div class="cmake source-cmake" style="font-family:monospace;"><pre class="de1">rosbuild_add_executable<span class="sy0">(</span>contro_v02 src/control_v02.cpp<span class="sy0">)</span></pre></div></div>
<p>We will execute the next commands in a terminal in order to compile and create the executable file: 
</p>
<div dir="ltr" class="mw-geshi mw-content-ltr"><div class="bash source-bash" style="font-family:monospace;"><pre class="de1">roscd brazo_fer
<span class="kw2">make</span></pre></div></div>
<h3><span class="mw-headline" id="Running_the_program_2">Running the program</span></h3>
<p>First we will execute the next command in a terminal in order to launch the <a rel="nofollow" class="external text" href="http://www.ros.org/">ROS</a> core, if it has not launched previously.
</p>
<div dir="ltr" class="mw-geshi mw-content-ltr"><div class="bash source-bash" style="font-family:monospace;"><pre class="de1">roscore</pre></div></div>
<p>We will execute the next command in other terminal in order to launch the communication node <a rel="nofollow" class="external text" href="http://www.ros.org/">ROS</a>-<a rel="nofollow" class="external text" href="http://www.arduino.cc/">arduino</a>:
</p>
<div dir="ltr" class="mw-geshi mw-content-ltr"><div class="bash source-bash" style="font-family:monospace;"><pre class="de1">rosrun rosserial_python serial_node.py <span class="sy0">/</span>dev<span class="sy0">/</span>ttyACM0</pre></div></div>
<p>We will execute the next command in a terminal in order to launch the control program:
</p>
<div dir="ltr" class="mw-geshi mw-content-ltr"><div class="bash source-bash" style="font-family:monospace;"><pre class="de1">rosrun brazo_fer control_v02</pre></div></div>
<p>We will execute the next command in a terminal in order to publish in the <i>topic</i>
 "pick_point" the bottle position (We have placed the bottle in a known 
position but we can use a vision system to set the bottle position):
</p>
<div dir="ltr" class="mw-geshi mw-content-ltr"><div class="bash source-bash" style="font-family:monospace;"><pre class="de1">rostopic pub pick_point geometry_msgs<span class="sy0">/</span>Point <span class="st_h">'{x: -150, y: 0, z: 150}'</span> <span class="re5">--once</span></pre></div></div>
<p>The arm will execute the pick sequence. We can see the arm grasping the bottle in the next video:
</p>
<center><object height="350" width="425"> <param name="movie" value="http://www.youtube.com/v/0FcB6-i23cU?fs=1"> <param name="allowFullScreen" value="true"> <param name="wmode" value="transparent"> <embed src="MYRAbot%27s%20arm%20control%20%28bioloid+arduino%29%20-%20Rob%C3%B3tica%20-%20ULE_files/0FcB6-i23cU.swf" type="application/x-shockwave-flash" wmode="transparent" allowfullscreen="true" flashvars="" height="350" width="425"></object></center>
<center><a rel="nofollow" class="external text" href="http://www.youtube.com/watch?v=0FcB6-i23cU">Watch in YouTube</a></center>
<h2><span class="mw-headline" id="Fifth_program_.28Place_the_bottle.29">Fifth program (Place the bottle)</span></h2>
<p>This program execute the sequence to place the bottle. The sequence steps are shown below:
</p>
<ol>
<li> Placement in the goal position.
</li>
<li> To open the gripper (until to free the bottle).
</li>
<li> Distance (place the gripper at 70 mm of the goal position).
</li>
<li> Return to initial position.
</li>
</ol>
<p>We will create a file named "control_v03.cpp" with the content that is shown below within the folder "src" of our package: 
</p>
<div dir="ltr" class="mw-geshi mw-content-ltr"><div class="cpp source-cpp" style="font-family:monospace;">&nbsp; <span class="co2">#include "ros/ros.h"</span><br>&nbsp; <span class="co2">#include "brazo_fer/Servos.h"</span><br>&nbsp; <span class="co2">#include "brazo_fer/WriteServos.h" &nbsp;</span><br>&nbsp; <span class="co2">#include "brazo_fer/ReadServos.h"</span><br>&nbsp; <span class="co2">#include "brazo_fer/brazo_fer.h" &nbsp; &nbsp; </span><br>&nbsp; <span class="co2">#include "std_msgs/Int16.h"</span><br>&nbsp; <span class="co2">#include "std_msgs/String.h" &nbsp; </span><br>&nbsp; <span class="co2">#include "geometry_msgs/Point.h"</span><br>&nbsp; <span class="co2">#include "math.h"</span><br>&nbsp; <br>&nbsp; geometry_msgs<span class="sy4">::</span><span class="me2">Point</span> punto_0, punto_1<span class="sy4">;</span><br>&nbsp; <br>&nbsp; <span class="kw4">int</span> cont <span class="sy1">=</span> <span class="nu0">0</span><span class="sy4">;</span><br>&nbsp; <span class="kw4">int</span> cont_1 <span class="sy1">=</span> <span class="nu0">0</span><span class="sy4">;</span><br>&nbsp; <span class="kw4">int</span> cont_2 <span class="sy1">=</span> <span class="nu0">0</span><span class="sy4">;</span><br>&nbsp; <span class="kw4">int</span> cont_3 <span class="sy1">=</span> <span class="nu0">0</span><span class="sy4">;</span><br>&nbsp; <span class="kw4">int</span> inclinacion_pinza <span class="sy1">=</span> <span class="nu0">0</span><span class="sy4">;</span><br>&nbsp; &nbsp; <br>&nbsp; brazo_fer<span class="sy4">::</span><span class="me2">Servos</span> pg, cg, pinza<span class="sy4">;</span><br>&nbsp; brazo_fer<span class="sy4">::</span><span class="me2">WriteServos</span> move<span class="sy4">;</span><br>&nbsp; brazo_fer<span class="sy4">::</span><span class="me2">WriteServos</span> pin<span class="sy4">;</span><br>&nbsp; brazo_fer<span class="sy4">::</span><span class="me2">WriteServos</span> error_coordenadas<span class="sy4">;</span> &nbsp;<br>&nbsp; <br>&nbsp; brazo_fer<span class="sy4">::</span><span class="me2">WriteServos</span> separar<span class="br0">(</span>geometry_msgs<span class="sy4">::</span><span class="me2">Point</span> lejos<span class="br0">)</span><br>&nbsp; <span class="br0">{</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw4">double</span> x <span class="sy1">=</span> lejos.<span class="me1">x</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw4">double</span> z <span class="sy1">=</span> lejos.<span class="me1">z</span><span class="sy4">;</span> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; lejos.<span class="me1">z</span> <span class="sy1">=</span> lejos.<span class="me1">z</span> <span class="sy2">-</span> 70<span class="sy2">*</span><span class="kw3">cos</span><span class="br0">(</span><span class="kw3">atan2</span><span class="br0">(</span>x,z<span class="br0">)</span><span class="br0">)</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; lejos.<span class="me1">x</span> <span class="sy1">=</span> lejos.<span class="me1">x</span> <span class="sy2">-</span> 70<span class="sy2">*</span><span class="kw3">sin</span><span class="br0">(</span><span class="kw3">atan2</span><span class="br0">(</span>x,z<span class="br0">)</span><span class="br0">)</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; brazo_fer<span class="sy4">::</span><span class="me2">WriteServos</span> move <span class="sy1">=</span> inversa<span class="br0">(</span>lejos, <span class="sy4">::</span><span class="me2">inclinacion_pinza</span>, <span class="sy4">::</span><span class="me2">pg</span>, 0<span class="br0">)</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">return</span> move<span class="sy4">;</span><br><br>&nbsp; <span class="br0">}</span><br>&nbsp; <br>&nbsp; <span class="kw4">void</span> posicion_estado_corriente<span class="br0">(</span><span class="kw4">const</span> brazo_fer<span class="sy4">::</span><span class="me2">ReadServos</span><span class="sy3">&amp;</span> pec<span class="br0">)</span> &nbsp;<br>&nbsp; <span class="br0">{</span> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; ros<span class="sy4">::</span><span class="me2">NodeHandle</span> n<span class="sy4">;</span><br>&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; ros<span class="sy4">::</span><span class="me2">Publisher</span> move_pub_<span class="sy1">=</span>n.<span class="me1">advertise</span><span class="sy1">&lt;</span>brazo_fer<span class="sy4">::</span><span class="me2">WriteServos</span><span class="sy1">&gt;</span><span class="br0">(</span><span class="st0">"move_arm"</span>, 1<span class="br0">)</span><span class="sy4">;</span> &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; ros<span class="sy4">::</span><span class="me2">Publisher</span> hand_pub_<span class="sy1">=</span>n.<span class="me1">advertise</span><span class="sy1">&lt;</span>brazo_fer<span class="sy4">::</span><span class="me2">WriteServos</span><span class="sy1">&gt;</span><span class="br0">(</span><span class="st0">"hand_arm"</span>, 1<span class="br0">)</span><span class="sy4">;</span> &nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; brazo_fer<span class="sy4">::</span><span class="me2">Servos</span> p <span class="sy1">=</span> pec.<span class="me1">posicion</span><span class="sy4">;</span> &nbsp; <br><br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="sy4">::</span><span class="me2">pg</span> <span class="sy1">=</span> pec.<span class="me1">posicion</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="sy4">::</span><span class="me2">cg</span> <span class="sy1">=</span> pec.<span class="me1">corriente</span><span class="sy4">;</span> &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; brazo_fer<span class="sy4">::</span><span class="me2">Servos</span> e <span class="sy1">=</span> pec.<span class="me1">estado</span><span class="sy4">;</span> &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; brazo_fer<span class="sy4">::</span><span class="me2">Servos</span> c <span class="sy1">=</span> pec.<span class="me1">corriente</span><span class="sy4">;</span> &nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">(</span><span class="sy4">::</span><span class="me2">cont</span> <span class="sy1">==</span> 0<span class="br0">)</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">{</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="sy4">::</span><span class="me2">punto_0</span> <span class="sy1">=</span> directa<span class="br0">(</span>p, inclinacion_pinza<span class="br0">)</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="sy4">::</span><span class="me2">punto_1</span> <span class="sy1">=</span> <span class="sy4">::</span><span class="me2">punto_0</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="sy4">::</span><span class="me2">cont</span> <span class="sy1">=</span> <span class="sy4">::</span><span class="me2">cont</span><span class="sy2">+</span><span class="nu0">1</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">}</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">(</span><span class="sy4">::</span><span class="me2">punto_0</span>.<span class="me1">x</span> <span class="sy3">!</span><span class="sy1">=</span> <span class="sy4">::</span><span class="me2">punto_1</span>.<span class="me1">x</span> <span class="sy3">||</span> <span class="sy4">::</span><span class="me2">punto_0</span>.<span class="me1">y</span> <span class="sy3">!</span><span class="sy1">=</span> <span class="sy4">::</span><span class="me2">punto_1</span>.<span class="me1">y</span> <span class="sy3">||</span> <span class="sy4">::</span><span class="me2">punto_0</span>.<span class="me1">z</span> <span class="sy3">!</span><span class="sy1">=</span> <span class="sy4">::</span><span class="me2">punto_1</span>.<span class="me1">z</span> <span class="br0">)</span> <span class="br0">{</span><br><br><br><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">(</span><span class="sy4">::</span><span class="me2">cont_1</span> <span class="sy1">==</span> 0<span class="br0">)</span> <span class="br0">{</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="sy4">::</span><span class="me2">move</span> <span class="sy1">=</span> inversa<span class="br0">(</span><span class="sy4">::</span><span class="me2">punto_0</span>, <span class="sy4">::</span><span class="me2">inclinacion_pinza</span>, <span class="sy4">::</span><span class="me2">pg</span>, 0<span class="br0">)</span><span class="sy4">;</span> &nbsp; &nbsp; &nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; move_pub_.<span class="me1">publish</span><span class="br0">(</span><span class="sy4">::</span><span class="me2">move</span><span class="br0">)</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="sy4">::</span><span class="me2">cont_1</span> <span class="sy1">=</span> <span class="sy4">::</span><span class="me2">cont_1</span><span class="sy2">+</span><span class="nu0">1</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">}</span> &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">(</span><span class="br0">(</span><span class="br0">(</span>p.<span class="me1">base</span><span class="sy2">-</span>15<span class="br0">)</span> <span class="sy1">&lt;</span> <span class="sy4">::</span><span class="me2">move</span>.<span class="me1">posicion</span>.<span class="me1">base</span> <span class="sy3">&amp;&amp;</span> <span class="sy4">::</span><span class="me2">move</span>.<span class="me1">posicion</span>.<span class="me1">base</span> <span class="sy1">&lt;</span> <span class="br0">(</span>p.<span class="me1">base</span><span class="sy2">+</span>15<span class="br0">)</span><span class="br0">)</span> <span class="sy3">&amp;&amp;</span> <span class="br0">(</span><span class="br0">(</span>p.<span class="me1">arti1</span><span class="sy2">-</span>15<span class="br0">)</span> <span class="sy1">&lt;</span> <span class="sy4">::</span><span class="me2">move</span>.<span class="me1">posicion</span>.<span class="me1">arti1</span> <span class="sy3">&amp;&amp;</span> <span class="sy4">::</span><span class="me2">move</span>.<span class="me1">posicion</span>.<span class="me1">arti1</span> <span class="sy1">&lt;</span> <span class="br0">(</span>p.<span class="me1">arti1</span><span class="sy2">+</span>15<span class="br0">)</span><span class="br0">)</span> <span class="sy3">&amp;&amp;</span> <span class="br0">(</span><span class="br0">(</span>p.<span class="me1">arti2</span><span class="sy2">-</span>15<span class="br0">)</span> <span class="sy1">&lt;</span> <span class="sy4">::</span><span class="me2">move</span>.<span class="me1">posicion</span>.<span class="me1">arti2</span> <span class="sy3">&amp;&amp;</span> <span class="sy4">::</span><span class="me2">move</span>.<span class="me1">posicion</span>.<span class="me1">arti2</span> <span class="sy1">&lt;</span> <span class="br0">(</span>p.<span class="me1">arti2</span><span class="sy2">+</span>15<span class="br0">)</span><span class="br0">)</span> <span class="sy3">&amp;&amp;</span> <span class="br0">(</span><span class="br0">(</span>p.<span class="me1">arti3</span><span class="sy2">-</span>15<span class="br0">)</span> <span class="sy1">&lt;</span> <span class="sy4">::</span><span class="me2">move</span>.<span class="me1">posicion</span>.<span class="me1">arti3</span> <span class="sy3">&amp;&amp;</span> <span class="sy4">::</span><span class="me2">move</span>.<span class="me1">posicion</span>.<span class="me1">arti3</span> <span class="sy1">&lt;</span> <span class="br0">(</span>p.<span class="me1">arti3</span><span class="sy2">+</span>15<span class="br0">)</span><span class="br0">)</span><span class="br0">)</span> <span class="br0">{</span> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">(</span><span class="sy4">::</span><span class="me2">cont_2</span> <span class="sy1">==</span> 0<span class="br0">)</span> <span class="br0">{</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="sy4">::</span><span class="me2">pinza</span>.<span class="me1">pinza</span> <span class="sy1">=</span> <span class="nu0">470</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="sy4">::</span><span class="me2">pin</span> <span class="sy1">=</span> control_pinza<span class="br0">(</span><span class="sy4">::</span><span class="me2">pinza</span>, p, c<span class="br0">)</span><span class="sy4">;</span><br>&nbsp;
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; hand_pub_.<span class="me1">publish</span><span class="br0">(</span><span class="sy4">::</span><span class="me2">pin</span><span class="br0">)</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="sy4">::</span><span class="me2">cont_2</span> <span class="sy1">=</span> <span class="sy4">::</span><span class="me2">cont_2</span><span class="sy2">+</span><span class="nu0">1</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">}</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">else</span> <span class="br0">{</span>&nbsp; &nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">(</span>p.<span class="me1">pinza</span> <span class="sy1">&lt;=</span> 495<span class="br0">)</span> <span class="br0">{</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp;
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">(</span><span class="sy4">::</span><span class="me2">cont_3</span> <span class="sy1">==</span> 0<span class="br0">)</span> <span class="br0">{</span><br>&nbsp;
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp;
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; <span class="sy4">::</span><span class="me2">move</span> <span class="sy1">=</span> separar<span class="br0">(</span><span class="sy4">::</span><span class="me2">punto_0</span><span class="br0">)</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp;
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; move_pub_.<span class="me1">publish</span><span class="br0">(</span><span class="sy4">::</span><span class="me2">move</span><span class="br0">)</span><span class="sy4">;</span><br>&nbsp;
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="sy4">::</span><span class="me2">cont_3</span> <span class="sy1">=</span> <span class="sy4">::</span><span class="me2">cont_3</span><span class="sy2">+</span><span class="nu0">1</span><span class="sy4">;</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp;
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp;
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">}</span> &nbsp; &nbsp; &nbsp; <br>&nbsp;
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp;
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">else</span> <span class="kw1">if</span> <span class="br0">(</span><span class="br0">(</span><span class="br0">(</span>p.<span class="me1">base</span><span class="sy2">-</span>15<span class="br0">)</span> <span class="sy1">&lt;</span> <span class="sy4">::</span><span class="me2">move</span>.<span class="me1">posicion</span>.<span class="me1">base</span> <span class="sy3">&amp;&amp;</span> <span class="sy4">::</span><span class="me2">move</span>.<span class="me1">posicion</span>.<span class="me1">base</span> <span class="sy1">&lt;</span> <span class="br0">(</span>p.<span class="me1">base</span><span class="sy2">+</span>15<span class="br0">)</span><span class="br0">)</span> <span class="sy3">&amp;&amp;</span> <span class="br0">(</span><span class="br0">(</span>p.<span class="me1">arti1</span><span class="sy2">-</span>15<span class="br0">)</span> <span class="sy1">&lt;</span> <span class="sy4">::</span><span class="me2">move</span>.<span class="me1">posicion</span>.<span class="me1">arti1</span> <span class="sy3">&amp;&amp;</span> <span class="sy4">::</span><span class="me2">move</span>.<span class="me1">posicion</span>.<span class="me1">arti1</span> <span class="sy1">&lt;</span> <span class="br0">(</span>p.<span class="me1">arti1</span><span class="sy2">+</span>15<span class="br0">)</span><span class="br0">)</span> <span class="sy3">&amp;&amp;</span> <span class="br0">(</span><span class="br0">(</span>p.<span class="me1">arti2</span><span class="sy2">-</span>15<span class="br0">)</span> <span class="sy1">&lt;</span> <span class="sy4">::</span><span class="me2">move</span>.<span class="me1">posicion</span>.<span class="me1">arti2</span> <span class="sy3">&amp;&amp;</span> <span class="sy4">::</span><span class="me2">move</span>.<span class="me1">posicion</span>.<span class="me1">arti2</span> <span class="sy1">&lt;</span> <span class="br0">(</span>p.<span class="me1">arti2</span><span class="sy2">+</span>15<span class="br0">)</span><span class="br0">)</span> <span class="sy3">&amp;&amp;</span> <span class="br0">(</span><span class="br0">(</span>p.<span class="me1">arti3</span><span class="sy2">-</span>15<span class="br0">)</span> <span class="sy1">&lt;</span> <span class="sy4">::</span><span class="me2">move</span>.<span class="me1">posicion</span>.<span class="me1">arti3</span> <span class="sy3">&amp;&amp;</span> <span class="sy4">::</span><span class="me2">move</span>.<span class="me1">posicion</span>.<span class="me1">arti3</span> <span class="sy1">&lt;</span> <span class="br0">(</span>p.<span class="me1">arti3</span><span class="sy2">+</span>15<span class="br0">)</span><span class="br0">)</span><span class="br0">)</span> <span class="br0">{</span><br>&nbsp;
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp;
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; std<span class="sy4">::</span><span class="kw3">cout</span><span class="sy1">&lt;&lt;</span><span class="st0">"Suelto"</span><span class="sy1">&lt;&lt;</span>std<span class="sy4">::</span><span class="me2">endl</span><span class="sy4">;</span><br>&nbsp;
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="sy4">::</span><span class="me2">cont</span> <span class="sy1">=</span> <span class="nu0">0</span><span class="sy4">;</span><br>&nbsp;
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="sy4">::</span><span class="me2">cont_1</span> <span class="sy1">=</span> <span class="nu0">0</span><span class="sy4">;</span><br>&nbsp;
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; <span class="sy4">::</span><span class="me2">cont_2</span> <span class="sy1">=</span> <span class="nu0">0</span><span class="sy4">;</span><br>&nbsp;
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; <span class="sy4">::</span><span class="me2">cont_3</span> <span class="sy1">=</span> <span class="nu0">0</span><span class="sy4">;</span><br>&nbsp;
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">}</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">}</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">}</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">}</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">else</span> <span class="br0">{</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; std<span class="sy4">::</span><span class="kw3">cout</span><span class="sy1">&lt;&lt;</span><span class="st0">"En movimiento"</span><span class="sy1">&lt;&lt;</span>std<span class="sy4">::</span><span class="me2">endl</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">}</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">}</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; <span class="br0">}</span><br>&nbsp;<br>&nbsp; <span class="kw4">void</span> punto<span class="br0">(</span><span class="kw4">const</span> geometry_msgs<span class="sy4">::</span><span class="me2">Point</span><span class="sy3">&amp;</span> point<span class="br0">)</span> &nbsp; <br>&nbsp; <span class="br0">{</span> &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="sy4">::</span><span class="me2">punto_0</span> <span class="sy1">=</span> point<span class="sy4">;</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br><br>&nbsp; <span class="br0">}</span> &nbsp;<br>&nbsp;<br>&nbsp; <span class="kw4">int</span> main<span class="br0">(</span><span class="kw4">int</span> argc, <span class="kw4">char</span> <span class="sy2">**</span>argv<span class="br0">)</span><br>&nbsp; <span class="br0">{</span><br>&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; ros<span class="sy4">::</span><span class="me2">init</span><span class="br0">(</span>argc, argv, <span class="st0">"control_entrega"</span><span class="br0">)</span><span class="sy4">;</span> &nbsp; <br>&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; ros<span class="sy4">::</span><span class="me2">NodeHandle</span> n<span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; ros<span class="sy4">::</span><span class="me2">Subscriber</span> pose_sub_<span class="sy1">=</span> n.<span class="me1">subscribe</span><span class="br0">(</span><span class="st0">"pose_arm"</span>, 1, posicion_estado_corriente<span class="br0">)</span><span class="sy4">;</span> &nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; ros<span class="sy4">::</span><span class="me2">Subscriber</span> point_sub_<span class="sy1">=</span> n.<span class="me1">subscribe</span><span class="br0">(</span><span class="st0">"place_point"</span>, 1, punto<span class="br0">)</span><span class="sy4">;</span> &nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; ros<span class="sy4">::</span><span class="me2">Publisher</span> move_pub_<span class="sy1">=</span>n.<span class="me1">advertise</span><span class="sy1">&lt;</span>brazo_fer<span class="sy4">::</span><span class="me2">WriteServos</span><span class="sy1">&gt;</span><span class="br0">(</span><span class="st0">"move_arm"</span>, 1<span class="br0">)</span><span class="sy4">;</span> &nbsp; <br><br>&nbsp; &nbsp; &nbsp; &nbsp; ros<span class="sy4">::</span><span class="me2">Publisher</span> hand_pub_<span class="sy1">=</span>n.<span class="me1">advertise</span><span class="sy1">&lt;</span>brazo_fer<span class="sy4">::</span><span class="me2">WriteServos</span><span class="sy1">&gt;</span><span class="br0">(</span><span class="st0">"hand_arm"</span>, 1<span class="br0">)</span><span class="sy4">;</span> &nbsp;<br><br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; ros<span class="sy4">::</span><span class="me2">spin</span><span class="br0">(</span><span class="br0">)</span><span class="sy4">;</span> <br>&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">return</span> <span class="nu0">0</span><span class="sy4">;</span><br>&nbsp; <span class="br0">}</span></div></div>
<p>We have to add the next line to the file "CMakeLists.txt" of our package in order to compile and create the executable file: 
</p>
<div dir="ltr" class="mw-geshi mw-content-ltr"><div class="cmake source-cmake" style="font-family:monospace;"><pre class="de1">rosbuild_add_executable<span class="sy0">(</span>contro_v03 src/control_v03.cpp<span class="sy0">)</span></pre></div></div>
<p>We will execute the next commands in a terminal in order to compile and create the executable file: 
</p>
<div dir="ltr" class="mw-geshi mw-content-ltr"><div class="bash source-bash" style="font-family:monospace;"><pre class="de1">roscd brazo_fer
<span class="kw2">make</span></pre></div></div>
<h3><span class="mw-headline" id="Running_the_program_3">Running the program</span></h3>
<p>First we will execute the next command in a terminal in order to launch the <a rel="nofollow" class="external text" href="http://www.ros.org/">ROS</a> core, if it has not launched previously.
</p>
<div dir="ltr" class="mw-geshi mw-content-ltr"><div class="bash source-bash" style="font-family:monospace;"><pre class="de1">roscore</pre></div></div>
<p>We will execute the next command in other terminal in order to launch the communication node <a rel="nofollow" class="external text" href="http://www.ros.org/">ROS</a>-<a rel="nofollow" class="external text" href="http://www.arduino.cc/">arduino</a>:
</p>
<div dir="ltr" class="mw-geshi mw-content-ltr"><div class="bash source-bash" style="font-family:monospace;"><pre class="de1">rosrun rosserial_python serial_node.py <span class="sy0">/</span>dev<span class="sy0">/</span>ttyACM0</pre></div></div>
<p>We will execute the next command in a terminal in order to launch the control program:
</p>
<div dir="ltr" class="mw-geshi mw-content-ltr"><div class="bash source-bash" style="font-family:monospace;"><pre class="de1">rosrun brazo_fer control_v03</pre></div></div>
<p>We will execute the next command in a terminal in order to publish in the <i>topic</i> "place_point" the goal position:
</p>
<div dir="ltr" class="mw-geshi mw-content-ltr"><div class="bash source-bash" style="font-family:monospace;"><pre class="de1">rostopic pub place_point geometry_msgs<span class="sy0">/</span>Point <span class="st_h">'{x: 150, y: 0, z: 150}'</span> <span class="re5">--once</span></pre></div></div>
<h2><span class="mw-headline" id="Sixth_program_.28Follow_the_straight_way.29">Sixth program (Follow the straight way)</span></h2>
<p>This program move the arm following the line between the initial 
position and the goal position. We will create a file named 
"control_v04.cpp" with the content that is shown below within the folder
 "src" of our package: 
</p>
<div dir="ltr" class="mw-geshi mw-content-ltr"><div class="cpp source-cpp" style="font-family:monospace;">&nbsp; <span class="co2">#include "ros/ros.h"</span><br>&nbsp; <span class="co2">#include "brazo_fer/Servos.h"</span><br>&nbsp; <span class="co2">#include "brazo_fer/WriteServos.h" &nbsp;</span><br>&nbsp; <span class="co2">#include "brazo_fer/ReadServos.h"</span><br>&nbsp; <span class="co2">#include "brazo_fer/brazo_fer.h" &nbsp; </span><br>&nbsp; <span class="co2">#include "geometry_msgs/Point.h"</span><br>&nbsp; <span class="co2">#include "math.h" </span><br>&nbsp;<br>&nbsp; brazo_fer<span class="sy4">::</span><span class="me2">Servos</span> &nbsp;p, e, c<span class="sy4">;</span><br>&nbsp; brazo_fer<span class="sy4">::</span><span class="me2">WriteServos</span> destino, mover<span class="sy4">;</span> &nbsp;<br>&nbsp; geometry_msgs<span class="sy4">::</span><span class="me2">Point</span> punto_0, punto_1, punto_i<span class="sy4">;</span><br>&nbsp; <span class="kw4">double</span> lambda <span class="sy1">=</span> <span class="nu0">0</span><span class="sy4">;</span><br>&nbsp; <span class="kw4">int</span> inclinacion_pinza <span class="sy1">=</span> <span class="nu0">0</span><span class="sy4">;</span><br>&nbsp; <span class="kw4">int</span> cont <span class="sy1">=</span> <span class="nu0">0</span><span class="sy4">;</span> <br>&nbsp;<br>&nbsp; <span class="kw4">void</span> posicion<span class="br0">(</span><span class="kw4">const</span> brazo_fer<span class="sy4">::</span><span class="me2">ReadServos</span><span class="sy3">&amp;</span> pose<span class="br0">)</span><br>&nbsp; <span class="br0">{</span><br>&nbsp; &nbsp; &nbsp; &nbsp; ros<span class="sy4">::</span><span class="me2">NodeHandle</span> n<span class="sy4">;</span><br>&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; ros<span class="sy4">::</span><span class="me2">Publisher</span> move_pub_<span class="sy1">=</span>n.<span class="me1">advertise</span><span class="sy1">&lt;</span>brazo_fer<span class="sy4">::</span><span class="me2">WriteServos</span><span class="sy1">&gt;</span><span class="br0">(</span><span class="st0">"move_arm"</span>, 1<span class="br0">)</span><span class="sy4">;</span> &nbsp;<br>&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="sy4">::</span><span class="me2">p</span> <span class="sy1">=</span> pose.<span class="me1">posicion</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="sy4">::</span><span class="me2">e</span> <span class="sy1">=</span> pose.<span class="me1">estado</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="sy4">::</span><span class="me2">c</span> <span class="sy1">=</span> pose.<span class="me1">corriente</span><span class="sy4">;</span><br>&nbsp; &nbsp; <br>&nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">(</span>cont <span class="sy1">==</span> 0<span class="br0">)</span><br>&nbsp; &nbsp; <span class="br0">{</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="sy4">::</span><span class="me2">punto_0</span> <span class="sy1">=</span> home<span class="br0">(</span><span class="sy4">::</span><span class="me2">p</span>, <span class="sy4">::</span><span class="me2">c</span><span class="br0">)</span><span class="sy4">;</span><br>&nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="sy4">::</span><span class="me2">punto_1</span> <span class="sy1">=</span> <span class="sy4">::</span><span class="me2">punto_0</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cont <span class="sy1">=</span> <span class="nu0">1</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">}</span><br>&nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">(</span><span class="br0">(</span><span class="sy4">::</span><span class="me2">punto_0</span>.<span class="me1">x</span> <span class="sy3">!</span><span class="sy1">=</span> <span class="sy4">::</span><span class="me2">punto_1</span>.<span class="me1">x</span> <span class="sy3">||</span> <span class="sy4">::</span><span class="me2">punto_0</span>.<span class="me1">y</span> <span class="sy3">!</span><span class="sy1">=</span> <span class="sy4">::</span><span class="me2">punto_1</span>.<span class="me1">y</span> <span class="sy3">||</span> <span class="sy4">::</span><span class="me2">punto_0</span>.<span class="me1">z</span> <span class="sy3">!</span><span class="sy1">=</span> <span class="sy4">::</span><span class="me2">punto_1</span>.<span class="me1">z</span><span class="br0">)</span> <span class="sy3">&amp;&amp;</span> <span class="br0">(</span><span class="br0">(</span><span class="sy4">::</span><span class="me2">p</span>.<span class="me1">base</span><span class="sy2">-</span>15<span class="br0">)</span> <span class="sy1">&lt;</span> <span class="sy4">::</span><span class="me2">mover</span>.<span class="me1">posicion</span>.<span class="me1">base</span> <span class="sy3">&amp;&amp;</span> <span class="sy4">::</span><span class="me2">mover</span>.<span class="me1">posicion</span>.<span class="me1">base</span> <span class="sy1">&lt;</span> <span class="br0">(</span><span class="sy4">::</span><span class="me2">p</span>.<span class="me1">base</span><span class="sy2">+</span>15<span class="br0">)</span><span class="br0">)</span> <span class="sy3">&amp;&amp;</span> <span class="br0">(</span><span class="br0">(</span><span class="sy4">::</span><span class="me2">p</span>.<span class="me1">arti1</span><span class="sy2">-</span>15<span class="br0">)</span> <span class="sy1">&lt;</span> <span class="sy4">::</span><span class="me2">mover</span>.<span class="me1">posicion</span>.<span class="me1">arti1</span> <span class="sy3">&amp;&amp;</span> <span class="sy4">::</span><span class="me2">mover</span>.<span class="me1">posicion</span>.<span class="me1">arti1</span> <span class="sy1">&lt;</span> <span class="br0">(</span><span class="sy4">::</span><span class="me2">p</span>.<span class="me1">arti1</span><span class="sy2">+</span>15<span class="br0">)</span><span class="br0">)</span> <span class="sy3">&amp;&amp;</span> <span class="br0">(</span><span class="br0">(</span><span class="sy4">::</span><span class="me2">p</span>.<span class="me1">arti2</span><span class="sy2">-</span>15<span class="br0">)</span> <span class="sy1">&lt;</span> <span class="sy4">::</span><span class="me2">mover</span>.<span class="me1">posicion</span>.<span class="me1">arti2</span> <span class="sy3">&amp;&amp;</span> <span class="sy4">::</span><span class="me2">mover</span>.<span class="me1">posicion</span>.<span class="me1">arti2</span> <span class="sy1">&lt;</span> <span class="br0">(</span><span class="sy4">::</span><span class="me2">p</span>.<span class="me1">arti2</span><span class="sy2">+</span>15<span class="br0">)</span><span class="br0">)</span> <span class="sy3">&amp;&amp;</span> <span class="br0">(</span><span class="br0">(</span><span class="sy4">::</span><span class="me2">p</span>.<span class="me1">arti3</span><span class="sy2">-</span>15<span class="br0">)</span> <span class="sy1">&lt;</span> <span class="sy4">::</span><span class="me2">mover</span>.<span class="me1">posicion</span>.<span class="me1">arti3</span> <span class="sy3">&amp;&amp;</span> <span class="sy4">::</span><span class="me2">mover</span>.<span class="me1">posicion</span>.<span class="me1">arti3</span> <span class="sy1">&lt;</span> <span class="br0">(</span><span class="sy4">::</span><span class="me2">p</span>.<span class="me1">arti3</span><span class="sy2">+</span>15<span class="br0">)</span><span class="br0">)</span><span class="br0">)</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">{</span> &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">(</span><span class="br0">(</span><span class="br0">(</span><span class="sy4">::</span><span class="me2">p</span>.<span class="me1">base</span><span class="sy2">-</span>15<span class="br0">)</span> <span class="sy1">&lt;</span> <span class="sy4">::</span><span class="me2">destino</span>.<span class="me1">posicion</span>.<span class="me1">base</span> <span class="sy3">&amp;&amp;</span> <span class="sy4">::</span><span class="me2">destino</span>.<span class="me1">posicion</span>.<span class="me1">base</span> <span class="sy1">&lt;</span> <span class="br0">(</span><span class="sy4">::</span><span class="me2">p</span>.<span class="me1">base</span><span class="sy2">+</span>15<span class="br0">)</span><span class="br0">)</span> <span class="sy3">&amp;&amp;</span> <span class="br0">(</span><span class="br0">(</span><span class="sy4">::</span><span class="me2">p</span>.<span class="me1">arti1</span><span class="sy2">-</span>15<span class="br0">)</span> <span class="sy1">&lt;</span> <span class="sy4">::</span><span class="me2">destino</span>.<span class="me1">posicion</span>.<span class="me1">arti1</span> <span class="sy3">&amp;&amp;</span> <span class="sy4">::</span><span class="me2">destino</span>.<span class="me1">posicion</span>.<span class="me1">arti1</span> <span class="sy1">&lt;</span> <span class="br0">(</span><span class="sy4">::</span><span class="me2">p</span>.<span class="me1">arti1</span><span class="sy2">+</span>15<span class="br0">)</span><span class="br0">)</span> <span class="sy3">&amp;&amp;</span> <span class="br0">(</span><span class="br0">(</span><span class="sy4">::</span><span class="me2">p</span>.<span class="me1">arti2</span><span class="sy2">-</span>15<span class="br0">)</span> <span class="sy1">&lt;</span> <span class="sy4">::</span><span class="me2">destino</span>.<span class="me1">posicion</span>.<span class="me1">arti2</span> <span class="sy3">&amp;&amp;</span> <span class="sy4">::</span><span class="me2">destino</span>.<span class="me1">posicion</span>.<span class="me1">arti2</span> <span class="sy1">&lt;</span> <span class="br0">(</span><span class="sy4">::</span><span class="me2">p</span>.<span class="me1">arti2</span><span class="sy2">+</span>15<span class="br0">)</span><span class="br0">)</span> <span class="sy3">&amp;&amp;</span> <span class="br0">(</span><span class="br0">(</span><span class="sy4">::</span><span class="me2">p</span>.<span class="me1">arti3</span><span class="sy2">-</span>15<span class="br0">)</span> <span class="sy1">&lt;</span> <span class="sy4">::</span><span class="me2">destino</span>.<span class="me1">posicion</span>.<span class="me1">arti3</span> <span class="sy3">&amp;&amp;</span> <span class="sy4">::</span><span class="me2">destino</span>.<span class="me1">posicion</span>.<span class="me1">arti3</span> <span class="sy1">&lt;</span> <span class="br0">(</span><span class="sy4">::</span><span class="me2">p</span>.<span class="me1">arti3</span><span class="sy2">+</span>15<span class="br0">)</span><span class="br0">)</span><span class="br0">)</span> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">{</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="sy4">::</span><span class="me2">punto_0</span> <span class="sy1">=</span> <span class="sy4">::</span><span class="me2">punto_1</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="sy4">::</span><span class="me2">lambda</span> <span class="sy1">=</span> <span class="nu0">0</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">}</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">else</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">{</span> &nbsp; &nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; geometry_msgs<span class="sy4">::</span><span class="me2">Point</span> u<span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="co1">//ecuación de la recta p1 = p0+lambda.u</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; u.<span class="me1">x</span> <span class="sy1">=</span> <span class="sy4">::</span><span class="me2">punto_1</span>.<span class="me1">x</span> <span class="sy2">-</span> <span class="sy4">::</span><span class="me2">punto_0</span>.<span class="me1">x</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; u.<span class="me1">y</span> <span class="sy1">=</span> <span class="sy4">::</span><span class="me2">punto_1</span>.<span class="me1">y</span> <span class="sy2">-</span> <span class="sy4">::</span><span class="me2">punto_0</span>.<span class="me1">y</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; u.<span class="me1">z</span> <span class="sy1">=</span> <span class="sy4">::</span><span class="me2">punto_1</span>.<span class="me1">z</span> <span class="sy2">-</span> <span class="sy4">::</span><span class="me2">punto_0</span>.<span class="me1">z</span><span class="sy4">;</span> &nbsp; &nbsp; &nbsp; &nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw4">double</span> paso <span class="sy1">=</span> <span class="kw3">abs</span><span class="br0">(</span><span class="kw3">sqrt</span><span class="br0">(</span><span class="kw3">pow</span><span class="br0">(</span>u.<span class="me1">x</span>,2<span class="br0">)</span><span class="sy2">+</span><span class="kw3">pow</span><span class="br0">(</span>u.<span class="me1">y</span>,2<span class="br0">)</span><span class="sy2">+</span><span class="kw3">pow</span><span class="br0">(</span>u.<span class="me1">z</span>,2<span class="br0">)</span><span class="br0">)</span><span class="sy2">/</span>10<span class="br0">)</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="sy4">::</span><span class="me2">lambda</span> <span class="sy1">=</span> <span class="sy4">::</span><span class="me2">lambda</span> <span class="sy2">+</span> 1<span class="sy2">/</span>paso<span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="sy4">::</span><span class="me2">punto_i</span>.<span class="me1">x</span> <span class="sy1">=</span> <span class="sy4">::</span><span class="me2">punto_0</span>.<span class="me1">x</span> <span class="sy2">+</span> <span class="br0">(</span><span class="sy4">::</span><span class="me2">lambda</span><span class="br0">)</span><span class="sy2">*</span>u.<span class="me1">x</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="sy4">::</span><span class="me2">punto_i</span>.<span class="me1">y</span> <span class="sy1">=</span> <span class="sy4">::</span><span class="me2">punto_0</span>.<span class="me1">y</span> <span class="sy2">+</span> <span class="br0">(</span><span class="sy4">::</span><span class="me2">lambda</span><span class="br0">)</span><span class="sy2">*</span>u.<span class="me1">y</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="sy4">::</span><span class="me2">punto_i</span>.<span class="me1">z</span> <span class="sy1">=</span> <span class="sy4">::</span><span class="me2">punto_0</span>.<span class="me1">z</span> <span class="sy2">+</span> <span class="br0">(</span><span class="sy4">::</span><span class="me2">lambda</span><span class="br0">)</span><span class="sy2">*</span>u.<span class="me1">z</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="sy4">::</span><span class="me2">mover</span> <span class="sy1">=</span> inversa<span class="br0">(</span><span class="sy4">::</span><span class="me2">punto_i</span>, <span class="sy4">::</span><span class="me2">inclinacion_pinza</span>, <span class="sy4">::</span><span class="me2">p</span>, 0<span class="br0">)</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; move_pub_.<span class="me1">publish</span><span class="br0">(</span><span class="sy4">::</span><span class="me2">mover</span><span class="br0">)</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">}</span><br><br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">}</span><br>&nbsp;<br>&nbsp; <span class="br0">}</span><br>&nbsp;<br>&nbsp; <span class="kw4">void</span> punto<span class="br0">(</span><span class="kw4">const</span> geometry_msgs<span class="sy4">::</span><span class="me2">Point</span><span class="sy3">&amp;</span> point<span class="br0">)</span><br>&nbsp; <span class="br0">{</span> &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; ros<span class="sy4">::</span><span class="me2">NodeHandle</span> n<span class="sy4">;</span><br>&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; ros<span class="sy4">::</span><span class="me2">Publisher</span> move_pub_<span class="sy1">=</span>n.<span class="me1">advertise</span><span class="sy1">&lt;</span>brazo_fer<span class="sy4">::</span><span class="me2">WriteServos</span><span class="sy1">&gt;</span><span class="br0">(</span><span class="st0">"move_arm"</span>, 1<span class="br0">)</span><span class="sy4">;</span> <br>&nbsp; &nbsp; &nbsp; &nbsp; ros<span class="sy4">::</span><span class="me2">Publisher</span> hand_pub_<span class="sy1">=</span>n.<span class="me1">advertise</span><span class="sy1">&lt;</span>brazo_fer<span class="sy4">::</span><span class="me2">WriteServos</span><span class="sy1">&gt;</span><span class="br0">(</span><span class="st0">"hand_arm"</span>, 1<span class="br0">)</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="sy4">::</span><span class="me2">lambda</span> <span class="sy1">=</span> <span class="nu0">0</span><span class="sy4">;</span> &nbsp; &nbsp;<br>&nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="sy4">::</span><span class="me2">punto_0</span> <span class="sy1">=</span> directa<span class="br0">(</span><span class="sy4">::</span><span class="me2">p</span>, <span class="sy4">::</span><span class="me2">inclinacion_pinza</span><span class="br0">)</span><span class="sy4">;</span> &nbsp;&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="sy4">::</span><span class="me2">punto_1</span> <span class="sy1">=</span> point<span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="sy4">::</span><span class="me2">destino</span> <span class="sy1">=</span> inversa<span class="br0">(</span><span class="sy4">::</span><span class="me2">punto_1</span>, <span class="sy4">::</span><span class="me2">inclinacion_pinza</span>, <span class="sy4">::</span><span class="me2">p</span>, 0<span class="br0">)</span><span class="sy4">;</span><br>&nbsp;<br>&nbsp; <span class="br0">}</span> <br>&nbsp;<br>&nbsp;<br>&nbsp; <span class="kw4">int</span> main<span class="br0">(</span><span class="kw4">int</span> argc, <span class="kw4">char</span> <span class="sy2">**</span>argv<span class="br0">)</span><br>&nbsp; <span class="br0">{</span><br>&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; ros<span class="sy4">::</span><span class="me2">init</span><span class="br0">(</span>argc, argv, <span class="st0">"control_brazo"</span><span class="br0">)</span><span class="sy4">;</span> &nbsp; <br>&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; ros<span class="sy4">::</span><span class="me2">NodeHandle</span> n<span class="sy4">;</span><br>&nbsp;<br>&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; ros<span class="sy4">::</span><span class="me2">Subscriber</span> pose_sub_<span class="sy1">=</span> n.<span class="me1">subscribe</span><span class="br0">(</span><span class="st0">"pose_arm"</span>, 1, posicion<span class="br0">)</span><span class="sy4">;</span> <br>&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; ros<span class="sy4">::</span><span class="me2">Subscriber</span> point_sub_<span class="sy1">=</span> n.<span class="me1">subscribe</span><span class="br0">(</span><span class="st0">"point"</span>, 1, punto<span class="br0">)</span><span class="sy4">;</span> <br>&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; ros<span class="sy4">::</span><span class="me2">Publisher</span> move_pub_<span class="sy1">=</span>n.<span class="me1">advertise</span><span class="sy1">&lt;</span>brazo_fer<span class="sy4">::</span><span class="me2">WriteServos</span><span class="sy1">&gt;</span><span class="br0">(</span><span class="st0">"move_arm"</span>, 1<span class="br0">)</span><span class="sy4">;</span> &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; ros<span class="sy4">::</span><span class="me2">Publisher</span> hand_pub_<span class="sy1">=</span>n.<span class="me1">advertise</span><span class="sy1">&lt;</span>brazo_fer<span class="sy4">::</span><span class="me2">WriteServos</span><span class="sy1">&gt;</span><span class="br0">(</span><span class="st0">"hand_arm"</span>, 1<span class="br0">)</span><span class="sy4">;</span> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br>&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; ros<span class="sy4">::</span><span class="me2">spin</span><span class="br0">(</span><span class="br0">)</span><span class="sy4">;</span> &nbsp;<br>&nbsp;<br>&nbsp; &nbsp; <span class="kw1">return</span> <span class="nu0">0</span><span class="sy4">;</span><br>&nbsp; <span class="br0">}</span></div></div>
<p>We have to add the next line to the file "CMakeLists.txt" of our package in order to compile and create the executable file: 
</p>
<div dir="ltr" class="mw-geshi mw-content-ltr"><div class="cmake source-cmake" style="font-family:monospace;"><pre class="de1">rosbuild_add_executable<span class="sy0">(</span>contro_v04 src/control_v04.cpp<span class="sy0">)</span></pre></div></div>
<p>We will execute the next commands in a terminal in order to compile and create the executable file: 
</p>
<div dir="ltr" class="mw-geshi mw-content-ltr"><div class="bash source-bash" style="font-family:monospace;"><pre class="de1">roscd brazo_fer
<span class="kw2">make</span></pre></div></div>
<h3><span class="mw-headline" id="Running_the_program_4">Running the program</span></h3>
<p>First we will execute the next command in a terminal in order to launch the <a rel="nofollow" class="external text" href="http://www.ros.org/">ROS</a> core, if it has not launched previously.
</p>
<div dir="ltr" class="mw-geshi mw-content-ltr"><div class="bash source-bash" style="font-family:monospace;"><pre class="de1">roscore</pre></div></div>
<p>We will execute the next command in other terminal in order to launch the communication node <a rel="nofollow" class="external text" href="http://www.ros.org/">ROS</a>-<a rel="nofollow" class="external text" href="http://www.arduino.cc/">arduino</a>:
</p>
<div dir="ltr" class="mw-geshi mw-content-ltr"><div class="bash source-bash" style="font-family:monospace;"><pre class="de1">rosrun rosserial_python serial_node.py <span class="sy0">/</span>dev<span class="sy0">/</span>ttyACM0</pre></div></div>
<p>We will execute the next command in a terminal in order to launch the control program:
</p>
<div dir="ltr" class="mw-geshi mw-content-ltr"><div class="bash source-bash" style="font-family:monospace;"><pre class="de1">rosrun brazo_fer control_v04</pre></div></div>
<p>We will execute the next command in a terminal in order to publish in the <i>topic</i> "point" the goal position:
</p>
<div dir="ltr" class="mw-geshi mw-content-ltr"><div class="bash source-bash" style="font-family:monospace;"><pre class="de1">rostopic pub point geometry_msgs<span class="sy0">/</span>Point <span class="st_h">'{x: 150, y: 100, z: 0}'</span> <span class="re5">--once</span></pre></div></div>
<h2><span class="mw-headline" id="Seventh_program_.28Teleoperator.29">Seventh program (Teleoperator)</span></h2>
<p>This program allows to control the arm using the keyboard of the 
remote PC. We will create a file named "teleoperador_teclado.cpp" with 
the content that is shown below within the folder "src" of our package: 
</p>
<div dir="ltr" class="mw-geshi mw-content-ltr"><div class="cpp source-cpp" style="font-family:monospace;">&nbsp; <span class="co2">#include "ros/ros.h"</span><br>&nbsp; <span class="co2">#include "brazo_fer/Servos.h"</span><br>&nbsp; <span class="co2">#include "brazo_fer/WriteServos.h" &nbsp;</span><br>&nbsp; <span class="co2">#include "brazo_fer/ReadServos.h"</span><br>&nbsp; <span class="co2">#include "brazo_fer/brazo_fer.h" &nbsp;</span><br>&nbsp; <span class="co2">#include "geometry_msgs/Point.h"</span><br>&nbsp; <span class="co2">#include "std_msgs/Int16.h"</span><br>&nbsp; <span class="co2">#include "std_msgs/String.h" &nbsp;</span><br>&nbsp; <span class="co2">#include &lt;signal.h&gt;</span><br>&nbsp; <span class="co2">#include &lt;termios.h&gt;</span><br>&nbsp; <span class="co2">#include &lt;stdio.h&gt; </span><br>&nbsp; <br>&nbsp; <span class="co2">#define KEYCODE_Xmas 0x43 </span><br>&nbsp; <span class="co2">#define KEYCODE_Xmenos 0x44</span><br>&nbsp; <span class="co2">#define KEYCODE_Ymas 0x41</span><br>&nbsp; <span class="co2">#define KEYCODE_Ymenos 0x42</span><br>&nbsp; <span class="co2">#define KEYCODE_Zmas 0x77</span><br>&nbsp; <span class="co2">#define KEYCODE_Zmenos 0x73</span><br>&nbsp; <span class="co2">#define KEYCODE_Pabrir 0x61</span><br>&nbsp; <span class="co2">#define KEYCODE_Pcerrar 0x64</span><br>&nbsp; <span class="co2">#define KEYCODE_PinclinarMas 0x65</span><br>&nbsp; <span class="co2">#define KEYCODE_PinclinarMenos 0x71 &nbsp;</span><br>&nbsp; <br><span class="kw4">struct</span> termios cooked, raw<span class="sy4">;</span> <br><br><span class="kw4">int</span> cont <span class="sy1">=</span> <span class="nu0">0</span><span class="sy4">;</span><br><br><span class="kw4">double</span> retardo <span class="sy1">=</span> <span class="nu16">0.11</span><span class="sy4">;</span><br><br>&nbsp; geometry_msgs<span class="sy4">::</span><span class="me2">Point</span> punto<span class="sy4">;</span><br>&nbsp; brazo_fer<span class="sy4">::</span><span class="me2">Servos</span> vel<span class="sy4">;</span><br>&nbsp; brazo_fer<span class="sy4">::</span><span class="me2">Servos</span> pinza, p, c<span class="sy4">;</span><br>&nbsp; <br>&nbsp; <span class="kw4">int</span> pinza_incli <span class="sy1">=</span> <span class="nu0">0</span><span class="sy4">;</span><br>&nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; <br><span class="kw4">void</span> posicion_estado_corriente<span class="br0">(</span><span class="kw4">const</span> brazo_fer<span class="sy4">::</span><span class="me2">ReadServos</span><span class="sy3">&amp;</span> pec<span class="br0">)</span> <br>&nbsp; <span class="br0">{</span> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="sy4">::</span><span class="me2">p</span> <span class="sy1">=</span> pec.<span class="me1">posicion</span><span class="sy4">;</span> &nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="sy4">::</span><span class="me2">c</span> <span class="sy1">=</span> pec.<span class="me1">corriente</span><span class="sy4">;</span><br><br>&nbsp; <span class="br0">}</span> &nbsp; &nbsp; &nbsp; <br>&nbsp;<br><span class="kw4">void</span> quit<span class="br0">(</span><span class="kw4">int</span> sig<span class="br0">)</span><br><span class="br0">{</span><br>&nbsp; tcsetattr<span class="br0">(</span>0, TCSANOW, <span class="sy3">&amp;</span>cooked<span class="br0">)</span><span class="sy4">;</span><br>&nbsp; ros<span class="sy4">::</span><span class="me2">shutdown</span><span class="br0">(</span><span class="br0">)</span><span class="sy4">;</span><br>&nbsp; <span class="kw3">exit</span><span class="br0">(</span>0<span class="br0">)</span><span class="sy4">;</span><br><span class="br0">}</span> <br><br><span class="kw4">void</span> callback<span class="br0">(</span><span class="kw4">const</span> ros<span class="sy4">::</span><span class="me2">TimerEvent</span><span class="sy3">&amp;</span><span class="br0">)</span><br><span class="br0">{</span><br>&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; ros<span class="sy4">::</span><span class="me2">NodeHandle</span> n<span class="sy4">;</span> &nbsp; &nbsp; &nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; ros<span class="sy4">::</span><span class="me2">Publisher</span> move_pub_<span class="sy1">=</span>n.<span class="me1">advertise</span><span class="sy1">&lt;</span>brazo_fer<span class="sy4">::</span><span class="me2">WriteServos</span><span class="sy1">&gt;</span><span class="br0">(</span><span class="st0">"move_arm"</span>, 1<span class="br0">)</span><span class="sy4">;</span> <br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; ros<span class="sy4">::</span><span class="me2">Publisher</span> hand_pub_<span class="sy1">=</span>n.<span class="me1">advertise</span><span class="sy1">&lt;</span>brazo_fer<span class="sy4">::</span><span class="me2">WriteServos</span><span class="sy1">&gt;</span><span class="br0">(</span><span class="st0">"hand_arm"</span>, 1<span class="br0">)</span><span class="sy4">;</span> &nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br><br>&nbsp; &nbsp; &nbsp; &nbsp; ros<span class="sy4">::</span><span class="me2">Time</span> anterior<span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; brazo_fer<span class="sy4">::</span><span class="me2">WriteServos</span> teleop<span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; brazo_fer<span class="sy4">::</span><span class="me2">WriteServos</span> teleop_pinza<span class="sy4">;</span>&nbsp; &nbsp; <br><br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">(</span><span class="sy4">::</span><span class="me2">cont</span> <span class="sy1">==</span> 0<span class="br0">)</span><br>&nbsp; &nbsp; <span class="br0">{</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; anterior <span class="sy1">=</span> ros<span class="sy4">::</span><span class="me2">Time</span><span class="sy4">::</span><span class="me2">now</span><span class="br0">(</span><span class="br0">)</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="sy4">::</span><span class="me2">punto</span> <span class="sy1">=</span> home<span class="br0">(</span><span class="sy4">::</span><span class="me2">p</span>, <span class="sy4">::</span><span class="me2">c</span><span class="br0">)</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="sy4">::</span><span class="me2">cont</span> <span class="sy1">=</span> <span class="nu0">1</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="sy4">::</span><span class="me2">pinza</span>.<span class="me1">pinza</span> <span class="sy1">=</span> <span class="nu0">511</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; teleop <span class="sy1">=</span> inversa<span class="br0">(</span><span class="sy4">::</span><span class="me2">punto</span>, <span class="sy4">::</span><span class="me2">pinza_incli</span>, <span class="sy4">::</span><span class="me2">p</span>, 0<span class="br0">)</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; teleop_pinza <span class="sy1">=</span> control_pinza<span class="br0">(</span><span class="sy4">::</span><span class="me2">pinza</span>, <span class="sy4">::</span><span class="me2">p</span>, <span class="sy4">::</span><span class="me2">c</span><span class="br0">)</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="co1">//std::cout&lt;&lt;teleop&lt;&lt;"-"&lt;&lt;teleop_pinza&lt;&lt;std::endl;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">}</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; <span class="kw4">char</span> c<span class="sy4">;</span><br><br>&nbsp; <span class="co1">//
 get the console in raw mode &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><br>&nbsp; tcgetattr<span class="br0">(</span>0, <span class="sy3">&amp;</span>cooked<span class="br0">)</span><span class="sy4">;</span><br>&nbsp; <span class="kw3">memcpy</span><span class="br0">(</span><span class="sy3">&amp;</span>raw, <span class="sy3">&amp;</span>cooked, <span class="kw3">sizeof</span><span class="br0">(</span><span class="kw4">struct</span> termios<span class="br0">)</span><span class="br0">)</span><span class="sy4">;</span><br>&nbsp; raw.<span class="me1">c_lflag</span> <span class="sy3">&amp;</span><span class="sy1">=</span>~ <span class="br0">(</span>ICANON <span class="sy3">|</span> ECHO<span class="br0">)</span><span class="sy4">;</span><br>&nbsp; <span class="co1">// Setting a new line, then end of file &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><br>&nbsp; raw.<span class="me1">c_cc</span><span class="br0">[</span>VEOL<span class="br0">]</span> <span class="sy1">=</span> <span class="nu0">1</span><span class="sy4">;</span><br>&nbsp; raw.<span class="me1">c_cc</span><span class="br0">[</span>VEOF<span class="br0">]</span> <span class="sy1">=</span> <span class="nu0">2</span><span class="sy4">;</span><br>&nbsp; tcsetattr<span class="br0">(</span>0, TCSANOW, <span class="sy3">&amp;</span>raw<span class="br0">)</span><span class="sy4">;</span><br><br>&nbsp; <span class="kw3">puts</span><span class="br0">(</span><span class="st0">""</span><span class="br0">)</span><span class="sy4">;</span> <br>&nbsp; <span class="kw3">puts</span><span class="br0">(</span><span class="st0">"#####################################################"</span><span class="br0">)</span><span class="sy4">;</span><br>&nbsp; <span class="kw3">puts</span><span class="br0">(</span><span class="st0">" &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ARM CONTROLS"</span><span class="br0">)</span><span class="sy4">;</span><br>&nbsp; <span class="kw3">puts</span><span class="br0">(</span><span class="st0">"#####################################################"</span><span class="br0">)</span><span class="sy4">;</span><br>&nbsp; <span class="kw3">puts</span><span class="br0">(</span><span class="st0">""</span><span class="br0">)</span><span class="sy4">;</span> &nbsp;<br>&nbsp; <span class="kw3">puts</span><span class="br0">(</span><span class="st0">"Up arrow:___________ Move up gripper"</span><span class="br0">)</span><span class="sy4">;</span><br>&nbsp; <span class="kw3">puts</span><span class="br0">(</span><span class="st0">"Down arrow:_________ Move down gripper"</span><span class="br0">)</span><span class="sy4">;</span><br>&nbsp; <span class="kw3">puts</span><span class="br0">(</span><span class="st0">"Left arrow:_________ Move left gripper"</span><span class="br0">)</span><span class="sy4">;</span> <br>&nbsp; <span class="kw3">puts</span><span class="br0">(</span><span class="st0">"Right arrow:________ Move right gripper"</span><span class="br0">)</span><span class="sy4">;</span><br>&nbsp; <span class="kw3">puts</span><span class="br0">(</span><span class="st0">"W key:______________ Move forward gripper"</span><span class="br0">)</span><span class="sy4">;</span><br>&nbsp; <span class="kw3">puts</span><span class="br0">(</span><span class="st0">"S key:______________ Move backward gripper"</span><span class="br0">)</span><span class="sy4">;</span><br>&nbsp; <span class="kw3">puts</span><span class="br0">(</span><span class="st0">"A key:______________ Open gripper"</span><span class="br0">)</span><span class="sy4">;</span><br>&nbsp; <span class="kw3">puts</span><span class="br0">(</span><span class="st0">"D key:______________ Close gripper"</span><span class="br0">)</span><span class="sy4">;</span><br>&nbsp; <span class="kw3">puts</span><span class="br0">(</span><span class="st0">"Q key:______________ Tilt up gripper"</span><span class="br0">)</span><span class="sy4">;</span><br>&nbsp; <span class="kw3">puts</span><span class="br0">(</span><span class="st0">"E key:______________ Tilt down gripper"</span><span class="br0">)</span><span class="sy4">;</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br><br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; <span class="kw1">while</span> <span class="br0">(</span>ros<span class="sy4">::</span><span class="me2">ok</span><span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><br>&nbsp; &nbsp; <span class="br0">{</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; <span class="co1">// get the next event from the keyboard &nbsp;</span><br>&nbsp; &nbsp; <span class="kw1">if</span><span class="br0">(</span>read<span class="br0">(</span>0, <span class="sy3">&amp;</span>c, 1<span class="br0">)</span> <span class="sy1">&lt;</span> 0<span class="br0">)</span><br>&nbsp; &nbsp; <span class="br0">{</span><br>&nbsp; &nbsp; &nbsp; <span class="kw3">perror</span><span class="br0">(</span><span class="st0">"read():"</span><span class="br0">)</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; <span class="kw3">exit</span><span class="br0">(</span><span class="sy2">-</span>1<span class="br0">)</span><span class="sy4">;</span><br>&nbsp; &nbsp; <span class="br0">}</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">(</span>c <span class="sy1">==</span> KEYCODE_Xmas<span class="br0">)</span><br>&nbsp; &nbsp; &nbsp; <span class="br0">{</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">(</span>ros<span class="sy4">::</span><span class="me2">Time</span><span class="sy4">::</span><span class="me2">now</span><span class="br0">(</span><span class="br0">)</span> <span class="sy1">&gt;</span> anterior <span class="sy2">+</span> ros<span class="sy4">::</span><span class="me2">Duration</span><span class="br0">(</span><span class="sy4">::</span><span class="me2">retardo</span><span class="br0">)</span><span class="br0">)</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">{</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="sy4">::</span><span class="me2">punto</span>.<span class="me1">x</span> <span class="sy1">=</span> <span class="sy4">::</span><span class="me2">punto</span>.<span class="me1">x</span> <span class="sy2">-</span> <span class="nu0">5</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; teleop <span class="sy1">=</span> inversa<span class="br0">(</span><span class="sy4">::</span><span class="me2">punto</span>, <span class="sy4">::</span><span class="me2">pinza_incli</span>, <span class="sy4">::</span><span class="me2">p</span>, 0<span class="br0">)</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">(</span>teleop.<span class="me1">posicion</span>.<span class="me1">base</span> <span class="sy1">==</span> <span class="sy4">::</span><span class="me2">p</span>.<span class="me1">base</span> <span class="sy3">&amp;&amp;</span> teleop.<span class="me1">posicion</span>.<span class="me1">arti1</span> <span class="sy1">==</span> <span class="sy4">::</span><span class="me2">p</span>.<span class="me1">arti1</span> <span class="sy3">&amp;&amp;</span> teleop.<span class="me1">posicion</span>.<span class="me1">arti2</span> <span class="sy1">==</span> <span class="sy4">::</span><span class="me2">p</span>.<span class="me1">arti2</span> <span class="sy3">&amp;&amp;</span> teleop.<span class="me1">posicion</span>.<span class="me1">arti3</span> <span class="sy1">==</span> <span class="sy4">::</span><span class="me2">p</span>.<span class="me1">arti3</span><span class="br0">)</span> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">{</span><span class="sy4">::</span><span class="me2">punto</span>.<span class="me1">x</span> <span class="sy1">=</span> <span class="sy4">::</span><span class="me2">punto</span>.<span class="me1">x</span> <span class="sy2">+</span> <span class="nu0">5</span><span class="sy4">;</span><span class="br0">}</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; anterior <span class="sy1">=</span> ros<span class="sy4">::</span><span class="me2">Time</span><span class="sy4">::</span><span class="me2">now</span><span class="br0">(</span><span class="br0">)</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">}</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; <span class="br0">}</span><br>&nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">(</span>c <span class="sy1">==</span> KEYCODE_Xmenos<span class="br0">)</span><br>&nbsp; &nbsp; &nbsp; <span class="br0">{</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">(</span>ros<span class="sy4">::</span><span class="me2">Time</span><span class="sy4">::</span><span class="me2">now</span><span class="br0">(</span><span class="br0">)</span> <span class="sy1">&gt;</span> anterior <span class="sy2">+</span> ros<span class="sy4">::</span><span class="me2">Duration</span><span class="br0">(</span><span class="sy4">::</span><span class="me2">retardo</span><span class="br0">)</span><span class="br0">)</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">{</span> &nbsp; &nbsp; &nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="sy4">::</span><span class="me2">punto</span>.<span class="me1">x</span> <span class="sy1">=</span> <span class="sy4">::</span><span class="me2">punto</span>.<span class="me1">x</span> <span class="sy2">+</span> <span class="nu0">5</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; teleop <span class="sy1">=</span> inversa<span class="br0">(</span><span class="sy4">::</span><span class="me2">punto</span>, <span class="sy4">::</span><span class="me2">pinza_incli</span>, <span class="sy4">::</span><span class="me2">p</span>, 0<span class="br0">)</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">(</span>teleop.<span class="me1">posicion</span>.<span class="me1">base</span> <span class="sy1">==</span> <span class="sy4">::</span><span class="me2">p</span>.<span class="me1">base</span> <span class="sy3">&amp;&amp;</span> teleop.<span class="me1">posicion</span>.<span class="me1">arti1</span> <span class="sy1">==</span> <span class="sy4">::</span><span class="me2">p</span>.<span class="me1">arti1</span> <span class="sy3">&amp;&amp;</span> teleop.<span class="me1">posicion</span>.<span class="me1">arti2</span> <span class="sy1">==</span> <span class="sy4">::</span><span class="me2">p</span>.<span class="me1">arti2</span> <span class="sy3">&amp;&amp;</span> teleop.<span class="me1">posicion</span>.<span class="me1">arti3</span> <span class="sy1">==</span> <span class="sy4">::</span><span class="me2">p</span>.<span class="me1">arti3</span><span class="br0">)</span> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">{</span><span class="sy4">::</span><span class="me2">punto</span>.<span class="me1">x</span> <span class="sy1">=</span> <span class="sy4">::</span><span class="me2">punto</span>.<span class="me1">x</span> <span class="sy2">-</span> <span class="nu0">5</span><span class="sy4">;</span><span class="br0">}</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; anterior <span class="sy1">=</span> ros<span class="sy4">::</span><span class="me2">Time</span><span class="sy4">::</span><span class="me2">now</span><span class="br0">(</span><span class="br0">)</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">}</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; <span class="br0">}</span><br>&nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">(</span>c <span class="sy1">==</span> KEYCODE_Ymas<span class="br0">)</span><br>&nbsp; &nbsp; &nbsp; <span class="br0">{</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">(</span>ros<span class="sy4">::</span><span class="me2">Time</span><span class="sy4">::</span><span class="me2">now</span><span class="br0">(</span><span class="br0">)</span> <span class="sy1">&gt;</span> anterior <span class="sy2">+</span> ros<span class="sy4">::</span><span class="me2">Duration</span><span class="br0">(</span><span class="sy4">::</span><span class="me2">retardo</span><span class="br0">)</span><span class="br0">)</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">{</span> &nbsp; &nbsp; &nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="sy4">::</span><span class="me2">punto</span>.<span class="me1">y</span> <span class="sy1">=</span> <span class="sy4">::</span><span class="me2">punto</span>.<span class="me1">y</span> <span class="sy2">+</span> <span class="nu0">5</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; teleop <span class="sy1">=</span> inversa<span class="br0">(</span><span class="sy4">::</span><span class="me2">punto</span>, <span class="sy4">::</span><span class="me2">pinza_incli</span>, <span class="sy4">::</span><span class="me2">p</span>, 0<span class="br0">)</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">(</span>teleop.<span class="me1">posicion</span>.<span class="me1">base</span> <span class="sy1">==</span> <span class="sy4">::</span><span class="me2">p</span>.<span class="me1">base</span> <span class="sy3">&amp;&amp;</span> teleop.<span class="me1">posicion</span>.<span class="me1">arti1</span> <span class="sy1">==</span> <span class="sy4">::</span><span class="me2">p</span>.<span class="me1">arti1</span> <span class="sy3">&amp;&amp;</span> teleop.<span class="me1">posicion</span>.<span class="me1">arti2</span> <span class="sy1">==</span> <span class="sy4">::</span><span class="me2">p</span>.<span class="me1">arti2</span> <span class="sy3">&amp;&amp;</span> teleop.<span class="me1">posicion</span>.<span class="me1">arti3</span> <span class="sy1">==</span> <span class="sy4">::</span><span class="me2">p</span>.<span class="me1">arti3</span><span class="br0">)</span> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">{</span><span class="sy4">::</span><span class="me2">punto</span>.<span class="me1">y</span> <span class="sy1">=</span> <span class="sy4">::</span><span class="me2">punto</span>.<span class="me1">y</span> <span class="sy2">-</span> <span class="nu0">5</span><span class="sy4">;</span><span class="br0">}</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; anterior <span class="sy1">=</span> ros<span class="sy4">::</span><span class="me2">Time</span><span class="sy4">::</span><span class="me2">now</span><span class="br0">(</span><span class="br0">)</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">}</span>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; <br>&nbsp; &nbsp; &nbsp; <span class="br0">}</span><br>&nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">(</span>c <span class="sy1">==</span> KEYCODE_Ymenos<span class="br0">)</span><br>&nbsp; &nbsp; &nbsp; <span class="br0">{</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">(</span>ros<span class="sy4">::</span><span class="me2">Time</span><span class="sy4">::</span><span class="me2">now</span><span class="br0">(</span><span class="br0">)</span> <span class="sy1">&gt;</span> anterior <span class="sy2">+</span> ros<span class="sy4">::</span><span class="me2">Duration</span><span class="br0">(</span><span class="sy4">::</span><span class="me2">retardo</span><span class="br0">)</span><span class="br0">)</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">{</span> &nbsp; &nbsp; &nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="sy4">::</span><span class="me2">punto</span>.<span class="me1">y</span> <span class="sy1">=</span> <span class="sy4">::</span><span class="me2">punto</span>.<span class="me1">y</span> <span class="sy2">-</span> <span class="nu0">5</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; teleop <span class="sy1">=</span> inversa<span class="br0">(</span><span class="sy4">::</span><span class="me2">punto</span>, <span class="sy4">::</span><span class="me2">pinza_incli</span>, <span class="sy4">::</span><span class="me2">p</span>, 0<span class="br0">)</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">(</span>teleop.<span class="me1">posicion</span>.<span class="me1">base</span> <span class="sy1">==</span> <span class="sy4">::</span><span class="me2">p</span>.<span class="me1">base</span> <span class="sy3">&amp;&amp;</span> teleop.<span class="me1">posicion</span>.<span class="me1">arti1</span> <span class="sy1">==</span> <span class="sy4">::</span><span class="me2">p</span>.<span class="me1">arti1</span> <span class="sy3">&amp;&amp;</span> teleop.<span class="me1">posicion</span>.<span class="me1">arti2</span> <span class="sy1">==</span> <span class="sy4">::</span><span class="me2">p</span>.<span class="me1">arti2</span> <span class="sy3">&amp;&amp;</span> teleop.<span class="me1">posicion</span>.<span class="me1">arti3</span> <span class="sy1">==</span> <span class="sy4">::</span><span class="me2">p</span>.<span class="me1">arti3</span><span class="br0">)</span> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">{</span><span class="sy4">::</span><span class="me2">punto</span>.<span class="me1">y</span> <span class="sy1">=</span> <span class="sy4">::</span><span class="me2">punto</span>.<span class="me1">y</span> <span class="sy2">+</span> <span class="nu0">5</span><span class="sy4">;</span><span class="br0">}</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; anterior <span class="sy1">=</span> ros<span class="sy4">::</span><span class="me2">Time</span><span class="sy4">::</span><span class="me2">now</span><span class="br0">(</span><span class="br0">)</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">}</span>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; <span class="br0">}</span><br>&nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">(</span>c <span class="sy1">==</span> KEYCODE_Zmas<span class="br0">)</span><br>&nbsp; &nbsp; &nbsp; <span class="br0">{</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">(</span>ros<span class="sy4">::</span><span class="me2">Time</span><span class="sy4">::</span><span class="me2">now</span><span class="br0">(</span><span class="br0">)</span> <span class="sy1">&gt;</span> anterior <span class="sy2">+</span> ros<span class="sy4">::</span><span class="me2">Duration</span><span class="br0">(</span><span class="sy4">::</span><span class="me2">retardo</span><span class="br0">)</span><span class="br0">)</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">{</span> &nbsp; &nbsp; &nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="sy4">::</span><span class="me2">punto</span>.<span class="me1">z</span> <span class="sy1">=</span> <span class="sy4">::</span><span class="me2">punto</span>.<span class="me1">z</span> <span class="sy2">+</span> <span class="nu0">5</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; teleop <span class="sy1">=</span> inversa<span class="br0">(</span><span class="sy4">::</span><span class="me2">punto</span>, <span class="sy4">::</span><span class="me2">pinza_incli</span>, <span class="sy4">::</span><span class="me2">p</span>, 0<span class="br0">)</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">(</span>teleop.<span class="me1">posicion</span>.<span class="me1">base</span> <span class="sy1">==</span> <span class="sy4">::</span><span class="me2">p</span>.<span class="me1">base</span> <span class="sy3">&amp;&amp;</span> teleop.<span class="me1">posicion</span>.<span class="me1">arti1</span> <span class="sy1">==</span> <span class="sy4">::</span><span class="me2">p</span>.<span class="me1">arti1</span> <span class="sy3">&amp;&amp;</span> teleop.<span class="me1">posicion</span>.<span class="me1">arti2</span> <span class="sy1">==</span> <span class="sy4">::</span><span class="me2">p</span>.<span class="me1">arti2</span> <span class="sy3">&amp;&amp;</span> teleop.<span class="me1">posicion</span>.<span class="me1">arti3</span> <span class="sy1">==</span> <span class="sy4">::</span><span class="me2">p</span>.<span class="me1">arti3</span><span class="br0">)</span> &nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">{</span><span class="sy4">::</span><span class="me2">punto</span>.<span class="me1">z</span> <span class="sy1">=</span> <span class="sy4">::</span><span class="me2">punto</span>.<span class="me1">z</span> <span class="sy2">-</span> <span class="nu0">5</span><span class="sy4">;</span><span class="br0">}</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; anterior <span class="sy1">=</span> ros<span class="sy4">::</span><span class="me2">Time</span><span class="sy4">::</span><span class="me2">now</span><span class="br0">(</span><span class="br0">)</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">}</span>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; <span class="br0">}</span><br>&nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">(</span>c <span class="sy1">==</span> KEYCODE_Zmenos<span class="br0">)</span><br>&nbsp; &nbsp; &nbsp; <span class="br0">{</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">(</span>ros<span class="sy4">::</span><span class="me2">Time</span><span class="sy4">::</span><span class="me2">now</span><span class="br0">(</span><span class="br0">)</span> <span class="sy1">&gt;</span> anterior <span class="sy2">+</span> ros<span class="sy4">::</span><span class="me2">Duration</span><span class="br0">(</span><span class="sy4">::</span><span class="me2">retardo</span><span class="br0">)</span><span class="br0">)</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">{</span> &nbsp; &nbsp; &nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="sy4">::</span><span class="me2">punto</span>.<span class="me1">z</span> <span class="sy1">=</span> <span class="sy4">::</span><span class="me2">punto</span>.<span class="me1">z</span> <span class="sy2">-</span> <span class="nu0">5</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; teleop <span class="sy1">=</span> inversa<span class="br0">(</span><span class="sy4">::</span><span class="me2">punto</span>, <span class="sy4">::</span><span class="me2">pinza_incli</span>, <span class="sy4">::</span><span class="me2">p</span>, 0<span class="br0">)</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">(</span>teleop.<span class="me1">posicion</span>.<span class="me1">base</span> <span class="sy1">==</span> <span class="sy4">::</span><span class="me2">p</span>.<span class="me1">base</span> <span class="sy3">&amp;&amp;</span> teleop.<span class="me1">posicion</span>.<span class="me1">arti1</span> <span class="sy1">==</span> <span class="sy4">::</span><span class="me2">p</span>.<span class="me1">arti1</span> <span class="sy3">&amp;&amp;</span> teleop.<span class="me1">posicion</span>.<span class="me1">arti2</span> <span class="sy1">==</span> <span class="sy4">::</span><span class="me2">p</span>.<span class="me1">arti2</span> <span class="sy3">&amp;&amp;</span> teleop.<span class="me1">posicion</span>.<span class="me1">arti3</span> <span class="sy1">==</span> <span class="sy4">::</span><span class="me2">p</span>.<span class="me1">arti3</span><span class="br0">)</span> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">{</span><span class="sy4">::</span><span class="me2">punto</span>.<span class="me1">z</span> <span class="sy1">=</span> <span class="sy4">::</span><span class="me2">punto</span>.<span class="me1">z</span> <span class="sy2">+</span> <span class="nu0">5</span><span class="sy4">;</span><span class="br0">}</span>&nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; anterior <span class="sy1">=</span> ros<span class="sy4">::</span><span class="me2">Time</span><span class="sy4">::</span><span class="me2">now</span><span class="br0">(</span><span class="br0">)</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">}</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; <span class="br0">}</span><br>&nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">(</span>c <span class="sy1">==</span> KEYCODE_Pabrir<span class="br0">)</span><br>&nbsp; &nbsp; &nbsp; <span class="br0">{</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">(</span>ros<span class="sy4">::</span><span class="me2">Time</span><span class="sy4">::</span><span class="me2">now</span><span class="br0">(</span><span class="br0">)</span> <span class="sy1">&gt;</span> anterior <span class="sy2">+</span> ros<span class="sy4">::</span><span class="me2">Duration</span><span class="br0">(</span><span class="sy4">::</span><span class="me2">retardo</span><span class="br0">)</span><span class="br0">)</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">{</span> &nbsp; &nbsp; &nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="sy4">::</span><span class="me2">pinza</span>.<span class="me1">pinza</span> <span class="sy1">=</span> <span class="sy4">::</span><span class="me2">pinza</span>.<span class="me1">pinza</span> <span class="sy2">-</span> <span class="nu0">5</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; teleop_pinza <span class="sy1">=</span> control_pinza<span class="br0">(</span><span class="sy4">::</span><span class="me2">pinza</span>, <span class="sy4">::</span><span class="me2">p</span>, <span class="sy4">::</span><span class="me2">c</span><span class="br0">)</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">(</span>teleop_pinza.<span class="me1">posicion</span>.<span class="me1">pinza</span> <span class="sy1">==</span> <span class="sy4">::</span><span class="me2">p</span>.<span class="me1">pinza</span><span class="br0">)</span> <span class="br0">{</span><span class="sy4">::</span><span class="me2">pinza</span>.<span class="me1">pinza</span> <span class="sy1">=</span> <span class="sy4">::</span><span class="me2">pinza</span>.<span class="me1">pinza</span> <span class="sy2">+</span> <span class="nu0">5</span><span class="sy4">;</span><span class="br0">}</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; anterior <span class="sy1">=</span> ros<span class="sy4">::</span><span class="me2">Time</span><span class="sy4">::</span><span class="me2">now</span><span class="br0">(</span><span class="br0">)</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">}</span><br>&nbsp; &nbsp; &nbsp; <span class="br0">}</span><br>&nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">(</span>c <span class="sy1">==</span> KEYCODE_Pcerrar<span class="br0">)</span><br>&nbsp; &nbsp; &nbsp; <span class="br0">{</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">(</span>ros<span class="sy4">::</span><span class="me2">Time</span><span class="sy4">::</span><span class="me2">now</span><span class="br0">(</span><span class="br0">)</span> <span class="sy1">&gt;</span> anterior <span class="sy2">+</span> ros<span class="sy4">::</span><span class="me2">Duration</span><span class="br0">(</span><span class="sy4">::</span><span class="me2">retardo</span><span class="br0">)</span><span class="br0">)</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">{</span> &nbsp; &nbsp; &nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="sy4">::</span><span class="me2">pinza</span>.<span class="me1">pinza</span> <span class="sy1">=</span> <span class="sy4">::</span><span class="me2">pinza</span>.<span class="me1">pinza</span> <span class="sy2">+</span> <span class="nu0">5</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; teleop_pinza <span class="sy1">=</span> control_pinza<span class="br0">(</span><span class="sy4">::</span><span class="me2">pinza</span>, <span class="sy4">::</span><span class="me2">p</span>, <span class="sy4">::</span><span class="me2">c</span><span class="br0">)</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">(</span>teleop_pinza.<span class="me1">posicion</span>.<span class="me1">pinza</span> <span class="sy1">==</span> <span class="sy4">::</span><span class="me2">p</span>.<span class="me1">pinza</span><span class="br0">)</span> <span class="br0">{</span><span class="sy4">::</span><span class="me2">pinza</span>.<span class="me1">pinza</span> <span class="sy1">=</span> <span class="sy4">::</span><span class="me2">pinza</span>.<span class="me1">pinza</span> <span class="sy2">-</span> <span class="nu0">5</span><span class="sy4">;</span><span class="br0">}</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; anterior <span class="sy1">=</span> ros<span class="sy4">::</span><span class="me2">Time</span><span class="sy4">::</span><span class="me2">now</span><span class="br0">(</span><span class="br0">)</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">}</span><br>&nbsp; &nbsp; &nbsp; <span class="br0">}</span><br>&nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">(</span>c <span class="sy1">==</span> KEYCODE_PinclinarMas<span class="br0">)</span><br>&nbsp; &nbsp; &nbsp; <span class="br0">{</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">(</span>ros<span class="sy4">::</span><span class="me2">Time</span><span class="sy4">::</span><span class="me2">now</span><span class="br0">(</span><span class="br0">)</span> <span class="sy1">&gt;</span> anterior <span class="sy2">+</span> ros<span class="sy4">::</span><span class="me2">Duration</span><span class="br0">(</span><span class="sy4">::</span><span class="me2">retardo</span><span class="br0">)</span><span class="br0">)</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">{</span> &nbsp; &nbsp; &nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="sy4">::</span><span class="me2">pinza_incli</span> <span class="sy1">=</span> <span class="sy4">::</span><span class="me2">pinza_incli</span> <span class="sy2">+</span> <span class="nu0">5</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; teleop <span class="sy1">=</span> inversa<span class="br0">(</span><span class="sy4">::</span><span class="me2">punto</span>, <span class="sy4">::</span><span class="me2">pinza_incli</span>, <span class="sy4">::</span><span class="me2">p</span>, 0<span class="br0">)</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">(</span>teleop.<span class="me1">posicion</span>.<span class="me1">base</span> <span class="sy1">==</span> <span class="sy4">::</span><span class="me2">p</span>.<span class="me1">base</span> <span class="sy3">&amp;&amp;</span> teleop.<span class="me1">posicion</span>.<span class="me1">arti1</span> <span class="sy1">==</span> <span class="sy4">::</span><span class="me2">p</span>.<span class="me1">arti1</span> <span class="sy3">&amp;&amp;</span> teleop.<span class="me1">posicion</span>.<span class="me1">arti2</span> <span class="sy1">==</span> <span class="sy4">::</span><span class="me2">p</span>.<span class="me1">arti2</span> <span class="sy3">&amp;&amp;</span> teleop.<span class="me1">posicion</span>.<span class="me1">arti3</span> <span class="sy1">==</span> <span class="sy4">::</span><span class="me2">p</span>.<span class="me1">arti3</span><span class="br0">)</span> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">{</span><span class="sy4">::</span><span class="me2">pinza_incli</span> <span class="sy1">=</span> <span class="sy4">::</span><span class="me2">pinza_incli</span> <span class="sy2">-</span> <span class="nu0">5</span><span class="sy4">;</span><span class="br0">}</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; anterior <span class="sy1">=</span> ros<span class="sy4">::</span><span class="me2">Time</span><span class="sy4">::</span><span class="me2">now</span><span class="br0">(</span><span class="br0">)</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">}</span><br>&nbsp; &nbsp; &nbsp; <span class="br0">}</span><br>&nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">(</span>c <span class="sy1">==</span> KEYCODE_PinclinarMenos<span class="br0">)</span><br>&nbsp; &nbsp; &nbsp; <span class="br0">{</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">(</span>ros<span class="sy4">::</span><span class="me2">Time</span><span class="sy4">::</span><span class="me2">now</span><span class="br0">(</span><span class="br0">)</span> <span class="sy1">&gt;</span> anterior <span class="sy2">+</span> ros<span class="sy4">::</span><span class="me2">Duration</span><span class="br0">(</span><span class="sy4">::</span><span class="me2">retardo</span><span class="br0">)</span><span class="br0">)</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">{</span> &nbsp; &nbsp; &nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="sy4">::</span><span class="me2">pinza_incli</span> <span class="sy1">=</span> <span class="sy4">::</span><span class="me2">pinza_incli</span> <span class="sy2">-</span> <span class="nu0">5</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; teleop <span class="sy1">=</span> inversa<span class="br0">(</span><span class="sy4">::</span><span class="me2">punto</span>, <span class="sy4">::</span><span class="me2">pinza_incli</span>, <span class="sy4">::</span><span class="me2">p</span>, 0<span class="br0">)</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">(</span>teleop.<span class="me1">posicion</span>.<span class="me1">base</span> <span class="sy1">==</span> <span class="sy4">::</span><span class="me2">p</span>.<span class="me1">base</span> <span class="sy3">&amp;&amp;</span> teleop.<span class="me1">posicion</span>.<span class="me1">arti1</span> <span class="sy1">==</span> <span class="sy4">::</span><span class="me2">p</span>.<span class="me1">arti1</span> <span class="sy3">&amp;&amp;</span> teleop.<span class="me1">posicion</span>.<span class="me1">arti2</span> <span class="sy1">==</span> <span class="sy4">::</span><span class="me2">p</span>.<span class="me1">arti2</span> <span class="sy3">&amp;&amp;</span> teleop.<span class="me1">posicion</span>.<span class="me1">arti3</span> <span class="sy1">==</span> <span class="sy4">::</span><span class="me2">p</span>.<span class="me1">arti3</span><span class="br0">)</span> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">{</span><span class="sy4">::</span><span class="me2">pinza_incli</span> <span class="sy1">=</span> <span class="sy4">::</span><span class="me2">pinza_incli</span> <span class="sy2">+</span> <span class="nu0">5</span><span class="sy4">;</span><span class="br0">}</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; anterior <span class="sy1">=</span> ros<span class="sy4">::</span><span class="me2">Time</span><span class="sy4">::</span><span class="me2">now</span><span class="br0">(</span><span class="br0">)</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">}</span><br>&nbsp; &nbsp; &nbsp; <span class="br0">}</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">(</span>teleop.<span class="me1">posicion</span>.<span class="me1">base</span> <span class="sy3">!</span><span class="sy1">=</span> <span class="sy4">::</span><span class="me2">p</span>.<span class="me1">base</span> <span class="sy3">||</span> teleop.<span class="me1">posicion</span>.<span class="me1">arti1</span> <span class="sy3">!</span><span class="sy1">=</span> <span class="sy4">::</span><span class="me2">p</span>.<span class="me1">arti1</span> <span class="sy3">||</span> teleop.<span class="me1">posicion</span>.<span class="me1">arti2</span> <span class="sy3">!</span><span class="sy1">=</span> <span class="sy4">::</span><span class="me2">p</span>.<span class="me1">arti2</span> <span class="sy3">||</span> teleop.<span class="me1">posicion</span>.<span class="me1">arti3</span> <span class="sy3">!</span><span class="sy1">=</span> <span class="sy4">::</span><span class="me2">p</span>.<span class="me1">arti3</span><span class="br0">)</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">{</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; move_pub_.<span class="me1">publish</span><span class="br0">(</span>teleop<span class="br0">)</span><span class="sy4">;</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">}</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">if</span> <span class="br0">(</span>teleop_pinza.<span class="me1">posicion</span>.<span class="me1">pinza</span> <span class="sy3">!</span><span class="sy1">=</span> <span class="sy4">::</span><span class="me2">p</span>.<span class="me1">pinza</span><span class="br0">)</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">{</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; hand_pub_.<span class="me1">publish</span><span class="br0">(</span>teleop_pinza<span class="br0">)</span><span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">}</span>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br><br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="br0">}</span> &nbsp; &nbsp; &nbsp; <br><span class="br0">}</span><br>&nbsp;<br>&nbsp; <span class="kw4">int</span> main<span class="br0">(</span><span class="kw4">int</span> argc, <span class="kw4">char</span> <span class="sy2">**</span>argv<span class="br0">)</span><br>&nbsp; <span class="br0">{</span><br>&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; ros<span class="sy4">::</span><span class="me2">init</span><span class="br0">(</span>argc, argv, <span class="st0">"teleoperador_teclado"</span><span class="br0">)</span><span class="sy4">;</span> &nbsp; <br>&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; ros<span class="sy4">::</span><span class="me2">NodeHandle</span> n<span class="sy4">;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; ros<span class="sy4">::</span><span class="me2">Subscriber</span> pose_sub_<span class="sy1">=</span> n.<span class="me1">subscribe</span><span class="br0">(</span><span class="st0">"pose_arm"</span>, 1, posicion_estado_corriente<span class="br0">)</span><span class="sy4">;</span> &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; ros<span class="sy4">::</span><span class="me2">Publisher</span> move_pub_<span class="sy1">=</span>n.<span class="me1">advertise</span><span class="sy1">&lt;</span>brazo_fer<span class="sy4">::</span><span class="me2">WriteServos</span><span class="sy1">&gt;</span><span class="br0">(</span><span class="st0">"move_arm"</span>, 1<span class="br0">)</span><span class="sy4">;</span> &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; ros<span class="sy4">::</span><span class="me2">Publisher</span> hand_pub_<span class="sy1">=</span>n.<span class="me1">advertise</span><span class="sy1">&lt;</span>brazo_fer<span class="sy4">::</span><span class="me2">WriteServos</span><span class="sy1">&gt;</span><span class="br0">(</span><span class="st0">"hand_arm"</span>, 1<span class="br0">)</span><span class="sy4">;</span> &nbsp; &nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br><br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw4">signal</span><span class="br0">(</span><span class="kw2">SIGINT</span>,quit<span class="br0">)</span><span class="sy4">;</span> <br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp; ros<span class="sy4">::</span><span class="me2">Timer</span> timer <span class="sy1">=</span> n.<span class="me1">createTimer</span><span class="br0">(</span>ros<span class="sy4">::</span><span class="me2">Duration</span><span class="br0">(</span>1<span class="br0">)</span>, callback<span class="br0">)</span><span class="sy4">;</span> &nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br>&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; ros<span class="sy4">::</span><span class="me2">spin</span><span class="br0">(</span><span class="br0">)</span><span class="sy4">;</span> &nbsp;<br>&nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; <span class="kw1">return</span> <span class="nu0">0</span><span class="sy4">;</span><br>&nbsp; <span class="br0">}</span></div></div>
<p>We have to add the next line to the file "CMakeLists.txt" of our package in order to compile and create the executable file: 
</p>
<div dir="ltr" class="mw-geshi mw-content-ltr"><div class="cmake source-cmake" style="font-family:monospace;"><pre class="de1">rosbuild_add_executable<span class="sy0">(</span>teleoperador_teclado src/teleoperador_teclado.cpp<span class="sy0">)</span></pre></div></div>
<p>We will execute the next commands in a terminal in order to compile and create the executable file: 
</p>
<div dir="ltr" class="mw-geshi mw-content-ltr"><div class="bash source-bash" style="font-family:monospace;"><pre class="de1">roscd brazo_fer
<span class="kw2">make</span></pre></div></div>
<h3><span class="mw-headline" id="Running_the_program_5">Running the program</span></h3>
<p>First we will execute the next command in a terminal in order to launch the <a rel="nofollow" class="external text" href="http://www.ros.org/">ROS</a> core, if it has not launched previously.
</p>
<div dir="ltr" class="mw-geshi mw-content-ltr"><div class="bash source-bash" style="font-family:monospace;"><pre class="de1">roscore</pre></div></div>
<p>We will execute the next command in other terminal in order to launch the communication node <a rel="nofollow" class="external text" href="http://www.ros.org/">ROS</a>-<a rel="nofollow" class="external text" href="http://www.arduino.cc/">arduino</a>:
</p>
<div dir="ltr" class="mw-geshi mw-content-ltr"><div class="bash source-bash" style="font-family:monospace;"><pre class="de1">rosrun rosserial_python serial_node.py <span class="sy0">/</span>dev<span class="sy0">/</span>ttyACM0</pre></div></div>
<p>We will execute the next command in a terminal in order to launch the control program:
</p>
<div dir="ltr" class="mw-geshi mw-content-ltr"><div class="bash source-bash" style="font-family:monospace;"><pre class="de1">rosrun brazo_fer teleoperador_teclado</pre></div></div>
<p><br>
</p>
<hr>
<table style="border: solid 0px white; width: 100%">
<tbody><tr>
<th>Related articles
<hr>
</th>
<th>Other articles
<hr>
</th></tr>
<tr>
<td valign="top" width="50%">
<p><a href="http://robotica.unileon.es/mediawiki/index.php/Objects_recognition_and_position_calculation_%28webcam%29" title="Objects recognition and position calculation (webcam)">Objects recognition and position calculation (webcam)</a><br>
<a href="http://robotica.unileon.es/mediawiki/index.php/MYRAbot%27s_arm_model_for_simulation_%28urdf%2Bgazebo%29" title="MYRAbot's arm model for simulation (urdf+gazebo)">MYRAbot's arm model for simulation (urdf+gazebo)</a><br>
<a href="http://robotica.unileon.es/mediawiki/index.php/MYRAbot_model_for_simulation_%28urdf%2Bgazebo%29" title="MYRAbot model for simulation (urdf+gazebo)">MYRAbot model for simulation (urdf+gazebo)</a><br>
<a href="http://robotica.unileon.es/mediawiki/index.php/Integration_of_MYRAbot_in_moveIt%21_%28gazebo%2BmoveIt%21%29" title="Integration of MYRAbot in moveIt! (gazebo+moveIt!)">Integration of MYRAbot in moveIt! (gazebo+moveIt!)</a><br>
<a href="http://robotica.unileon.es/mediawiki/index.php/Voice_control_%28sphinx%2Bfestival%29" title="Voice control (sphinx+festival)">Voice control (sphinx+festival)</a><br>
<a href="http://robotica.unileon.es/mediawiki/index.php/MYRAbot%27s_Teleoperation_with_xbox360_wireless_controller_%28xbox360_controller%2Bjoy%29" title="MYRAbot's Teleoperation with xbox360 wireless controller (xbox360 controller+joy)">MYRAbot's Teleoperation with xbox360 wireless controller (xbox360 controller+joy)</a>
</p>
</td>
<td valign="top">
<p><a href="http://robotica.unileon.es/mediawiki/index.php/CeRVaNTeS%27_arm_and_base_control_%28maxon%2Bepos2%29" title="CeRVaNTeS' arm and base control (maxon+epos2)">CeRVaNTeS' arm and base control (maxon+epos2)</a><br>
<a href="http://robotica.unileon.es/mediawiki/index.php/CeRVaNTeS%27_arm_model_for_simulation_%28urdf%2Bgazebo%29" title="CeRVaNTeS' arm model for simulation (urdf+gazebo)">CeRVaNTeS' arm model for simulation (urdf+gazebo)</a><br>
<a href="http://robotica.unileon.es/mediawiki/index.php/CeRVaNTeS_model_for_simulation_%28urdf%2Bgazebo%29" title="CeRVaNTeS model for simulation (urdf+gazebo)">CeRVaNTeS model for simulation (urdf+gazebo)</a><br>
<a href="http://robotica.unileon.es/mediawiki/index.php/Integration_of_CeRVaNTeS_in_moveIt%21_%28gazebo%2BmoveIt%21%29" title="Integration of CeRVaNTeS in moveIt! (gazebo+moveIt!)">Integration of CeRVaNTeS in moveIt! (gazebo+moveIt!)</a><br>
<a href="http://robotica.unileon.es/mediawiki/index.php/CeRVaNTeS%27_Teleoperation_with_xbox360_wireless_controller_%28xbox360_controller%2Bjoy%29" title="CeRVaNTeS' Teleoperation with xbox360 wireless controller (xbox360 controller+joy)">CeRVaNTeS' Teleoperation with xbox360 wireless controller (xbox360 controller+joy)</a>
</p>
</td></tr></tbody></table>
<hr>
<p><br>
<a href="http://robotica.unileon.es/mediawiki/index.php/Mobile_manipulation" title="Mobile manipulation"> &lt; go back to main</a>
</p>
<!-- 
NewPP limit report
CPU time usage: 1.168 seconds
Real time usage: 1.176 seconds
Preprocessor visited node count: 652/1000000
Preprocessor generated node count: 1368/1000000
Post‐expand include size: 0/2097152 bytes
Template argument size: 0/2097152 bytes
Highest expansion depth: 2/40
Expensive parser function count: 0/100
-->

<!-- Saved in parser cache with key wikidb:pcache:idhash:280-0!*!0!!en!2!* and timestamp 20150308110118
 -->
</div>								<div class="printfooter">
				Retrieved from "<a href="http://robotica.unileon.es/mediawiki/index.php?title=MYRAbot%27s_arm_control_%28bioloid%2Barduino%29&amp;oldid=4214">http://robotica.unileon.es/mediawiki/index.php?title=MYRAbot%27s_arm_control_(bioloid%2Barduino)&amp;oldid=4214</a>"				</div>
												<div id="catlinks" class="catlinks catlinks-allhidden"></div>												<div class="visualClear"></div>
							</div>
		</div>
		<div id="mw-navigation">
			<h2>Navigation menu</h2>
			<div id="mw-head">
				<div id="p-personal" role="navigation" class="" aria-labelledby="p-personal-label">
	<h3 id="p-personal-label">Personal tools</h3>
	<ul>
<li id="pt-login"><a href="http://robotica.unileon.es/mediawiki/index.php?title=Special:UserLogin&amp;returnto=MYRAbot%27s+arm+control+%28bioloid%2Barduino%29" title="You are encouraged to log in; however, it is not mandatory [alt-shift-o]" accesskey="o">Log in</a></li>	</ul>
</div>
				<div id="left-navigation">
					<div id="p-namespaces" role="navigation" class="vectorTabs" aria-labelledby="p-namespaces-label">
	<h3 id="p-namespaces-label">Namespaces</h3>
	<ul>
					<li id="ca-nstab-main" class="selected"><span><a href="http://robotica.unileon.es/mediawiki/index.php/MYRAbot%27s_arm_control_%28bioloid%2Barduino%29" title="View the content page [alt-shift-c]" accesskey="c">Page</a></span></li>
					<li id="ca-talk" class="new"><span><a href="http://robotica.unileon.es/mediawiki/index.php?title=Talk:MYRAbot%27s_arm_control_%28bioloid%2Barduino%29&amp;action=edit&amp;redlink=1" title="Discussion about the content page [alt-shift-t]" accesskey="t">Discussion</a></span></li>
			</ul>
</div>
<div id="p-variants" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-variants-label">
	<h3 id="mw-vector-current-variant">
		</h3>
	<h3 tabindex="0" id="p-variants-label"><span>Variants</span><a tabindex="-1" href="#"></a></h3>
	<div class="menu">
		<ul>
					</ul>
	</div>
</div>
				</div>
				<div id="right-navigation">
					<div id="p-views" role="navigation" class="vectorTabs" aria-labelledby="p-views-label">
	<h3 id="p-views-label">Views</h3>
	<ul>
					<li id="ca-view" class="selected"><span><a href="http://robotica.unileon.es/mediawiki/index.php/MYRAbot%27s_arm_control_%28bioloid%2Barduino%29">Read</a></span></li>
					<li id="ca-viewsource"><span><a href="http://robotica.unileon.es/mediawiki/index.php?title=MYRAbot%27s_arm_control_%28bioloid%2Barduino%29&amp;action=edit" title="This page is protected.
You can view its source [alt-shift-e]" accesskey="e">View source</a></span></li>
					<li id="ca-history" class="collapsible"><span><a href="http://robotica.unileon.es/mediawiki/index.php?title=MYRAbot%27s_arm_control_%28bioloid%2Barduino%29&amp;action=history" title="Past revisions of this page [alt-shift-h]" accesskey="h">View history</a></span></li>
			</ul>
</div>
<div id="p-cactions" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-cactions-label">
	<h3 tabindex="0" id="p-cactions-label"><span>Actions</span><a tabindex="-1" href="#"></a></h3>
	<div class="menu">
		<ul>
					</ul>
	</div>
</div>
<div id="p-search" role="search">
	<h3><label for="searchInput">Search</label></h3>
	<form action="/mediawiki/index.php" id="searchform">
				<div id="simpleSearch">
						<input autocomplete="off" tabindex="1" name="search" placeholder="Search" title="Search Robótica - ULE [alt-shift-f]" accesskey="f" id="searchInput">						<button type="submit" name="button" title="Search the pages for this text" id="searchButton"><img src="MYRAbot%27s%20arm%20control%20%28bioloid+arduino%29%20-%20Rob%C3%B3tica%20-%20ULE_files/search-ltr.png" alt="Search" height="13" width="12"></button>								<input name="title" value="Special:Search" type="hidden">
		</div>
	</form>
</div>
				</div>
			</div>
			<div class="collapsible-nav" id="mw-panel">
					<div id="p-logo" role="banner"><a style="background-image: url(/mediawiki/skins/common/images/LogoRobotica_small.png);" href="http://robotica.unileon.es/mediawiki/index.php/Home" title="Visit the main page"></a></div>
				<div class="portal first persistent" role="navigation" id="p-Contents" aria-labelledby="p-Contents-label">
	<h3 id="p-Contents-label">Contents</h3>
	<div class="body">
		<ul>
			<li id="n-Home"><a href="http://robotica.unileon.es/mediawiki/index.php/Home">Home</a></li>
			<li id="n-People"><a href="http://robotica.unileon.es/mediawiki/index.php/People">People</a></li>
			<li id="n-Publications"><a href="http://robotica.unileon.es/mediawiki/index.php/Publications">Publications</a></li>
			<li id="n-Activities"><a href="http://robotica.unileon.es/mediawiki/index.php/Activities">Activities</a></li>
			<li id="n-Projects"><a href="http://robotica.unileon.es/mediawiki/index.php/Projects">Projects</a></li>
			<li id="n-Software"><a href="http://robotica.unileon.es/mediawiki/index.php/Software">Software</a></li>
		</ul>
	</div>
</div>
<div class="portal expanded" role="navigation" id="p-Wiki" aria-labelledby="p-Wiki-label">
	<h3 tabindex="2" id="p-Wiki-label"><a href="#">Wiki</a></h3>
	<div style="display: block;" class="body">
		<ul>
			<li id="n-recentchanges"><a href="http://robotica.unileon.es/mediawiki/index.php/Special:RecentChanges" title="A list of recent changes in the wiki [alt-shift-r]" accesskey="r">Recent changes</a></li>
			<li id="n-randompage"><a href="http://robotica.unileon.es/mediawiki/index.php/Special:Random" title="Load a random page [alt-shift-x]" accesskey="x">Random page</a></li>
			<li id="n-help"><a href="https://www.mediawiki.org/wiki/Special:MyLanguage/Help:Contents" rel="nofollow" title="The place to find out">Help</a></li>
		</ul>
	</div>
</div>
<div class="portal collapsed" role="navigation" id="p-tb" aria-labelledby="p-tb-label">
	<h3 tabindex="3" id="p-tb-label"><a href="#">Tools</a></h3>
	<div class="body">
		<ul>
			<li id="t-whatlinkshere"><a href="http://robotica.unileon.es/mediawiki/index.php/Special:WhatLinksHere/MYRAbot%27s_arm_control_%28bioloid%2Barduino%29" title="A list of all wiki pages that link here [alt-shift-j]" accesskey="j">What links here</a></li>
			<li id="t-recentchangeslinked"><a href="http://robotica.unileon.es/mediawiki/index.php/Special:RecentChangesLinked/MYRAbot%27s_arm_control_%28bioloid%2Barduino%29" title="Recent changes in pages linked from this page [alt-shift-k]" accesskey="k">Related changes</a></li>
			<li id="t-specialpages"><a href="http://robotica.unileon.es/mediawiki/index.php/Special:SpecialPages" title="A list of all special pages [alt-shift-q]" accesskey="q">Special pages</a></li>
			<li id="t-print"><a href="http://robotica.unileon.es/mediawiki/index.php?title=MYRAbot%27s_arm_control_%28bioloid%2Barduino%29&amp;printable=yes" rel="alternate" title="Printable version of this page [alt-shift-p]" accesskey="p">Printable version</a></li>
			<li id="t-permalink"><a href="http://robotica.unileon.es/mediawiki/index.php?title=MYRAbot%27s_arm_control_%28bioloid%2Barduino%29&amp;oldid=4214" title="Permanent link to this revision of the page">Permanent link</a></li>
			<li id="t-info"><a href="http://robotica.unileon.es/mediawiki/index.php?title=MYRAbot%27s_arm_control_%28bioloid%2Barduino%29&amp;action=info">Page information</a></li>
		</ul>
	</div>
</div>
			</div>
		</div>
		<div id="footer" role="contentinfo">
							<ul id="footer-info">
											<li id="footer-info-lastmod"> This page was last modified on 29 September 2014, at 11:07.</li>
											<li id="footer-info-viewcount">This page has been accessed 3,646 times.</li>
									</ul>
									<div style="clear:both"></div>
		</div>
		<script>/*<![CDATA[*/window.jQuery && jQuery.ready();/*]]>*/</script><script>if(window.mw){
mw.loader.state({"site":"loading","user":"ready","user.groups":"ready"});
}</script>
<script>if(window.mw){
mw.loader.load(["mediawiki.action.view.postEdit","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.searchSuggest","skins.vector.collapsibleNav"],null,true);
}</script>
<script>if(window.mw){
mw.loader.state({"site":"ready"});
}</script>
<!-- Served in 0.096 secs. -->
	

<div class="suggestions" style="display: none; font-size: 13px;"><div class="suggestions-results"></div><div class="suggestions-special"></div></div></body></html>